parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"naMp":[function(require,module,exports) {
var s=1e3,e=60*s,r=60*e,a=24*r,n=7*a,c=365.25*a;function t(t){if(!((t=String(t)).length>100)){var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(u){var i=parseFloat(u[1]);switch((u[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*c;case"weeks":case"week":case"w":return i*n;case"days":case"day":case"d":return i*a;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*e;case"seconds":case"second":case"secs":case"sec":case"s":return i*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}function u(n){var c=Math.abs(n);return c>=a?Math.round(n/a)+"d":c>=r?Math.round(n/r)+"h":c>=e?Math.round(n/e)+"m":c>=s?Math.round(n/s)+"s":n+"ms"}function i(n){var c=Math.abs(n);return c>=a?o(n,c,a,"day"):c>=r?o(n,c,r,"hour"):c>=e?o(n,c,e,"minute"):c>=s?o(n,c,s,"second"):n+" ms"}function o(s,e,r,a){var n=e>=1.5*r;return Math.round(s/r)+" "+a+(n?"s":"")}module.exports=function(s,e){e=e||{};var r=typeof s;if("string"===r&&s.length>0)return t(s);if("number"===r&&isFinite(s))return e.long?i(s):u(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};
},{}],"khYB":[function(require,module,exports) {
function e(e){return o(e)||t(e)||n(e)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r){if(e){if("string"==typeof e)return a(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,r):void 0}}function t(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function o(e){if(Array.isArray(e))return a(e)}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function i(r){function n(e){var r,o,a,i=null;function s(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(s.enabled){var a=s,i=Number(new Date),l=i-(r||i);a.diff=l,a.prev=r,a.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,r){if("%%"===e)return"%";u++;var o=n.formatters[r];if("function"==typeof o){var i=t[u];e=o.call(a,i),t.splice(u,1),u--}return e}),n.formatArgs.call(a,t),(a.log||n.log).apply(a,t)}}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=t,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==i?i:(o!==n.namespaces&&(o=n.namespaces,a=n.enabled(e)),a)},set:function(e){i=e}}),"function"==typeof n.init&&n.init(s),s}function t(e,r){var t=n(this.namespace+(void 0===r?":":r)+e);return t.log=this.log,t}function o(e,r){for(var n=0,t=0,o=-1,a=0;n<e.length;)if(t<r.length&&(r[t]===e[n]||"*"===r[t]))"*"===r[t]?(o=t,a=n,t++):(n++,t++);else{if(-1===o)return!1;t=o+1,n=++a}for(;t<r.length&&"*"===r[t];)t++;return t===r.length}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){var r=[].concat(e(n.names),e(n.skips.map(function(e){return"-"+e}))).join(",");return n.enable(""),r},n.enable=function(e){n.save(e),n.namespaces=e,n.names=[],n.skips=[];var r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(var t of r)"-"===t[0]?n.skips.push(t.slice(1)):n.names.push(t)},n.enabled=function(e){for(var r of n.skips)if(o(e,r))return!1;for(var t of n.names)if(o(e,t))return!0;return!1},n.humanize=require("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(r).forEach(function(e){n[e]=r[e]}),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){for(var r=0,t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]},n.enable(n.load()),n}module.exports=i;
},{"ms":"naMp"}],"FTZW":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"RglY":[function(require,module,exports) {
var process = require("process");
var e=require("process");function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/));var e}function t(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),this.useColors){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var t=0,C=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(C=t))}),e.splice(C,0,o)}}function C(e){try{e?exports.storage.setItem("debug",e):exports.storage.removeItem("debug")}catch(o){}}function r(){var o;try{o=exports.storage.getItem("debug")||exports.storage.getItem("DEBUG")}catch(t){}return!o&&void 0!==e&&"env"in e&&(o=void 0),o}function n(){try{return localStorage}catch(e){}}exports.formatArgs=t,exports.save=C,exports.load=r,exports.useColors=o,exports.storage=n(),exports.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||function(){},module.exports=require("./common")(exports);var{formatters:s}=module.exports;s.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}};
},{"./common":"khYB","process":"FTZW"}],"pJdj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
},{}],"andi":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function o(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(t){var r=u(t,"string");return"symbol"==e(r)?r:r+""}function u(t,r){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,r||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;var c=require("debug"),a="mediasoup-client",l=function(){return o(function e(r){t(this,e),n(this,"_debug",void 0),n(this,"_warn",void 0),n(this,"_error",void 0),r?(this._debug=(0,c.default)("".concat(a,":").concat(r)),this._warn=(0,c.default)("".concat(a,":WARN:").concat(r)),this._error=(0,c.default)("".concat(a,":ERROR:").concat(r))):(this._debug=(0,c.default)(a),this._warn=(0,c.default)("".concat(a,":WARN")),this._error=(0,c.default)("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])}();exports.Logger=l;
},{"debug":"RglY"}],"rUhp":[function(require,module,exports) {
"use strict";var e,t="object"==typeof Reflect?Reflect:null,n=t&&"function"==typeof t.apply?t.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function r(e){console&&console.warn&&console.warn(e)}e=t&&"function"==typeof t.ownKeys?t.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}module.exports=o,module.exports.once=m,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function f(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,s,c;if(u(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),c=s[t]),void 0===c)c=s[t]=n,++e._eventsCount;else if("function"==typeof c?c=s[t]=i?[n,c]:[c,n]:i?c.unshift(n):c.push(n),(o=f(e))>0&&c.length>o&&!c.warned){c.warned=!0;var v=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");v.name="MaxListenersExceededWarning",v.emitter=e,v.type=t,v.count=c.length,r(v)}return e}function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=v.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?d(i):h(i,i.length)}function a(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function h(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function d(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function m(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&L(e,i,{once:!0})})}function L(e,t,n){"function"==typeof e.on&&g(e,"error",t,n)}function g(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return f(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var f=o[e];if(void 0===f)return!1;if("function"==typeof f)n(f,this,t);else{var c=f.length,v=h(f,c);for(r=0;r<c;++r)n(v[r],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return u(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():y(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):a.call(e,t)},o.prototype.listenerCount=a,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};
},{}],"HRyP":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(t){var r=i(t,"string");return"symbol"==e(r)?r:r+""}function i(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function u(e,t,r){return t=p(t),c(e,s()?Reflect.construct(t,r||[],p(e).constructor):t.apply(e,r))}function c(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(s=function(){return!!e})()}function l(e,t,r,n){var o=a(p(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function a(){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=y(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(null,arguments)}function y(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.EnhancedEventEmitter=void 0;var b=require("events-alias"),m=require("./Logger"),d=new m.Logger("EnhancedEventEmitter"),w=function(e){function r(){var e;return t(this,r),(e=u(this,r)).setMaxListeners(1/0),e}return v(r,b.EventEmitter),n(r,[{key:"close",value:function(){l(r,"removeAllListeners",this,3)([])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return l(r,"emit",this,3)([e].concat(n))}},{key:"safeEmit",value:function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return l(r,"emit",this,3)([e].concat(n))}catch(i){d.error("safeEmit() | event listener threw an error [eventName:%s]:%o",e,i);try{l(r,"emit",this,3)(["listenererror",e,i])}catch(u){}return Boolean(l(r,"listenerCount",this,3)([e]))}}},{key:"on",value:function(e,t){return l(r,"on",this,3)([e,t]),this}},{key:"off",value:function(e,t){return l(r,"off",this,3)([e,t]),this}},{key:"addListener",value:function(e,t){return l(r,"on",this,3)([e,t]),this}},{key:"prependListener",value:function(e,t){return l(r,"prependListener",this,3)([e,t]),this}},{key:"once",value:function(e,t){return l(r,"once",this,3)([e,t]),this}},{key:"prependOnceListener",value:function(e,t){return l(r,"prependOnceListener",this,3)([e,t]),this}},{key:"removeListener",value:function(e,t){return l(r,"off",this,3)([e,t]),this}},{key:"removeAllListeners",value:function(e){return l(r,"removeAllListeners",this,3)([e]),this}},{key:"listenerCount",value:function(e){return l(r,"listenerCount",this,3)([e])}},{key:"listeners",value:function(e){return l(r,"listeners",this,3)([e])}},{key:"rawListeners",value:function(e){return l(r,"rawListeners",this,3)([e])}}])}();exports.EnhancedEventEmitter=w;
},{"events-alias":"rUhp","./Logger":"andi"}],"hNUz":[function(require,module,exports) {
"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(t)}function t(r,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(r,n(o.key),o)}}function e(r,e,n){return e&&t(r.prototype,e),n&&t(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function n(t){var e=o(t,"string");return"symbol"==r(e)?e:e+""}function o(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function u(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function i(r,t,e){return t=v(t),c(r,s()?Reflect.construct(t,e||[],v(r).constructor):t.apply(r,e))}function c(t,e){if(e&&("object"==r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return a(t)}function a(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function f(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&b(r,t)}function p(r){var t="function"==typeof Map?new Map:void 0;return(p=function(r){if(null===r||!y(r))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(r))return t.get(r);t.set(r,e)}function e(){return l(r,arguments,v(this).constructor)}return e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),b(e,r)})(r)}function l(r,t,e){if(s())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(r.bind.apply(r,n));return e&&b(o,e.prototype),o}function s(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(s=function(){return!!r})()}function y(r){try{return-1!==Function.toString.call(r).indexOf("[native code]")}catch(t){return"function"==typeof r}}function b(r,t){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,t){return r.__proto__=t,r})(r,t)}function v(r){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)})(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.InvalidStateError=exports.UnsupportedError=void 0;var d=function(r){function t(r){var e;return u(this,t),(e=i(this,t,[r])).name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(e,t):e.stack=new Error(r).stack,e}return f(t,p(Error)),e(t)}();exports.UnsupportedError=d;var h=function(r){function t(r){var e;return u(this,t),(e=i(this,t,[r])).name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(e,t):e.stack=new Error(r).stack,e}return f(t,p(Error)),e(t)}();exports.InvalidStateError=h;
},{}],"fnp2":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,u=function(){};return{s:u,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,f=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return f=t.done,t},e:function(t){a=!0,i=t},f:function(){try{f||null==n.return||n.return()}finally{if(a)throw i}}}}function r(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function o(t){return void 0===t?void 0:Number.isNaN(t)?NaN:"function"==typeof structuredClone?structuredClone(t):JSON.parse(JSON.stringify(t))}function u(){return Math.round(1e7*Math.random())}function i(r){var n,o=e(Reflect.ownKeys(r));try{for(o.s();!(n=o.n()).done;){var u=r[n.value];(u&&"object"===t(u)||"function"==typeof u)&&i(u)}}catch(f){o.e(f)}finally{o.f()}return Object.freeze(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.clone=o,exports.generateRandomNumber=u,exports.deepFreeze=i;
},{}],"h5HA":[function(require,module,exports) {
function e(e){return o(e)||t(e)||n(e)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r){if(e){if("string"==typeof e)return a(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,r):void 0}}function t(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function o(e){if(Array.isArray(e))return a(e)}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function i(r){function n(e){var r,o,a,i=null;function s(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(s.enabled){var a=s,i=Number(new Date),l=i-(r||i);a.diff=l,a.prev=r,a.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,r){if("%%"===e)return"%";u++;var o=n.formatters[r];if("function"==typeof o){var i=t[u];e=o.call(a,i),t.splice(u,1),u--}return e}),n.formatArgs.call(a,t),(a.log||n.log).apply(a,t)}}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=t,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==i?i:(o!==n.namespaces&&(o=n.namespaces,a=n.enabled(e)),a)},set:function(e){i=e}}),"function"==typeof n.init&&n.init(s),s}function t(e,r){var t=n(this.namespace+(void 0===r?":":r)+e);return t.log=this.log,t}function o(e,r){for(var n=0,t=0,o=-1,a=0;n<e.length;)if(t<r.length&&(r[t]===e[n]||"*"===r[t]))"*"===r[t]?(o=t,a=n,t++):(n++,t++);else{if(-1===o)return!1;t=o+1,n=++a}for(;t<r.length&&"*"===r[t];)t++;return t===r.length}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){var r=[].concat(e(n.names),e(n.skips.map(function(e){return"-"+e}))).join(",");return n.enable(""),r},n.enable=function(e){n.save(e),n.namespaces=e,n.names=[],n.skips=[];var r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(var t of r)"-"===t[0]?n.skips.push(t.slice(1)):n.names.push(t)},n.enabled=function(e){for(var r of n.skips)if(o(e,r))return!1;for(var t of n.names)if(o(e,t))return!0;return!1},n.humanize=require("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(r).forEach(function(e){n[e]=r[e]}),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){for(var r=0,t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]},n.enable(n.load()),n}module.exports=i;
},{"ms":"naMp"}],"OXRF":[function(require,module,exports) {
var process = require("process");
var e=require("process");function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/));var e}function t(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),this.useColors){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var t=0,C=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(C=t))}),e.splice(C,0,o)}}function C(e){try{e?exports.storage.setItem("debug",e):exports.storage.removeItem("debug")}catch(o){}}function r(){var o;try{o=exports.storage.getItem("debug")||exports.storage.getItem("DEBUG")}catch(t){}return!o&&void 0!==e&&"env"in e&&(o=void 0),o}function n(){try{return localStorage}catch(e){}}exports.formatArgs=t,exports.save=C,exports.load=r,exports.useColors=o,exports.storage=n(),exports.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||function(){},module.exports=require("./common")(exports);var{formatters:s}=module.exports;s.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}};
},{"./common":"h5HA","process":"FTZW"}],"xR5X":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function o(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(t){var r=u(t,"string");return"symbol"==e(r)?r:r+""}function u(t,r){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,r||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;var c=require("debug"),a="h264-profile-level-id",l=function(){return o(function e(r){t(this,e),n(this,"_debug",void 0),n(this,"_warn",void 0),n(this,"_error",void 0),r?(this._debug=(0,c.default)("".concat(a,":").concat(r)),this._warn=(0,c.default)("".concat(a,":WARN:").concat(r)),this._error=(0,c.default)("".concat(a,":ERROR:").concat(r))):(this._debug=(0,c.default)(a),this._warn=(0,c.default)("".concat(a,":WARN")),this._error=(0,c.default)("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])}();exports.Logger=l;
},{"debug":"OXRF"}],"Bupk":[function(require,module,exports) {
"use strict";function e(r){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function r(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=o(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,l=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){c=!0,t=e},f:function(){try{l||null==n.return||n.return()}finally{if(c)throw t}}}}function o(e,r){if(e){if("string"==typeof e)return n(e,r);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(e,r):void 0}}function n(e,r){(null==r||r>e.length)&&(r=e.length);for(var o=0,n=Array(r);o<r;o++)n[o]=e[o];return n}function i(e,r){for(var o=0;o<r.length;o++){var n=r[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function a(e,r,o){return r&&i(e.prototype,r),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function t(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function l(e,r,o){return(r=c(r))in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function c(r){var o=s(r,"string");return"symbol"==e(o)?o:o+""}function s(r,o){if("object"!=e(r)||!r)return r;var n=r[Symbol.toPrimitive];if(void 0!==n){var i=n.call(r,o||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ProfileLevelId=exports.Level=exports.Profile=void 0,exports.parseProfileLevelId=h,exports.profileLevelIdToString=g,exports.profileToString=w,exports.levelToString=k,exports.parseSdpProfileLevelId=y,exports.isSameProfile=P,exports.isSameProfileAndLevel=S,exports.generateProfileLevelIdStringForAnswer=z,exports.supportedLevel=B;var _,f,u=require("./Logger"),m=new u.Logger;!function(e){e[e.ConstrainedBaseline=1]="ConstrainedBaseline",e[e.Baseline=2]="Baseline",e[e.Main=3]="Main",e[e.ConstrainedHigh=4]="ConstrainedHigh",e[e.High=5]="High",e[e.PredictiveHigh444=6]="PredictiveHigh444"}(_||(exports.Profile=_={})),function(e){e[e.L1_b=0]="L1_b",e[e.L1=10]="L1",e[e.L1_1=11]="L1_1",e[e.L1_2=12]="L1_2",e[e.L1_3=13]="L1_3",e[e.L2=20]="L2",e[e.L2_1=21]="L2_1",e[e.L2_2=22]="L2_2",e[e.L3=30]="L3",e[e.L3_1=31]="L3_1",e[e.L3_2=32]="L3_2",e[e.L4=40]="L4",e[e.L4_1=41]="L4_1",e[e.L4_2=42]="L4_2",e[e.L5=50]="L5",e[e.L5_1=51]="L5_1",e[e.L5_2=52]="L5_2"}(f||(exports.Level=f={}));var v=a(function e(r,o){t(this,e),l(this,"profile",void 0),l(this,"level",void 0),this.profile=r,this.level=o});exports.ProfileLevelId=v;var d=new v(_.ConstrainedBaseline,f.L3_1),p=function(){return a(function e(r){t(this,e),l(this,"mask",void 0),l(this,"masked_value",void 0),this.mask=~H("x",r),this.masked_value=H("1",r)},[{key:"isMatch",value:function(e){return this.masked_value===(e&this.mask)}}])}(),L=a(function e(r,o,n){t(this,e),l(this,"profile_idc",void 0),l(this,"profile_iop",void 0),l(this,"profile",void 0),this.profile_idc=r,this.profile_iop=o,this.profile=n}),b=[new L(66,new p("x1xx0000"),_.ConstrainedBaseline),new L(77,new p("1xxx0000"),_.ConstrainedBaseline),new L(88,new p("11xx0000"),_.ConstrainedBaseline),new L(66,new p("x0xx0000"),_.Baseline),new L(88,new p("10xx0000"),_.Baseline),new L(77,new p("0x0x0000"),_.Main),new L(100,new p("00000000"),_.High),new L(100,new p("00001100"),_.ConstrainedHigh),new L(244,new p("00000000"),_.PredictiveHigh444)],x=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:f.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:f.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:f.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:f.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:f.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:f.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:f.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:f.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:f.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:f.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:f.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:f.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:f.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:f.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:f.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:f.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:f.L5_2}];function h(e){if("string"==typeof e&&6===e.length){var o=parseInt(e,16);if(0!==o){var n,i=255&o,a=o>>8&255,t=o>>16&255;switch(i){case f.L1_1:n=0!=(16&a)?f.L1_b:f.L1_1;break;case f.L1:case f.L1_2:case f.L1_3:case f.L2:case f.L2_1:case f.L2_2:case f.L3:case f.L3_1:case f.L3_2:case f.L4:case f.L4_1:case f.L4_2:case f.L5:case f.L5_1:case f.L5_2:n=i;break;default:return void m.warn("parseProfileLevelId() | unrecognized level_idc [str:".concat(e,", level_idc:").concat(i,"]"))}var l,c=r(b);try{for(c.s();!(l=c.n()).done;){var s=l.value;if(t===s.profile_idc&&s.profile_iop.isMatch(a))return m.debug("parseProfileLevelId() | result [str:".concat(e,", profile:").concat(s.profile,", level:").concat(n,"]")),new v(s.profile,n)}}catch(_){c.e(_)}finally{c.f()}m.warn("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:".concat(e,", profile_idc:").concat(t,", profile_iop:").concat(a,"]"))}}}function g(e){if(e.level==f.L1_b)switch(e.profile){case _.ConstrainedBaseline:return"42f00b";case _.Baseline:return"42100b";case _.Main:return"4d100b";default:return void m.warn("profileLevelIdToString() | Level 1_b not is allowed for profile ".concat(e.profile))}var r;switch(e.profile){case _.ConstrainedBaseline:r="42e0";break;case _.Baseline:r="4200";break;case _.Main:r="4d00";break;case _.ConstrainedHigh:r="640c";break;case _.High:r="6400";break;case _.PredictiveHigh444:r="f400";break;default:return void m.warn("profileLevelIdToString() | unrecognized profile ".concat(e.profile))}var o=e.level.toString(16);return 1===o.length&&(o="0".concat(o)),"".concat(r).concat(o)}function w(e){switch(e){case _.ConstrainedBaseline:return"ConstrainedBaseline";case _.Baseline:return"Baseline";case _.Main:return"Main";case _.ConstrainedHigh:return"ConstrainedHigh";case _.High:return"High";case _.PredictiveHigh444:return"PredictiveHigh444";default:return void m.warn("profileToString() | unrecognized profile ".concat(e))}}function k(e){switch(e){case f.L1_b:return"1b";case f.L1:return"1";case f.L1_1:return"1.1";case f.L1_2:return"1.2";case f.L1_3:return"1.3";case f.L2:return"2";case f.L2_1:return"2.1";case f.L2_2:return"2.2";case f.L3:return"3";case f.L3_1:return"3.1";case f.L3_2:return"3.2";case f.L4:return"4";case f.L4_1:return"4.1";case f.L4_2:return"4.2";case f.L5:return"5";case f.L5_1:return"5.1";case f.L5_2:return"5.2";default:return void m.warn("levelToString() | unrecognized level ".concat(e))}}function y(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["profile-level-id"];return e?h(e):d}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=y(e),n=y(r);return Boolean(o&&n&&o.profile===n.profile)}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=y(e),n=y(r);return Boolean(o&&n&&o.profile===n.profile&&o.level==n.level)}function z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e["profile-level-id"]||r["profile-level-id"]){var o=y(e),n=y(r);if(!o)throw new TypeError("invalid local_profile_level_id");if(!n)throw new TypeError("invalid remote_profile_level_id");if(o.profile!==n.profile)throw new TypeError("H264 Profile mismatch");var i=T(e)&&T(r),a=o.level,t=I(a,n.level),l=i?a:t;return m.debug("generateProfileLevelIdStringForAnswer() | result [profile:".concat(o.profile,", level:").concat(l,"]")),g(new v(o.profile,l))}m.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params")}function B(e,r){for(var o=x.length-1;o>=0;--o){var n=x[o];if(256*n.max_macroblock_frame_size<=e&&n.max_macroblocks_per_second<=r*n.max_macroblock_frame_size)return m.debug("supportedLevel() | result [max_frame_pixel_count:".concat(e,", max_fps:").concat(r,", level:").concat(n.level,"]")),n.level}m.warn("supportedLevel() | no level supported [max_frame_pixel_count:".concat(e,", max_fps:").concat(r,"]"))}function H(e,r){return Number(r[0]===e)<<7|Number(r[1]===e)<<6|Number(r[2]===e)<<5|Number(r[3]===e)<<4|Number(r[4]===e)<<3|Number(r[5]===e)<<2|Number(r[6]===e)<<1|Number(r[7]===e)<<0}function C(e,r){return e===f.L1_b?r!==f.L1&&r!==f.L1_b:r===f.L1_b?e!==f.L1:e<r}function I(e,r){return C(e,r)?e:r}function T(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})["level-asymmetry-allowed"];return!0===e||1===e||"1"===e}
},{"./Logger":"xR5X"}],"y0TR":[function(require,module,exports) {
"use strict";function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,d=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){d=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(d)throw i}}}}function r(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateAndNormalizeRtpCapabilities=s,exports.validateAndNormalizeRtpParameters=p,exports.validateAndNormalizeSctpStreamParameters=l,exports.validateSctpCapabilities=y,exports.getExtendedRtpCapabilities=f,exports.getRecvRtpCapabilities=m,exports.getSendingRtpParameters=u,exports.getSendingRemoteRtpParameters=v,exports.reduceCodecs=h,exports.generateProbatorRtpParameters=w,exports.canSend=T,exports.canReceive=b;var a=require("h264-profile-level-id"),o=require("./utils"),i="probator",c=1234,d=127;function s(r){if("object"!==n(r))throw new TypeError("caps is not an object");if(r.codecs&&!Array.isArray(r.codecs))throw new TypeError("caps.codecs is not an array");r.codecs||(r.codecs=[]);var t,a=e(r.codecs);try{for(a.s();!(t=a.n()).done;){x(t.value)}}catch(c){a.e(c)}finally{a.f()}if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);var o,i=e(r.headerExtensions);try{for(i.s();!(o=i.n()).done;){E(o.value)}}catch(c){i.e(c)}finally{i.f()}}function p(r){if("object"!==n(r))throw new TypeError("params is not an object");if(r.mid&&"string"!=typeof r.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(r.codecs))throw new TypeError("missing params.codecs");var t,a=e(r.codecs);try{for(a.s();!(t=a.n()).done;){g(t.value)}}catch(s){a.e(s)}finally{a.f()}if(r.headerExtensions&&!Array.isArray(r.headerExtensions))throw new TypeError("params.headerExtensions is not an array");r.headerExtensions||(r.headerExtensions=[]);var o,i=e(r.headerExtensions);try{for(i.s();!(o=i.n()).done;){P(o.value)}}catch(s){i.e(s)}finally{i.f()}if(r.encodings&&!Array.isArray(r.encodings))throw new TypeError("params.encodings is not an array");r.encodings||(r.encodings=[]);var c,d=e(r.encodings);try{for(d.s();!(c=d.n()).done;){R(c.value)}}catch(s){d.e(s)}finally{d.f()}if(r.rtcp&&"object"!==n(r.rtcp))throw new TypeError("params.rtcp is not an object");r.rtcp||(r.rtcp={}),j(r.rtcp)}function l(e){if("object"!==n(e))throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");var r=!1;if("boolean"==typeof e.ordered?r=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(r&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(r||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function y(e){if("object"!==n(e))throw new TypeError("caps is not an object");if(!e.numStreams||"object"!==n(e.numStreams))throw new TypeError("missing caps.numStreams");S(e.numStreams)}function f(r,t,n){var a={codecs:[],headerExtensions:[]};if(n){var o,i,c=e(null!==(o=r.codecs)&&void 0!==o?o:[]);try{var d=function(){var e,r,n,o=i.value;if(F(o))return 0;var c=(null!==(e=t.codecs)&&void 0!==e?e:[]).find(function(e){return A(e,o,{strict:!0,modify:!0})});if(!c)return 0;var d={kind:o.kind,mimeType:o.mimeType,clockRate:o.clockRate,channels:o.channels,localPayloadType:o.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:c.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:null!==(r=o.parameters)&&void 0!==r?r:{},remoteParameters:null!==(n=c.parameters)&&void 0!==n?n:{},rtcpFeedback:L(o,c)};a.codecs.push(d)};for(c.s();!(i=c.n()).done;)d()}catch(T){c.e(T)}finally{c.f()}}else{var s,p,l=e(null!==(s=t.codecs)&&void 0!==s?s:[]);try{var y=function(){var e,t,n,o=p.value;if(F(o))return 0;var i=(null!==(e=r.codecs)&&void 0!==e?e:[]).find(function(e){return A(e,o,{strict:!0,modify:!0})});if(!i)return 0;var c={kind:i.kind,mimeType:i.mimeType,clockRate:i.clockRate,channels:i.channels,localPayloadType:i.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:o.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:null!==(t=i.parameters)&&void 0!==t?t:{},remoteParameters:null!==(n=o.parameters)&&void 0!==n?n:{},rtcpFeedback:L(i,o)};a.codecs.push(c)};for(l.s();!(p=l.n()).done;)y()}catch(T){l.e(T)}finally{l.f()}}var f,m=e(a.codecs);try{var u=function(){var e=f.value,n=r.codecs.find(function(r){var t;return F(r)&&(null===(t=r.parameters)||void 0===t?void 0:t.apt)===e.localPayloadType}),a=t.codecs.find(function(r){var t;return F(r)&&(null===(t=r.parameters)||void 0===t?void 0:t.apt)===e.remotePayloadType});n&&a&&(e.localRtxPayloadType=n.preferredPayloadType,e.remoteRtxPayloadType=a.preferredPayloadType)};for(m.s();!(f=m.n()).done;)u()}catch(T){m.e(T)}finally{m.f()}var v,h=e(t.headerExtensions);try{var w=function(){var e,t=v.value,n=r.headerExtensions.find(function(e){return I(e,t)});if(!n)return 1;var o={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId,encrypt:null!==(e=n.preferredEncrypt)&&void 0!==e&&e,direction:"sendrecv"};switch(t.direction){case"sendrecv":o.direction="sendrecv";break;case"recvonly":o.direction="sendonly";break;case"sendonly":o.direction="recvonly";break;case"inactive":o.direction="inactive"}a.headerExtensions.push(o)};for(h.s();!(v=h.n()).done;)w()}catch(T){h.e(T)}finally{h.f()}return a}function m(r){var t,n={codecs:[],headerExtensions:[]},a=e(r.codecs);try{for(a.s();!(t=a.n()).done;){var o=t.value,i={kind:o.kind,mimeType:o.mimeType,preferredPayloadType:o.remotePayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.localParameters,rtcpFeedback:o.rtcpFeedback};if(n.codecs.push(i),o.remoteRtxPayloadType){var c={kind:o.kind,mimeType:"".concat(o.kind,"/rtx"),preferredPayloadType:o.remoteRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.remotePayloadType},rtcpFeedback:[]};n.codecs.push(c)}}}catch(f){a.e(f)}finally{a.f()}var d,s=e(r.headerExtensions);try{for(s.s();!(d=s.n()).done;){var p,l=d.value;if("sendrecv"===l.direction||"recvonly"===l.direction){var y={kind:l.kind,uri:l.uri,preferredId:l.recvId,preferredEncrypt:null!==(p=l.encrypt)&&void 0!==p&&p,direction:l.direction};n.headerExtensions.push(y)}}}catch(f){s.e(f)}finally{s.f()}return n}function u(r,t){var n,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},o=e(t.codecs);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.kind===r){var c={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback};if(a.codecs.push(c),i.localRtxPayloadType){var d={mimeType:"".concat(i.kind,"/rtx"),payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};a.codecs.push(d)}}}}catch(f){o.e(f)}finally{o.f()}var s,p=e(t.headerExtensions);try{for(p.s();!(s=p.n()).done;){var l=s.value;if(!(l.kind&&l.kind!==r||"sendrecv"!==l.direction&&"sendonly"!==l.direction)){var y={uri:l.uri,id:l.sendId,encrypt:l.encrypt,parameters:{}};a.headerExtensions.push(y)}}}catch(f){p.e(f)}finally{p.f()}return a}function v(r,t){var n,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},o=e(t.codecs);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(i.kind===r){var c={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.remoteParameters,rtcpFeedback:i.rtcpFeedback};if(a.codecs.push(c),i.localRtxPayloadType){var d={mimeType:"".concat(i.kind,"/rtx"),payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]};a.codecs.push(d)}}}}catch(P){o.e(P)}finally{o.f()}var s,p=e(t.headerExtensions);try{for(p.s();!(s=p.n()).done;){var l=s.value;if(!(l.kind&&l.kind!==r||"sendrecv"!==l.direction&&"sendonly"!==l.direction)){var y={uri:l.uri,id:l.sendId,encrypt:l.encrypt,parameters:{}};a.headerExtensions.push(y)}}}catch(P){p.e(P)}finally{p.f()}if(a.headerExtensions.some(function(e){return"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri})){var f,m=e(a.codecs);try{for(m.s();!(f=m.n()).done;){var u,v=f.value;v.rtcpFeedback=(null!==(u=v.rtcpFeedback)&&void 0!==u?u:[]).filter(function(e){return"goog-remb"!==e.type})}}catch(P){m.e(P)}finally{m.f()}}else if(a.headerExtensions.some(function(e){return"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri})){var h,w=e(a.codecs);try{for(w.s();!(h=w.n()).done;){var T,b=h.value;b.rtcpFeedback=(null!==(T=b.rtcpFeedback)&&void 0!==T?T:[]).filter(function(e){return"transport-cc"!==e.type})}}catch(P){w.e(P)}finally{w.f()}}else{var x,k=e(a.codecs);try{for(k.s();!(x=k.n()).done;){var E,g=x.value;g.rtcpFeedback=(null!==(E=g.rtcpFeedback)&&void 0!==E?E:[]).filter(function(e){return"transport-cc"!==e.type&&"goog-remb"!==e.type})}}catch(P){k.e(P)}finally{k.f()}}return a}function h(e,r){var t=[];if(r){for(var n=0;n<e.length;++n)if(A(e[n],r,{strict:!0})){t.push(e[n]),F(e[n+1])&&t.push(e[n+1]);break}if(0===t.length)throw new TypeError("no matching codec found")}else t.push(e[0]),F(e[1])&&t.push(e[1]);return t}function w(e){p(e=o.clone(e));var r={mid:i,codecs:[],headerExtensions:[],encodings:[{ssrc:c}],rtcp:{cname:"probator"}};return r.codecs.push(e.codecs[0]),r.codecs[0].payloadType=d,r.headerExtensions=e.headerExtensions,r}function T(e,r){var t;return(null!==(t=r.codecs)&&void 0!==t?t:[]).some(function(r){return r.kind===e})}function b(e,r){var t;if(p(e),0===e.codecs.length)return!1;var n=e.codecs[0];return(null!==(t=r.codecs)&&void 0!==t?t:[]).some(function(e){return e.preferredPayloadType===n.payloadType})}function x(r){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==n(r))throw new TypeError("codec is not an object");if(!r.mimeType||"string"!=typeof r.mimeType)throw new TypeError("missing codec.mimeType");var a=t.exec(r.mimeType);if(!a)throw new TypeError("invalid codec.mimeType");if(r.kind=a[1].toLowerCase(),"number"!=typeof r.preferredPayloadType)throw new TypeError("missing codec.preferredPayloadType");if("number"!=typeof r.clockRate)throw new TypeError("missing codec.clockRate");"audio"===r.kind?"number"!=typeof r.channels&&(r.channels=1):delete r.channels,r.parameters&&"object"===n(r.parameters)||(r.parameters={});for(var o=0,i=Object.keys(r.parameters);o<i.length;o++){var c=i[o],d=r.parameters[c];if(void 0===d&&(r.parameters[c]="",d=""),"string"!=typeof d&&"number"!=typeof d)throw new TypeError("invalid codec parameter [key:".concat(c,"s, value:").concat(d,"]"));if("apt"===c&&"number"!=typeof d)throw new TypeError("invalid codec apt parameter")}r.rtcpFeedback&&Array.isArray(r.rtcpFeedback)||(r.rtcpFeedback=[]);var s,p=e(r.rtcpFeedback);try{for(p.s();!(s=p.n()).done;){k(s.value)}}catch(l){p.e(l)}finally{p.f()}}function k(e){if("object"!==n(e))throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function E(e){if("object"!==n(e))throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function g(r){var t=new RegExp("^(audio|video)/(.+)","i");if("object"!==n(r))throw new TypeError("codec is not an object");if(!r.mimeType||"string"!=typeof r.mimeType)throw new TypeError("missing codec.mimeType");var a=t.exec(r.mimeType);if(!a)throw new TypeError("invalid codec.mimeType");if("number"!=typeof r.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof r.clockRate)throw new TypeError("missing codec.clockRate");"audio"===a[1].toLowerCase()?"number"!=typeof r.channels&&(r.channels=1):delete r.channels,r.parameters&&"object"===n(r.parameters)||(r.parameters={});for(var o=0,i=Object.keys(r.parameters);o<i.length;o++){var c=i[o],d=r.parameters[c];if(void 0===d&&(r.parameters[c]="",d=""),"string"!=typeof d&&"number"!=typeof d)throw new TypeError("invalid codec parameter [key:".concat(c,"s, value:").concat(d,"]"));if("apt"===c&&"number"!=typeof d)throw new TypeError("invalid codec apt parameter")}r.rtcpFeedback&&Array.isArray(r.rtcpFeedback)||(r.rtcpFeedback=[]);var s,p=e(r.rtcpFeedback);try{for(p.s();!(s=p.n()).done;){k(s.value)}}catch(l){p.e(l)}finally{p.f()}}function P(e){if("object"!==n(e))throw new TypeError("ext is not an object");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.id)throw new TypeError("missing ext.id");if(e.encrypt&&"boolean"!=typeof e.encrypt)throw new TypeError("invalid ext.encrypt");e.encrypt||(e.encrypt=!1),e.parameters&&"object"===n(e.parameters)||(e.parameters={});for(var r=0,t=Object.keys(e.parameters);r<t.length;r++){var a=t[r],o=e.parameters[a];if(void 0===o&&(e.parameters[a]="",o=""),"string"!=typeof o&&"number"!=typeof o)throw new TypeError("invalid header extension parameter")}}function R(e){if("object"!==n(e))throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!==n(e.rtx))throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function j(e){if("object"!==n(e))throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function S(e){if("object"!==n(e))throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function F(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function A(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=t.strict,o=void 0!==n&&n,i=t.modify,c=void 0!==i&&i,d=e.mimeType.toLowerCase();if(d!==r.mimeType.toLowerCase())return!1;if(e.clockRate!==r.clockRate)return!1;if(e.channels!==r.channels)return!1;switch(d){case"video/h264":if(o){var s,p,l;if((null!==(s=e.parameters["packetization-mode"])&&void 0!==s?s:0)!==(null!==(p=r.parameters["packetization-mode"])&&void 0!==p?p:0))return!1;if(!a.isSameProfile(e.parameters,r.parameters))return!1;try{l=a.generateProfileLevelIdStringForAnswer(e.parameters,r.parameters)}catch(m){return!1}c&&(l?(e.parameters["profile-level-id"]=l,r.parameters["profile-level-id"]=l):(delete e.parameters["profile-level-id"],delete r.parameters["profile-level-id"]))}break;case"video/vp9":var y,f;if(o)if((null!==(y=e.parameters["profile-id"])&&void 0!==y?y:0)!==(null!==(f=r.parameters["profile-id"])&&void 0!==f?f:0))return!1}return!0}function I(e,r){return(!e.kind||!r.kind||e.kind===r.kind)&&e.uri===r.uri}function L(r,t){var n,a,o=[],i=e(null!==(n=r.rtcpFeedback)&&void 0!==n?n:[]);try{var c=function(){var e,r=a.value,n=(null!==(e=t.rtcpFeedback)&&void 0!==e?e:[]).find(function(e){return e.type===r.type&&(e.parameter===r.parameter||!e.parameter&&!r.parameter)});n&&o.push(n)};for(i.s();!(a=i.n()).done;)c()}catch(d){i.e(d)}finally{i.f()}return o}
},{"h264-profile-level-id":"Bupk","./utils":"fnp2"}],"W4GE":[function(require,module,exports) {
function e(e){return o(e)||t(e)||n(e)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r){if(e){if("string"==typeof e)return a(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,r):void 0}}function t(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function o(e){if(Array.isArray(e))return a(e)}function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function i(r){function n(e){var r,o,a,i=null;function s(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(s.enabled){var a=s,i=Number(new Date),l=i-(r||i);a.diff=l,a.prev=r,a.curr=i,r=i,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var u=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,r){if("%%"===e)return"%";u++;var o=n.formatters[r];if("function"==typeof o){var i=t[u];e=o.call(a,i),t.splice(u,1),u--}return e}),n.formatArgs.call(a,t),(a.log||n.log).apply(a,t)}}return s.namespace=e,s.useColors=n.useColors(),s.color=n.selectColor(e),s.extend=t,s.destroy=n.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==i?i:(o!==n.namespaces&&(o=n.namespaces,a=n.enabled(e)),a)},set:function(e){i=e}}),"function"==typeof n.init&&n.init(s),s}function t(e,r){var t=n(this.namespace+(void 0===r?":":r)+e);return t.log=this.log,t}function o(e,r){for(var n=0,t=0,o=-1,a=0;n<e.length;)if(t<r.length&&(r[t]===e[n]||"*"===r[t]))"*"===r[t]?(o=t,a=n,t++):(n++,t++);else{if(-1===o)return!1;t=o+1,n=++a}for(;t<r.length&&"*"===r[t];)t++;return t===r.length}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){var r=[].concat(e(n.names),e(n.skips.map(function(e){return"-"+e}))).join(",");return n.enable(""),r},n.enable=function(e){n.save(e),n.namespaces=e,n.names=[],n.skips=[];var r=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(var t of r)"-"===t[0]?n.skips.push(t.slice(1)):n.names.push(t)},n.enabled=function(e){for(var r of n.skips)if(o(e,r))return!1;for(var t of n.names)if(o(e,t))return!0;return!1},n.humanize=require("ms"),n.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(r).forEach(function(e){n[e]=r[e]}),n.names=[],n.skips=[],n.formatters={},n.selectColor=function(e){for(var r=0,t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]},n.enable(n.load()),n}module.exports=i;
},{"ms":"naMp"}],"hUnB":[function(require,module,exports) {
var process = require("process");
var e=require("process");function o(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/));var e}function t(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),this.useColors){var o="color: "+this.color;e.splice(1,0,o,"color: inherit");var t=0,C=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(t++,"%c"===e&&(C=t))}),e.splice(C,0,o)}}function C(e){try{e?exports.storage.setItem("debug",e):exports.storage.removeItem("debug")}catch(o){}}function r(){var o;try{o=exports.storage.getItem("debug")||exports.storage.getItem("DEBUG")}catch(t){}return!o&&void 0!==e&&"env"in e&&(o=void 0),o}function n(){try{return localStorage}catch(e){}}exports.formatArgs=t,exports.save=C,exports.load=r,exports.useColors=o,exports.storage=n(),exports.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.log=console.debug||console.log||function(){},module.exports=require("./common")(exports);var{formatters:s}=module.exports;s.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}};
},{"./common":"W4GE","process":"FTZW"}],"wyFv":[function(require,module,exports) {
"use strict";function e(r){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(r)}function r(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,i(o.key),o)}}function o(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,r,t){return(r=i(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(r){var t=u(r,"string");return"symbol"==e(t)?t:t+""}function u(r,t){if("object"!=e(r)||!r)return r;var o=r[Symbol.toPrimitive];if(void 0!==o){var n=o.call(r,t||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(r)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=void 0;var c=require("debug"),a="awaitqueue",s=function(){return o(function e(t){r(this,e),n(this,"_debug",void 0),n(this,"_warn",void 0),n(this,"_error",void 0),t?(this._debug=c("".concat(a,":").concat(t)),this._warn=c("".concat(a,":WARN:").concat(t)),this._error=c("".concat(a,":ERROR:").concat(t))):(this._debug=c(a),this._warn=c("".concat(a,":WARN")),this._error=c("".concat(a,":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])}();exports.Logger=s;
},{"debug":"hUnB"}],"hOev":[function(require,module,exports) {
"use strict";function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(r)}function r(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function e(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(r){var e=n(r,"string");return"symbol"==t(e)?e:e+""}function n(r,e){if("object"!=t(r)||!r)return r;var o=r[Symbol.toPrimitive];if(void 0!==o){var n=o.call(r,e||"default");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(r)}function u(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function i(t,r,e){return r=v(r),c(t,s()?Reflect.construct(r,e||[],v(t).constructor):r.apply(t,e))}function c(r,e){if(e&&("object"==t(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return a(r)}function a(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&b(t,r)}function p(t){var r="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||!y(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return l(t,arguments,v(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),b(e,t)})(t)}function l(t,r,e){if(s())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,r);var n=new(t.bind.apply(t,o));return e&&b(n,e.prototype),n}function s(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(s=function(){return!!t})()}function y(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(r){return"function"==typeof t}}function b(t,r){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t})(t,r)}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AwaitQueueRemovedTaskError=exports.AwaitQueueStoppedError=void 0;var d=function(t){function r(t){var e;return u(this,r),(e=i(this,r,[null!=t?t:"queue stopped"])).name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(e,r),e}return f(r,p(Error)),e(r)}();exports.AwaitQueueStoppedError=d;var m=function(t){function r(t){var e;return u(this,r),(e=i(this,r,[null!=t?t:"queue task removed"])).name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(e,r),e}return f(r,p(Error)),e(r)}();exports.AwaitQueueRemovedTaskError=m;
},{}],"NgqB":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){var e,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.toStringTag||"@@toStringTag";function i(t,o,a,u){var i=o&&o.prototype instanceof f?o:f,s=Object.create(i.prototype);return n(s,"_invoke",function(t,n,o){var a,u,i,f=0,s=o||[],l=!1,p={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return a=t,u=0,i=e,p.n=n,c}};function d(t,n){for(u=t,i=n,r=0;!l&&f&&!o&&r<s.length;r++){var o,a=s[r],d=p.p,v=a[2];t>3?(o=v===n)&&(i=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=t<2&&d<a[1])?(u=0,p.v=n,p.n=a[1]):d<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,p.n=v,u=0))}if(o||t>1)return c;throw l=!0,n}return function(o,s,v){if(f>1)throw TypeError("Generator is already running");for(l&&1===s&&d(s,v),u=s,i=v;(r=u<2?e:i)||!l;){a||(u?u<3?(u>1&&(p.n=-1),d(u,i)):p.n=i:p.v=i);try{if(f=2,a){if(u||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,u<2&&(u=0)}else 1===u&&(r=a.return)&&r.call(a),u<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=e}else if((r=(l=p.n<0)?i:t.call(n,p))!==c)break}catch(r){a=e,u=1,i=r}finally{f=1}}return{value:r,done:l}}}(t,a,u),!0),s}var c={};function f(){}function s(){}function l(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),d=l.prototype=f.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,n(e,u,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=l,n(d,"constructor",l),n(l,"constructor",s),s.displayName="GeneratorFunction",n(l,u,"GeneratorFunction"),n(d),n(d,u,"Generator"),n(d,a,function(){return this}),n(d,"toString",function(){return"[object Generator]"}),(t=function(){return{w:i,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(n=function(e,t,r,o){function u(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(u("next",0),u("throw",1),u("return",2))})(e,t,r,o)}function r(e,t){return u(e)||a(e,t)||c(e,t)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,u,i=[],c=!0,f=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){f=!0,o=e}finally{try{if(!c&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(f)throw o}}return i}}function u(e){if(Array.isArray(e))return e}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){i=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(i)throw a}}}}function c(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n,r,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function u(e){s(a,r,o,u,i,"next",e)}function i(e){s(a,r,o,u,i,"throw",e)}u(void 0)})}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function v(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(t){var n=b(t,"string");return"symbol"==e(n)?n:n+""}function b(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.AwaitQueue=void 0;var g=require("./Logger"),h=require("./errors"),k=new g.Logger("AwaitQueue"),w=function(){return v(function e(){p(this,e),y(this,"pendingTasks",new Map),y(this,"nextTaskId",0),k.debug("constructor()")},[{key:"size",get:function(){return this.pendingTasks.size}},{key:"push",value:function(){var e=l(t().m(function e(n,o,a){var u=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(o=null!=o?o:n.name,k.debug("push() [name:".concat(o,", options:%o]"),a),"function"==typeof n){e.n=1;break}throw new TypeError("given task is not a function");case 1:if(o)try{Object.defineProperty(n,"name",{value:o})}catch(t){}return e.a(2,new Promise(function(e,t){if(o&&null!=a&&a.removeOngoingTasksWithSameName){var c,f=i(u.pendingTasks.values());try{for(f.s();!(c=f.n()).done;){var s=c.value;s.name===o&&s.reject(new h.AwaitQueueRemovedTaskError,{canExecuteNextTask:!1})}}catch(p){f.e(p)}finally{f.f()}}var l={id:u.nextTaskId++,task:n,name:o,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:function(t){if(!l.completed){l.completed=!0,u.pendingTasks.delete(l.id),k.debug("resolving task [name:".concat(l.name,"]")),e(t);var n=r(u.pendingTasks.values(),1)[0];n&&!n.executedAt&&u.execute(n)}},reject:function(e,n){var o=n.canExecuteNextTask;if(!l.completed&&(l.completed=!0,u.pendingTasks.delete(l.id),k.debug("rejecting task [name:".concat(l.name,"]: %s"),String(e)),t(e),o)){var a=r(u.pendingTasks.values(),1)[0];a&&!a.executedAt&&u.execute(a)}}};u.pendingTasks.set(l.id,l),1===u.pendingTasks.size&&u.execute(l)}))}},e)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"stop",value:function(){k.debug("stop()");var e,t=i(this.pendingTasks.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;k.debug("stop() | stopping task [name:".concat(n.name,"]")),n.reject(new h.AwaitQueueStoppedError,{canExecuteNextTask:!1})}}catch(r){t.e(r)}finally{t.f()}}},{key:"remove",value:function(e){k.debug("remove() [taskIdx:".concat(e,"]"));var t=Array.from(this.pendingTasks.values())[e];t?t.reject(new h.AwaitQueueRemovedTaskError,{canExecuteNextTask:!0}):k.debug("stop() | no task with given idx [taskIdx:".concat(e,"]"))}},{key:"dump",value:function(){var e=Date.now(),t=0;return Array.from(this.pendingTasks.values()).map(function(n){return{idx:t++,task:n.task,name:n.name,enqueuedTime:n.executedAt?n.executedAt-n.enqueuedAt:e-n.enqueuedAt,executionTime:n.executedAt?e-n.executedAt:0}})}},{key:"execute",value:function(){var e=l(t().m(function e(n){var r,o;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(k.debug("execute() [name:".concat(n.name,"]")),!n.executedAt){e.n=1;break}throw new Error("task already being executed");case 1:return n.executedAt=Date.now(),e.p=2,e.n=3,n.task();case 3:r=e.v,n.resolve(r),e.n=5;break;case 4:e.p=4,o=e.v,n.reject(o,{canExecuteNextTask:!0});case 5:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()}])}();exports.AwaitQueue=w;
},{"./Logger":"wyFv","./errors":"hOev"}],"OGUt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AwaitQueueRemovedTaskError=exports.AwaitQueueStoppedError=exports.AwaitQueue=void 0;var e=require("./AwaitQueue");Object.defineProperty(exports,"AwaitQueue",{enumerable:!0,get:function(){return e.AwaitQueue}});var r=require("./errors");Object.defineProperty(exports,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return r.AwaitQueueStoppedError}}),Object.defineProperty(exports,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return r.AwaitQueueRemovedTaskError}});
},{"./AwaitQueue":"NgqB","./errors":"hOev"}],"dKU8":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function c(t,o,a,i){var c=o&&o.prototype instanceof u?o:u,f=Object.create(c.prototype);return r(f,"_invoke",function(t,r,o){var a,i,c,u=0,f=o||[],l=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,c=e,d.n=r,s}};function p(t,r){for(i=t,c=r,n=0;!l&&u&&!o&&n<f.length;n++){var o,a=f[n],p=d.p,h=a[2];t>3?(o=h===r)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=t<2&&p<a[1])?(i=0,d.v=r,d.n=a[1]):p<h&&(o=t<3||a[0]>r||r>h)&&(a[4]=t,a[5]=r,d.n=h,i=0))}if(o||t>1)return s;throw l=!0,r}return function(o,f,h){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,h),i=f,c=h;(n=i<2?e:c)||!l;){a||(i?i<3?(i>1&&(d.n=-1),p(i,c)):d.n=c:d.v=c);try{if(u=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(l=d.n<0)?c:t.call(r,d))!==s)break}catch(n){a=e,i=1,c=n}finally{u=1}}return{value:n,done:l}}}(t,a,i),!0),f}var s={};function u(){}function f(){}function l(){}n=Object.getPrototypeOf;var d=[][a]?n(n([][a]())):(r(n={},a,function(){return this}),n),p=l.prototype=u.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,r(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return f.prototype=l,r(p,"constructor",l),r(l,"constructor",f),f.displayName="GeneratorFunction",r(l,i,"GeneratorFunction"),r(p),r(p,i,"Generator"),r(p,a,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:h}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(r=function(e,t,n,o){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))})(e,t,n,o)}function n(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function c(e){n(i,o,a,c,s,"next",e)}function s(e){n(i,o,a,c,s,"throw",e)}c(void 0)})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function c(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,r){return t=y(t),u(e,l()?Reflect.construct(t,r||[],y(e).constructor):t.apply(e,r))}function u(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(l=function(){return!!e})()}function d(e,t,r,n){var o=p(y(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=h(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(null,arguments)}function h(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,r){return(t=k(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(t){var r=m(t,"string");return"symbol"==e(r)?r:r+""}function m(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Producer=void 0;var w=require("./Logger"),g=require("./enhancedEvents"),P=require("./errors"),E=new w.Logger("Producer"),O=function(r){function n(e){var t,r=e.id,o=e.localId,i=e.rtpSender,c=e.track,u=e.rtpParameters,f=e.stopTracks,l=e.disableTrackOnPause,d=e.zeroRtpOnPause,p=e.appData;return a(this,n),_(t=s(this,n),"_id",void 0),_(t,"_localId",void 0),_(t,"_closed",!1),_(t,"_rtpSender",void 0),_(t,"_track",void 0),_(t,"_kind",void 0),_(t,"_rtpParameters",void 0),_(t,"_paused",void 0),_(t,"_maxSpatialLayer",void 0),_(t,"_stopTracks",void 0),_(t,"_disableTrackOnPause",void 0),_(t,"_zeroRtpOnPause",void 0),_(t,"_appData",void 0),_(t,"_observer",new g.EnhancedEventEmitter),E.debug("constructor()"),t._id=r,t._localId=o,t._rtpSender=i,t._track=c,t._kind=c.kind,t._rtpParameters=u,t._paused=!!l&&!c.enabled,t._maxSpatialLayer=void 0,t._stopTracks=f,t._disableTrackOnPause=l,t._zeroRtpOnPause=d,t._appData=null!=p?p:{},t.onTrackEnded=t.onTrackEnded.bind(t),t.handleTrack(),t}return v(n,g.EnhancedEventEmitter),c(n,[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpSender",get:function(){return this._rtpSender}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"maxSpatialLayer",get:function(){return this._maxSpatialLayer}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(E.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),d(n,"close",this,3)([]),this._observer.close())}},{key:"transportClosed",value:function(){this._closed||(E.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:function(){var e=o(t().m(function e(){var r=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(!this._closed){e.n=1;break}throw new P.InvalidStateError("closed");case 1:return e.a(2,new Promise(function(e,t){r.safeEmit("@getstats",e,t)}))}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){var e=this;E.debug("pause()"),this._closed?E.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise(function(t,r){e.safeEmit("@pause",t,r)}).catch(function(){}),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){var e=this;E.debug("resume()"),this._closed?E.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise(function(t,r){e.safeEmit("@resume",t,r)}).catch(function(){}),this._observer.safeEmit("resume"))}},{key:"replaceTrack",value:function(){var e=o(t().m(function e(r){var n,o=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(n=r.track,E.debug("replaceTrack() [track:%o]",n),!this._closed){e.n=1;break}if(n&&this._stopTracks)try{n.stop()}catch(t){}throw new P.InvalidStateError("closed");case 1:if(!n||"ended"!==n.readyState){e.n=2;break}throw new P.InvalidStateError("track ended");case 2:if(n!==this._track){e.n=3;break}return E.debug("replaceTrack() | same track, ignored"),e.a(2);case 3:return e.n=4,new Promise(function(e,t){o.safeEmit("@replacetrack",n,e,t)});case 4:this.destroyTrack(),this._track=n,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack();case 5:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=o(t().m(function e(r){var n=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(!this._closed){e.n=1;break}throw new P.InvalidStateError("closed");case 1:if("video"===this._kind){e.n=2;break}throw new P.UnsupportedError("not a video Producer");case 2:if("number"==typeof r){e.n=3;break}throw new TypeError("invalid spatialLayer");case 3:if(r!==this._maxSpatialLayer){e.n=4;break}return e.a(2);case 4:return e.n=5,new Promise(function(e,t){n.safeEmit("@setmaxspatiallayer",r,e,t)}).catch(function(){});case 5:this._maxSpatialLayer=r;case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var r=o(t().m(function r(n){var o=this;return t().w(function(t){for(;;)switch(t.n){case 0:if(!this._closed){t.n=1;break}throw new P.InvalidStateError("closed");case 1:if("object"===e(n)){t.n=2;break}throw new TypeError("invalid params");case 2:return t.n=3,new Promise(function(e,t){o.safeEmit("@setrtpencodingparameters",n,e,t)});case 3:return t.a(2)}},r,this)}));return function(e){return r.apply(this,arguments)}}()},{key:"onTrackEnded",value:function(){E.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}])}();exports.Producer=O;
},{"./Logger":"andi","./enhancedEvents":"HRyP","./errors":"hNUz"}],"QQSC":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",u=o.toStringTag||"@@toStringTag";function c(t,o,i,u){var c=o&&o.prototype instanceof s?o:s,f=Object.create(c.prototype);return r(f,"_invoke",function(t,r,o){var i,u,c,s=0,f=o||[],l=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,u=0,c=e,d.n=r,a}};function p(t,r){for(u=t,c=r,n=0;!l&&s&&!o&&n<f.length;n++){var o,i=f[n],p=d.p,y=i[2];t>3?(o=y===r)&&(c=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(u=0,d.v=r,d.n=i[1]):p<y&&(o=t<3||i[0]>r||r>y)&&(i[4]=t,i[5]=r,d.n=y,u=0))}if(o||t>1)return a;throw l=!0,r}return function(o,f,y){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,y),u=f,c=y;(n=u<2?e:c)||!l;){i||(u?u<3?(u>1&&(d.n=-1),p(u,c)):d.n=c:d.v=c);try{if(s=2,i){if(u||(o="next"),n=i[o]){if(!(n=n.call(i,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,u<2&&(u=0)}else 1===u&&(n=i.return)&&n.call(i),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((n=(l=d.n<0)?c:t.call(r,d))!==a)break}catch(n){i=e,u=1,c=n}finally{s=1}}return{value:n,done:l}}}(t,i,u),!0),f}var a={};function s(){}function f(){}function l(){}n=Object.getPrototypeOf;var d=[][i]?n(n([][i]())):(r(n={},i,function(){return this}),n),p=l.prototype=s.prototype=Object.create(d);function y(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,r(e,u,"GeneratorFunction")),e.prototype=Object.create(p),e}return f.prototype=l,r(p,"constructor",l),r(l,"constructor",f),f.displayName="GeneratorFunction",r(l,u,"GeneratorFunction"),r(p),r(p,u,"Generator"),r(p,i,function(){return this}),r(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:y}})()}function r(e,t,n,o){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(r=function(e,t,n,o){function u(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(u("next",0),u("throw",1),u("return",2))})(e,t,n,o)}function n(e,t,r,n,o,i,u){try{var c=e[i](u),a=c.value}catch(e){return void r(e)}c.done?t(a):Promise.resolve(a).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var u=e.apply(t,r);function c(e){n(u,o,i,c,a,"next",e)}function a(e){n(u,o,i,c,a,"throw",e)}c(void 0)})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function c(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return t=v(t),s(e,l()?Reflect.construct(t,r||[],v(e).constructor):t.apply(e,r))}function s(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(l=function(){return!!e})()}function d(e,t,r,n){var o=p(v(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=y(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(null,arguments)}function y(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(t){var r=k(t,"string");return"symbol"==e(r)?r:r+""}function k(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Consumer=void 0;var g=require("./Logger"),w=require("./enhancedEvents"),E=require("./errors"),O=new g.Logger("Consumer"),P=function(e){function r(e){var t,n=e.id,o=e.localId,u=e.producerId,c=e.rtpReceiver,s=e.track,f=e.rtpParameters,l=e.appData;return i(this,r),_(t=a(this,r),"_id",void 0),_(t,"_localId",void 0),_(t,"_producerId",void 0),_(t,"_closed",!1),_(t,"_rtpReceiver",void 0),_(t,"_track",void 0),_(t,"_rtpParameters",void 0),_(t,"_paused",void 0),_(t,"_appData",void 0),_(t,"_observer",new w.EnhancedEventEmitter),O.debug("constructor()"),t._id=n,t._localId=o,t._producerId=u,t._rtpReceiver=c,t._track=s,t._rtpParameters=f,t._paused=!s.enabled,t._appData=null!=l?l:{},t.onTrackEnded=t.onTrackEnded.bind(t),t.handleTrack(),t}return h(r,w.EnhancedEventEmitter),c(r,[{key:"id",get:function(){return this._id}},{key:"localId",get:function(){return this._localId}},{key:"producerId",get:function(){return this._producerId}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"rtpReceiver",get:function(){return this._rtpReceiver}},{key:"track",get:function(){return this._track}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"paused",get:function(){return this._paused}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(O.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"),d(r,"close",this,3)([]),this._observer.close())}},{key:"transportClosed",value:function(){this._closed||(O.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"getStats",value:function(){var e=o(t().m(function e(){var r=this;return t().w(function(e){for(;;)switch(e.n){case 0:if(!this._closed){e.n=1;break}throw new E.InvalidStateError("closed");case 1:return e.a(2,new Promise(function(e,t){r.safeEmit("@getstats",e,t)}))}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"pause",value:function(){O.debug("pause()"),this._closed?O.error("pause() | Consumer closed"):this._paused?O.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}},{key:"resume",value:function(){O.debug("resume()"),this._closed?O.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):O.debug("resume() | Consumer is already resumed")}},{key:"onTrackEnded",value:function(){O.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}},{key:"handleTrack",value:function(){this._track.addEventListener("ended",this.onTrackEnded)}},{key:"destroyTrack",value:function(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}])}();exports.Consumer=P;
},{"./Logger":"andi","./enhancedEvents":"HRyP","./errors":"hNUz"}],"Z0Ve":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,y(r.key),r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return t=f(t),a(e,u()?Reflect.construct(t,n||[],f(e).constructor):t.apply(e,n))}function a(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(u=function(){return!!e})()}function s(e,t,n,r){var o=c(f(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=l(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}}).apply(null,arguments)}function l(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(t){var n=b(t,"string");return"symbol"==e(n)?n:n+""}function b(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataProducer=void 0;var v=require("./Logger"),_=require("./enhancedEvents"),m=require("./errors"),g=new v.Logger("DataProducer"),C=function(e){function n(e){var r,a=e.id,i=e.dataChannel,u=e.sctpStreamParameters,s=e.appData;return t(this,n),h(r=o(this,n),"_id",void 0),h(r,"_dataChannel",void 0),h(r,"_closed",!1),h(r,"_sctpStreamParameters",void 0),h(r,"_appData",void 0),h(r,"_observer",new _.EnhancedEventEmitter),g.debug("constructor()"),r._id=a,r._dataChannel=i,r._sctpStreamParameters=u,r._appData=null!=s?s:{},r.handleDataChannel(),r}return d(n,_.EnhancedEventEmitter),r(n,[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"bufferedAmount",get:function(){return this._dataChannel.bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._dataChannel.bufferedAmountLowThreshold},set:function(e){this._dataChannel.bufferedAmountLowThreshold=e}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(g.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),s(n,"close",this,3)([]),this._observer.close())}},{key:"transportClosed",value:function(){this._closed||(g.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"send",value:function(e){if(g.debug("send()"),this._closed)throw new m.InvalidStateError("closed");this._dataChannel.send(e)}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",function(){e._closed||(g.debug('DataChannel "open" event'),e.safeEmit("open"))}),this._dataChannel.addEventListener("error",function(t){var n,r;if(!e._closed){var o,a=null!==(n=t.error)&&void 0!==n?n:new Error("unknown DataChannel error");if("sctp-failure"===(null===(r=t.error)||void 0===r?void 0:r.errorDetail))g.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",null===(o=t.error)||void 0===o?void 0:o.sctpCauseCode,t.error.message);else g.error('DataChannel "error" event: %o',a);e.safeEmit("error",a)}}),this._dataChannel.addEventListener("close",function(){e._closed||(g.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",function(){e._closed||g.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",function(){e._closed||e.safeEmit("bufferedamountlow")})}}])}();exports.DataProducer=C;
},{"./Logger":"andi","./enhancedEvents":"HRyP","./errors":"hNUz"}],"g5am":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,r){return t=f(t),a(e,c()?Reflect.construct(t,r||[],f(e).constructor):t.apply(e,r))}function a(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}function u(e,t,r,n){var o=s(f(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function s(){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=l(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}}).apply(null,arguments)}function l(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function h(e,t,r){return(t=y(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(t){var r=b(t,"string");return"symbol"==e(r)?r:r+""}function b(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.DataConsumer=void 0;var v=require("./Logger"),_=require("./enhancedEvents"),m=new v.Logger("DataConsumer"),g=function(e){function r(e){var n,a=e.id,i=e.dataProducerId,c=e.dataChannel,u=e.sctpStreamParameters,s=e.appData;return t(this,r),h(n=o(this,r),"_id",void 0),h(n,"_dataProducerId",void 0),h(n,"_dataChannel",void 0),h(n,"_closed",!1),h(n,"_sctpStreamParameters",void 0),h(n,"_appData",void 0),h(n,"_observer",new _.EnhancedEventEmitter),m.debug("constructor()"),n._id=a,n._dataProducerId=i,n._dataChannel=c,n._sctpStreamParameters=u,n._appData=null!=s?s:{},n.handleDataChannel(),n}return d(r,_.EnhancedEventEmitter),n(r,[{key:"id",get:function(){return this._id}},{key:"dataProducerId",get:function(){return this._dataProducerId}},{key:"closed",get:function(){return this._closed}},{key:"sctpStreamParameters",get:function(){return this._sctpStreamParameters}},{key:"readyState",get:function(){return this._dataChannel.readyState}},{key:"label",get:function(){return this._dataChannel.label}},{key:"protocol",get:function(){return this._dataChannel.protocol}},{key:"binaryType",get:function(){return this._dataChannel.binaryType},set:function(e){this._dataChannel.binaryType=e}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){this._closed||(m.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"),u(r,"close",this,3)([]),this._observer.close())}},{key:"transportClosed",value:function(){this._closed||(m.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}},{key:"handleDataChannel",value:function(){var e=this;this._dataChannel.addEventListener("open",function(){e._closed||(m.debug('DataChannel "open" event'),e.safeEmit("open"))}),this._dataChannel.addEventListener("error",function(t){var r,n;if(!e._closed){var o,a=null!==(r=t.error)&&void 0!==r?r:new Error("unknown DataChannel error");if("sctp-failure"===(null===(n=t.error)||void 0===n?void 0:n.errorDetail))m.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",null===(o=t.error)||void 0===o?void 0:o.sctpCauseCode,t.error.message);else m.error('DataChannel "error" event: %o',a);e.safeEmit("error",a)}}),this._dataChannel.addEventListener("close",function(){e._closed||(m.warn('DataChannel "close" event'),e._closed=!0,e.emit("@close"),e.safeEmit("close"),e._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",function(t){e._closed||e.safeEmit("message",t.data)})}}])}();exports.DataConsumer=g;
},{"./Logger":"andi","./enhancedEvents":"HRyP"}],"BHpp":[function(require,module,exports) {
"use strict";function e(e){return t(e)||n(e)||d(e)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function t(e){if(Array.isArray(e))return l(e)}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){var e,r,n="function"==typeof Symbol?Symbol:{},t=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(n,t,o,a){var s=t&&t.prototype instanceof u?t:u,d=Object.create(s.prototype);return i(d,"_invoke",function(n,t,o){var a,i,s,u=0,d=o||[],l=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(r,n){return a=r,i=0,s=e,p.n=n,c}};function f(n,t){for(i=n,s=t,r=0;!l&&u&&!o&&r<d.length;r++){var o,a=d[r],f=p.p,h=a[2];n>3?(o=h===t)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=n<2&&f<a[1])?(i=0,p.v=t,p.n=a[1]):f<h&&(o=n<3||a[0]>t||t>h)&&(a[4]=n,a[5]=t,p.n=h,i=0))}if(o||n>1)return c;throw l=!0,t}return function(o,d,h){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&f(d,h),i=d,s=h;(r=i<2?e:s)||!l;){a||(i?i<3?(i>1&&(p.n=-1),f(i,s)):p.n=s:p.v=s);try{if(u=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,s)))throw TypeError("iterator result is not an object");if(!r.done)return r;s=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(l=p.n<0)?s:n.call(t,p))!==c)break}catch(r){a=e,i=1,s=r}finally{u=1}}return{value:r,done:l}}}(n,o,a),!0),d}var c={};function u(){}function d(){}function l(){}r=Object.getPrototypeOf;var p=[][t]?r(r([][t]())):(i(r={},t,function(){return this}),r),f=l.prototype=u.prototype=Object.create(p);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,i(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=l,i(f,"constructor",l),i(l,"constructor",d),d.displayName="GeneratorFunction",i(l,o,"GeneratorFunction"),i(f),i(f,o,"Generator"),i(f,t,function(){return this}),i(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:h}})()}function i(e,r,n,t){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(i=function(e,r,n,t){function a(r,n){i(e,r,function(e){return this._invoke(r,n,e)})}r?o?o(e,r,{value:n,enumerable:!t,configurable:!t,writable:!t}):e[r]=n:(a("next",0),a("throw",1),a("return",2))})(e,r,n,t)}function s(e,r,n,t,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?r(c):Promise.resolve(c).then(t,o)}function c(e){return function(){var r=this,n=arguments;return new Promise(function(t,o){var a=e.apply(r,n);function i(e){s(a,t,o,i,c,"next",e)}function c(e){s(a,t,o,i,c,"throw",e)}i(void 0)})}}function u(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0,o=function(){};return{s:o,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function d(e,r){if(e){if("string"==typeof e)return l(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,r):void 0}}function l(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=Array(r);n<r;n++)t[n]=e[n];return t}function p(e,r,n){return r=w(r),f(e,m()?Reflect.construct(r,n||[],w(e).constructor):r.apply(e,n))}function f(e,r){if(r&&("object"==o(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(m=function(){return!!e})()}function v(e,r,n,t){var o=y(w(1&t?e.prototype:e),r,n);return 2&t&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,r,n){var t=g(e,r);if(t){var o=Object.getOwnPropertyDescriptor(t,r);return o.get?o.get.call(arguments.length<3?e:n):o.value}}).apply(null,arguments)}function g(e,r){for(;!{}.hasOwnProperty.call(e,r)&&null!==(e=w(e)););return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&_(e,r)}function _(e,r){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function P(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,E(t.key),t)}}function C(e,r,n){return r&&P(e.prototype,r),n&&P(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function k(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function S(e,r,n){return(r=E(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function E(e){var r=I(e,"string");return"symbol"==o(r)?r:r+""}function I(e,r){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var t=n.call(e,r||"default");if("object"!=o(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transport=void 0;var T=require("awaitqueue"),R=require("./Logger"),D=require("./enhancedEvents"),O=require("./errors"),j=require("./utils"),x=require("./ortc"),M=require("./Producer"),A=require("./Consumer"),Q=require("./DataProducer"),z=require("./DataConsumer"),q=new R.Logger("Transport"),B=C(function e(r){var n=this;k(this,e),S(this,"consumerOptions",void 0),S(this,"promise",void 0),S(this,"resolve",void 0),S(this,"reject",void 0),this.consumerOptions=r,this.promise=new Promise(function(e,r){n.resolve=e,n.reject=r})}),G=function(r){function n(e){var r,t,o=e.direction,a=e.id,i=e.iceParameters,s=e.iceCandidates,c=e.dtlsParameters,u=e.sctpParameters,d=e.iceServers,l=e.iceTransportPolicy,f=e.additionalSettings,h=e.appData,m=e.handlerFactory,v=e.getSendExtendedRtpCapabilities,y=e.recvRtpCapabilities,g=e.canProduceByKind;k(this,n),S(t=p(this,n),"_id",void 0),S(t,"_closed",!1),S(t,"_direction",void 0),S(t,"_getSendExtendedRtpCapabilities",void 0),S(t,"_recvRtpCapabilities",void 0),S(t,"_canProduceByKind",void 0),S(t,"_maxSctpMessageSize",void 0),S(t,"_handler",void 0),S(t,"_iceGatheringState","new"),S(t,"_connectionState","new"),S(t,"_appData",void 0),S(t,"_producers",new Map),S(t,"_consumers",new Map),S(t,"_dataProducers",new Map),S(t,"_dataConsumers",new Map),S(t,"_probatorConsumerCreated",!1),S(t,"_awaitQueue",new T.AwaitQueue),S(t,"_pendingConsumerTasks",[]),S(t,"_consumerCreationInProgress",!1),S(t,"_pendingPauseConsumers",new Map),S(t,"_consumerPauseInProgress",!1),S(t,"_pendingResumeConsumers",new Map),S(t,"_consumerResumeInProgress",!1),S(t,"_pendingCloseConsumers",new Map),S(t,"_consumerCloseInProgress",!1),S(t,"_observer",new D.EnhancedEventEmitter),q.debug("constructor() [id:%s, direction:%s]",a,o),t._id=a,t._direction=o,t._getSendExtendedRtpCapabilities=v,t._recvRtpCapabilities=y,t._canProduceByKind=g,t._maxSctpMessageSize=u?u.maxMessageSize:null;var w=null!==(r=j.clone(f))&&void 0!==r?r:{};return delete w.iceServers,delete w.iceTransportPolicy,delete w.bundlePolicy,delete w.rtcpMuxPolicy,t._handler=m.factory({direction:o,iceParameters:i,iceCandidates:s,dtlsParameters:c,sctpParameters:u,iceServers:d,iceTransportPolicy:l,additionalSettings:w,getSendExtendedRtpCapabilities:t._getSendExtendedRtpCapabilities}),t._appData=null!=h?h:{},t.handleHandler(),t}return b(n,D.EnhancedEventEmitter),C(n,[{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"handler",get:function(){return this._handler}},{key:"iceGatheringState",get:function(){return this._iceGatheringState}},{key:"connectionState",get:function(){return this._connectionState}},{key:"appData",get:function(){return this._appData},set:function(e){this._appData=e}},{key:"observer",get:function(){return this._observer}},{key:"close",value:function(){if(!this._closed){q.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";var e,r=u(this._producers.values());try{for(r.s();!(e=r.n()).done;){e.value.transportClosed()}}catch(d){r.e(d)}finally{r.f()}this._producers.clear();var t,o=u(this._consumers.values());try{for(o.s();!(t=o.n()).done;){t.value.transportClosed()}}catch(d){o.e(d)}finally{o.f()}this._consumers.clear();var a,i=u(this._dataProducers.values());try{for(i.s();!(a=i.n()).done;){a.value.transportClosed()}}catch(d){i.e(d)}finally{i.f()}this._dataProducers.clear();var s,c=u(this._dataConsumers.values());try{for(c.s();!(s=c.n()).done;){s.value.transportClosed()}}catch(d){c.e(d)}finally{c.f()}this._dataConsumers.clear(),this._observer.safeEmit("close"),v(n,"close",this,3)([]),this._observer.close()}}},{key:"getStats",value:function(){var e=c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if(!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:return e.a(2,this._handler.getTransportStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=c(a().m(function e(r){var n,t=this;return a().w(function(e){for(;;)switch(e.n){case 0:if(n=r.iceParameters,q.debug("restartIce()"),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if(n){e.n=2;break}throw new TypeError("missing iceParameters");case 2:return e.a(2,this._awaitQueue.push(c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,t._handler.restartIce(n);case 1:return e.a(2,e.v)}},e)})),"transport.restartIce()"))}},e,this)}));return function(r){return e.apply(this,arguments)}}()},{key:"updateIceServers",value:function(){var e=c(a().m(function e(){var r,n,t=this,o=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=o.length>0&&void 0!==o[0]?o[0]:{},n=r.iceServers,q.debug("updateIceServers()"),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if(Array.isArray(n)){e.n=2;break}throw new TypeError("missing iceServers");case 2:return e.a(2,this._awaitQueue.push(c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.a(2,t._handler.updateIceServers(n))}},e)})),"transport.updateIceServers()"))}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"produce",value:function(){var e=c(a().m(function e(){var r,n,t,i,s,u,d,l,p,f,h,m,v,y,g=this,w=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=w.length>0&&void 0!==w[0]?w[0]:{},n=r.track,t=r.encodings,i=r.codecOptions,s=r.codec,u=r.stopTracks,d=void 0===u||u,l=r.disableTrackOnPause,p=void 0===l||l,f=r.zeroRtpOnPause,h=void 0!==f&&f,m=r.onRtpSender,v=r.appData,y=void 0===v?{}:v,q.debug("produce() [track:%o]",n),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if(n){e.n=2;break}throw new TypeError("missing track");case 2:if("send"===this._direction){e.n=3;break}throw new O.UnsupportedError("not a sending Transport");case 3:if(this._canProduceByKind[n.kind]){e.n=4;break}throw new O.UnsupportedError("cannot produce ".concat(n.kind));case 4:if("ended"!==n.readyState){e.n=5;break}throw new O.InvalidStateError("track ended");case 5:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.n=6;break}throw new TypeError('no "connect" listener set into this transport');case 6:if(0!==this.listenerCount("produce")){e.n=7;break}throw new TypeError('no "produce" listener set into this transport');case 7:if(!y||"object"===o(y)){e.n=8;break}throw new TypeError("if given, appData must be an object");case 8:return e.a(2,this._awaitQueue.push(c(a().m(function e(){var r,o,c,u,l,f,v,w,b;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!t||Array.isArray(t)){e.n=1;break}throw TypeError("encodings must be an array");case 1:t&&0===t.length?r=void 0:t&&(r=t.map(function(e){var r={active:!0};return!1===e.active&&(r.active=!1),"boolean"==typeof e.dtx&&(r.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(r.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(r.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(r.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(r.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(r.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(r.priority=e.priority),"string"==typeof e.networkPriority&&(r.networkPriority=e.networkPriority),r}));case 2:return e.n=3,g._handler.send({track:n,encodings:r,codecOptions:i,codec:s,onRtpSender:m});case 3:return o=e.v,c=o.localId,u=o.rtpParameters,l=o.rtpSender,e.p=4,x.validateAndNormalizeRtpParameters(u),e.n=5,new Promise(function(e,r){g.safeEmit("produce",{kind:n.kind,rtpParameters:u,appData:y},e,r)});case 5:return f=e.v,v=f.id,w=new M.Producer({id:v,localId:c,rtpSender:l,track:n,rtpParameters:u,stopTracks:d,disableTrackOnPause:p,zeroRtpOnPause:h,appData:y}),g._producers.set(w.id,w),g.handleProducer(w),g._observer.safeEmit("newproducer",w),e.a(2,w);case 6:throw e.p=6,b=e.v,g._handler.stopSending(c).catch(function(){}),b;case 7:return e.a(2)}},e,null,[[4,6]])})),"transport.produce()").catch(function(e){if(d)try{n.stop()}catch(r){}throw e}))}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"consume",value:function(){var e=c(a().m(function e(r){var n,t,i,s,c,u,d,l,p,f,h=this;return a().w(function(e){for(;;)switch(e.n){case 0:if(n=r.id,t=r.producerId,i=r.kind,s=r.rtpParameters,c=r.streamId,u=r.onRtpReceiver,d=r.appData,l=void 0===d?{}:d,q.debug("consume()"),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if("recv"===this._direction){e.n=2;break}throw new O.UnsupportedError("not a receiving Transport");case 2:if("string"==typeof n){e.n=3;break}throw new TypeError("missing id");case 3:if("string"==typeof t){e.n=4;break}throw new TypeError("missing producerId");case 4:if("audio"===i||"video"===i){e.n=5;break}throw new TypeError("invalid kind '".concat(i,"'"));case 5:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.n=6;break}throw new TypeError('no "connect" listener set into this transport');case 6:if(!l||"object"===o(l)){e.n=7;break}throw new TypeError("if given, appData must be an object");case 7:if(p=j.clone(s),x.canReceive(p,this._recvRtpCapabilities)){e.n=8;break}throw new O.UnsupportedError("cannot consume this Producer");case 8:return f=new B({id:n,producerId:t,kind:i,rtpParameters:p,streamId:c,onRtpReceiver:u,appData:l}),this._pendingConsumerTasks.push(f),queueMicrotask(function(){h._closed||!1===h._consumerCreationInProgress&&h.createPendingConsumers()}),e.a(2,f.promise)}},e,this)}));return function(r){return e.apply(this,arguments)}}()},{key:"produceData",value:function(){var e=c(a().m(function e(){var r,n,t,i,s,u,d,l,p,f,h,m=this,v=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=v.length>0&&void 0!==v[0]?v[0]:{},n=r.ordered,t=void 0===n||n,i=r.maxPacketLifeTime,s=r.maxRetransmits,u=r.label,d=void 0===u?"":u,l=r.protocol,p=void 0===l?"":l,f=r.appData,h=void 0===f?{}:f,q.debug("produceData()"),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if("send"===this._direction){e.n=2;break}throw new O.UnsupportedError("not a sending Transport");case 2:if(this._maxSctpMessageSize){e.n=3;break}throw new O.UnsupportedError("SCTP not enabled by remote Transport");case 3:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.n=4;break}throw new TypeError('no "connect" listener set into this transport');case 4:if(0!==this.listenerCount("producedata")){e.n=5;break}throw new TypeError('no "producedata" listener set into this transport');case 5:if(!h||"object"===o(h)){e.n=6;break}throw new TypeError("if given, appData must be an object");case 6:return(i||s)&&(t=!1),e.a(2,this._awaitQueue.push(c(a().m(function e(){var r,n,o,c,u,l;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m._handler.sendDataChannel({ordered:t,maxPacketLifeTime:i,maxRetransmits:s,label:d,protocol:p});case 1:return r=e.v,n=r.dataChannel,o=r.sctpStreamParameters,x.validateAndNormalizeSctpStreamParameters(o),e.n=2,new Promise(function(e,r){m.safeEmit("producedata",{sctpStreamParameters:o,label:d,protocol:p,appData:h},e,r)});case 2:return c=e.v,u=c.id,l=new Q.DataProducer({id:u,dataChannel:n,sctpStreamParameters:o,appData:h}),m._dataProducers.set(l.id,l),m.handleDataProducer(l),m._observer.safeEmit("newdataproducer",l),e.a(2,l)}},e)})),"transport.produceData()"))}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"consumeData",value:function(){var e=c(a().m(function e(r){var n,t,i,s,u,d,l,p,f,h,m=this;return a().w(function(e){for(;;)switch(e.n){case 0:if(n=r.id,t=r.dataProducerId,i=r.sctpStreamParameters,s=r.label,u=void 0===s?"":s,d=r.protocol,l=void 0===d?"":d,p=r.appData,f=void 0===p?{}:p,q.debug("consumeData()"),!this._closed){e.n=1;break}throw new O.InvalidStateError("closed");case 1:if("recv"===this._direction){e.n=2;break}throw new O.UnsupportedError("not a receiving Transport");case 2:if(this._maxSctpMessageSize){e.n=3;break}throw new O.UnsupportedError("SCTP not enabled by remote Transport");case 3:if("string"==typeof n){e.n=4;break}throw new TypeError("missing id");case 4:if("string"==typeof t){e.n=5;break}throw new TypeError("missing dataProducerId");case 5:if(0!==this.listenerCount("connect")||"new"!==this._connectionState){e.n=6;break}throw new TypeError('no "connect" listener set into this transport');case 6:if(!f||"object"===o(f)){e.n=7;break}throw new TypeError("if given, appData must be an object");case 7:return h=j.clone(i),x.validateAndNormalizeSctpStreamParameters(h),e.a(2,this._awaitQueue.push(c(a().m(function e(){var r,o,i;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,m._handler.receiveDataChannel({sctpStreamParameters:h,label:u,protocol:l});case 1:return r=e.v,o=r.dataChannel,i=new z.DataConsumer({id:n,dataProducerId:t,dataChannel:o,sctpStreamParameters:h,appData:f}),m._dataConsumers.set(i.id,i),m.handleDataConsumer(i),m._observer.safeEmit("newdataconsumer",i),e.a(2,i)}},e)})),"transport.consumeData()"))}},e,this)}));return function(r){return e.apply(this,arguments)}}()},{key:"createPendingConsumers",value:function(){var r=this;this._consumerCreationInProgress=!0,this._awaitQueue.push(c(a().m(function n(){var t,o,i,s,c,d,l,p,f,h,m,v,y,g,w,b,_,P,C,k,S,E,I,T,R,D,O,j,M,Q,z;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:if(0!==r._pendingConsumerTasks.length){n.n=1;break}return q.debug("createPendingConsumers() | there is no Consumer to be created"),n.a(2);case 1:t=e(r._pendingConsumerTasks),r._pendingConsumerTasks=[],o=void 0,i=[],s=u(t);try{for(s.s();!(c=s.n()).done;)d=c.value,l=d.consumerOptions,p=l.id,f=l.kind,h=l.rtpParameters,m=l.streamId,v=l.onRtpReceiver,i.push({trackId:p,kind:f,rtpParameters:h,streamId:m,onRtpReceiver:v})}catch(a){s.e(a)}finally{s.f()}return n.p=2,n.n=3,r._handler.receive(i);case 3:for(y=n.v,g=0;g<y.length;++g)w=t[g],b=y[g],_=w.consumerOptions,P=_.id,C=_.producerId,k=_.kind,S=_.rtpParameters,E=_.appData,I=b.localId,T=b.rtpReceiver,R=b.track,D=new A.Consumer({id:P,localId:I,producerId:C,rtpReceiver:T,track:R,rtpParameters:S,appData:E}),r._consumers.set(D.id,D),r.handleConsumer(D),r._probatorConsumerCreated||o||"video"!==k||(o=D),r._observer.safeEmit("newconsumer",D),w.resolve(D);n.n=5;break;case 4:n.p=4,Q=n.v,O=u(t);try{for(O.s();!(j=O.n()).done;)j.value.reject(Q)}catch(a){O.e(a)}finally{O.f()}case 5:if(!o){n.n=9;break}return n.p=6,M=x.generateProbatorRtpParameters(o.rtpParameters),n.n=7,r._handler.receive([{trackId:"probator",kind:"video",rtpParameters:M}]);case 7:q.debug("createPendingConsumers() | Consumer for RTP probation created"),r._probatorConsumerCreated=!0,n.n=9;break;case 8:n.p=8,z=n.v,q.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",z);case 9:return n.a(2)}},n,null,[[6,8],[2,4]])})),"transport.createPendingConsumers()").then(function(){r._consumerCreationInProgress=!1,r._pendingConsumerTasks.length>0&&r.createPendingConsumers()}).catch(function(){})}},{key:"pausePendingConsumers",value:function(){var e=this;this._consumerPauseInProgress=!0,this._awaitQueue.push(c(a().m(function r(){var n,t,o;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:if(0!==e._pendingPauseConsumers.size){r.n=1;break}return q.debug("pausePendingConsumers() | there is no Consumer to be paused"),r.a(2);case 1:return n=Array.from(e._pendingPauseConsumers.values()),e._pendingPauseConsumers.clear(),r.p=2,t=n.map(function(e){return e.localId}),r.n=3,e._handler.pauseReceiving(t);case 3:r.n=5;break;case 4:r.p=4,o=r.v,q.error("pausePendingConsumers() | failed to pause Consumers:",o);case 5:return r.a(2)}},r,null,[[2,4]])})),"transport.pausePendingConsumers()").then(function(){e._consumerPauseInProgress=!1,e._pendingPauseConsumers.size>0&&e.pausePendingConsumers()}).catch(function(){})}},{key:"resumePendingConsumers",value:function(){var e=this;this._consumerResumeInProgress=!0,this._awaitQueue.push(c(a().m(function r(){var n,t,o;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:if(0!==e._pendingResumeConsumers.size){r.n=1;break}return q.debug("resumePendingConsumers() | there is no Consumer to be resumed"),r.a(2);case 1:return n=Array.from(e._pendingResumeConsumers.values()),e._pendingResumeConsumers.clear(),r.p=2,t=n.map(function(e){return e.localId}),r.n=3,e._handler.resumeReceiving(t);case 3:r.n=5;break;case 4:r.p=4,o=r.v,q.error("resumePendingConsumers() | failed to resume Consumers:",o);case 5:return r.a(2)}},r,null,[[2,4]])})),"transport.resumePendingConsumers()").then(function(){e._consumerResumeInProgress=!1,e._pendingResumeConsumers.size>0&&e.resumePendingConsumers()}).catch(function(){})}},{key:"closePendingConsumers",value:function(){var e=this;this._consumerCloseInProgress=!0,this._awaitQueue.push(c(a().m(function r(){var n,t;return a().w(function(r){for(;;)switch(r.p=r.n){case 0:if(0!==e._pendingCloseConsumers.size){r.n=1;break}return q.debug("closePendingConsumers() | there is no Consumer to be closed"),r.a(2);case 1:return n=Array.from(e._pendingCloseConsumers.values()),e._pendingCloseConsumers.clear(),r.p=2,r.n=3,e._handler.stopReceiving(n.map(function(e){return e.localId}));case 3:r.n=5;break;case 4:r.p=4,t=r.v,q.error("closePendingConsumers() | failed to close Consumers:",t);case 5:return r.a(2)}},r,null,[[2,4]])})),"transport.closePendingConsumers()").then(function(){e._consumerCloseInProgress=!1,e._pendingCloseConsumers.size>0&&e.closePendingConsumers()}).catch(function(){})}},{key:"handleHandler",value:function(){var e=this,r=this._handler;r.on("@connect",function(r,n,t){var o=r.dtlsParameters;e._closed?t(new O.InvalidStateError("closed")):e.safeEmit("connect",{dtlsParameters:o},n,t)}),r.on("@icegatheringstatechange",function(r){r!==e._iceGatheringState&&(q.debug("ICE gathering state changed to %s",r),e._iceGatheringState=r,e._closed||e.safeEmit("icegatheringstatechange",r))}),r.on("@icecandidateerror",function(r){q.warn("ICE candidate error [url:".concat(r.url,", localAddress:").concat(r.address,", localPort:").concat(r.port,"]: ").concat(r.errorCode,' "').concat(r.errorText,'"')),e.safeEmit("icecandidateerror",r)}),r.on("@connectionstatechange",function(r){r!==e._connectionState&&(q.debug("connection state changed to %s",r),e._connectionState=r,e._closed||e.safeEmit("connectionstatechange",r))})}},{key:"handleProducer",value:function(e){var r=this;e.on("@close",function(){r._producers.delete(e.id),r._closed||r._awaitQueue.push(c(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,r._handler.stopSending(e.localId);case 1:return n.a(2,n.v)}},n)})),"producer @close event").catch(function(e){return q.warn("producer.close() failed:%o",e)})}),e.on("@pause",function(n,t){r._awaitQueue.push(c(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,r._handler.pauseSending(e.localId);case 1:return n.a(2,n.v)}},n)})),"producer @pause event").then(n).catch(t)}),e.on("@resume",function(n,t){r._awaitQueue.push(c(a().m(function n(){return a().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,r._handler.resumeSending(e.localId);case 1:return n.a(2,n.v)}},n)})),"producer @resume event").then(n).catch(t)}),e.on("@replacetrack",function(n,t,o){r._awaitQueue.push(c(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,r._handler.replaceTrack(e.localId,n);case 1:return t.a(2,t.v)}},t)})),"producer @replacetrack event").then(t).catch(o)}),e.on("@setmaxspatiallayer",function(n,t,o){r._awaitQueue.push(c(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,r._handler.setMaxSpatialLayer(e.localId,n);case 1:return t.a(2,t.v)}},t)})),"producer @setmaxspatiallayer event").then(t).catch(o)}),e.on("@setrtpencodingparameters",function(n,t,o){r._awaitQueue.push(c(a().m(function t(){return a().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,r._handler.setRtpEncodingParameters(e.localId,n);case 1:return t.a(2,t.v)}},t)})),"producer @setrtpencodingparameters event").then(t).catch(o)}),e.on("@getstats",function(n,t){if(r._closed)return t(new O.InvalidStateError("closed"));r._handler.getSenderStats(e.localId).then(n).catch(t)})}},{key:"handleConsumer",value:function(e){var r=this;e.on("@close",function(){r._consumers.delete(e.id),r._pendingPauseConsumers.delete(e.id),r._pendingResumeConsumers.delete(e.id),r._closed||(r._pendingCloseConsumers.set(e.id,e),!1===r._consumerCloseInProgress&&r.closePendingConsumers())}),e.on("@pause",function(){r._pendingResumeConsumers.has(e.id)&&r._pendingResumeConsumers.delete(e.id),r._pendingPauseConsumers.set(e.id,e),queueMicrotask(function(){r._closed||!1===r._consumerPauseInProgress&&r.pausePendingConsumers()})}),e.on("@resume",function(){r._pendingPauseConsumers.has(e.id)&&r._pendingPauseConsumers.delete(e.id),r._pendingResumeConsumers.set(e.id,e),queueMicrotask(function(){r._closed||!1===r._consumerResumeInProgress&&r.resumePendingConsumers()})}),e.on("@getstats",function(n,t){if(r._closed)return t(new O.InvalidStateError("closed"));r._handler.getReceiverStats(e.localId).then(n).catch(t)})}},{key:"handleDataProducer",value:function(e){var r=this;e.on("@close",function(){r._dataProducers.delete(e.id)})}},{key:"handleDataConsumer",value:function(e){var r=this;e.on("@close",function(){r._dataConsumers.delete(e.id)})}}])}();exports.Transport=G;
},{"awaitqueue":"OGUt","./Logger":"andi","./enhancedEvents":"HRyP","./errors":"hNUz","./utils":"fnp2","./ortc":"y0TR","./Producer":"dKU8","./Consumer":"QQSC","./DataProducer":"Z0Ve","./DataConsumer":"g5am"}],"VF80":[function(require,module,exports) {
var e=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var r="candidate:%s %d %s %d %s %d typ %s";return r+=null!=e.raddr?" raddr %s rport %d":"%v%v",r+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(r+=" generation %d"),r+=null!=e["network-id"]?" network-id %d":"%v",r+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var r="ssrc:%d";return null!=e.attribute&&(r+=" %s",null!=e.value&&(r+=":%s")),r}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var r="mediaclk:";return r+=null!=e.id?"id=%s %s":"%v%s",r+=null!=e.mediaClockValue?"=%s":"",r+=null!=e.rateNumerator?" rate=%s":"",r+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(e).forEach(function(r){e[r].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});
},{}],"pJ4u":[function(require,module,exports) {
var r=function(r){return String(Number(r))===r?Number(r):r},t=function(t,e,n,s){if(s&&!n)e[s]=r(t[1]);else for(var a=0;a<n.length;a+=1)null!=t[a+1]&&(e[n[a]]=r(t[a+1]))},e=function(r,e,n){var s=r.name&&r.names;r.push&&!e[r.push]?e[r.push]=[]:s&&!e[r.name]&&(e[r.name]={});var a=r.push?{}:s?e[r.name]:e;t(n.match(r.reg),a,r.names,r.name),r.push&&e[r.push].push(a)},n=require("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(r){var t={},a=[],p=t;return r.split(/(\r\n|\r|\n)/).filter(s).forEach(function(r){var t=r[0],s=r.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),p=a[a.length-1]);for(var u=0;u<(n[t]||[]).length;u+=1){var i=n[t][u];if(i.reg.test(s))return e(i,p,s)}}),t.media=a,t};var a=function(t,e){var n=e.split(/=(.+)/,2);return 2===n.length?t[n[0]]=r(n[1]):1===n.length&&e.length>1&&(t[n[0]]=void 0),t};exports.parseParams=function(r){return r.split(/;\s?/).reduce(a,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(r){return r.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(t){for(var e=[],n=t.split(" ").map(r),s=0;s<n.length;s+=3)e.push({component:n[s],ip:n[s+1],port:n[s+2]});return e},exports.parseImageAttributes=function(r){return r.split(" ").map(function(r){return r.substring(1,r.length-1).split(",").reduce(a,{})})},exports.parseSimulcastStreamList=function(t){return t.split(";").map(function(t){return t.split(",").map(function(t){var e,n=!1;return"~"!==t[0]?e=r(t):(e=r(t.substring(1,t.length)),n=!0),{scid:e,paused:n}})})};
},{"./grammar":"VF80"}],"dFSN":[function(require,module,exports) {
var n=require("./grammar"),r=/%[sdv%]/g,a=function(n){var a=1,u=arguments,e=u.length;return n.replace(r,function(n){if(a>=e)return n;var r=u[a];switch(a+=1,n){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},u=function(n,r,u){var e=[n+"="+(r.format instanceof Function?r.format(r.push?u:u[r.name]):r.format)];if(r.names)for(var o=0;o<r.names.length;o+=1){var s=r.names[o];r.name?e.push(u[r.name][s]):e.push(u[r.names[o]])}else e.push(u[r.name]);return a.apply(null,e)},e=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];module.exports=function(r,a){a=a||{},null==r.version&&(r.version=0),null==r.name&&(r.name=" "),r.media.forEach(function(n){null==n.payloads&&(n.payloads="")});var s=a.outerOrder||e,t=a.innerOrder||o,i=[];return s.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})}),r.media.forEach(function(r){i.push(u("m",n.m[0],r)),t.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})})}),i.join("\r\n")+"\r\n"};
},{"./grammar":"VF80"}],"CfIM":[function(require,module,exports) {
var r=require("./parser"),e=require("./writer"),a=require("./grammar");exports.grammar=a,exports.write=e,exports.parse=r.parse,exports.parseParams=r.parseParams,exports.parseFmtpConfig=r.parseFmtpConfig,exports.parsePayloads=r.parsePayloads,exports.parseRemoteCandidates=r.parseRemoteCandidates,exports.parseImageAttributes=r.parseImageAttributes,exports.parseSimulcastStreamList=r.parseSimulcastStreamList;
},{"./parser":"pJ4u","./writer":"dFSN","./grammar":"VF80"}],"LIqw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=r;var e=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function r(r){var a=e.exec(null!=r?r:"");return a?{spatialLayers:Number(a[1]),temporalLayers:Number(a[2])}:{spatialLayers:1,temporalLayers:1}}
},{}],"p5WR":[function(require,module,exports) {
"use strict";function e(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=r(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return l=e.done,e},e:function(e){c=!0,i=e},f:function(){try{l||null==a.return||a.return()}finally{if(c)throw i}}}}function r(e,r){if(e){if("string"==typeof e)return t(e,r);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}}function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=Array(r);t<r;t++)a[t]=e[t];return a}Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractRtpCapabilities=n,exports.extractDtlsParameters=o,exports.getCname=i,exports.applyCodecParameters=l;var a=require("sdp-transform");function n(r){var t,n=r.sdpObject,o=new Map,i=new Map,l=e(n.media);try{for(l.s();!(t=l.n()).done;){var c,f,u,s=t.value,p=s.type;switch(p){case"audio":case"video":break;default:continue}var d,v=e(s.rtp);try{for(v.s();!(d=v.n()).done;){var y=d.value,m={kind:p,mimeType:"".concat(p,"/").concat(y.codec),preferredPayloadType:y.payload,clockRate:y.rate,channels:y.encoding,parameters:{},rtcpFeedback:[]};o.set(m.preferredPayloadType,m)}}catch(D){v.e(D)}finally{v.f()}var h,b=e(null!==(c=s.fmtp)&&void 0!==c?c:[]);try{for(b.s();!(h=b.n()).done;){var g=h.value,w=a.parseParams(g.config),k=o.get(g.payload);k&&(null!=w&&w.hasOwnProperty("profile-level-id")&&(w["profile-level-id"]=String(w["profile-level-id"])),k.parameters=w)}}catch(D){b.e(D)}finally{b.f()}var x,P=e(null!==(f=s.rtcpFb)&&void 0!==f?f:[]);try{for(P.s();!(x=P.n()).done;){var T=x.value,j={type:T.type,parameter:T.subtype};if(j.parameter||delete j.parameter,"*"!==T.payload){var A=o.get(Number(T.payload));if(!A)continue;A.rtcpFeedback.push(j)}else{var O,S=e(o.values());try{for(S.s();!(O=S.n()).done;){var M=O.value;M.kind!==p||/.+\/rtx$/i.test(M.mimeType)||M.rtcpFeedback.push(j)}}catch(D){S.e(D)}finally{S.f()}}}}catch(D){P.e(D)}finally{P.f()}var C,I=e(null!==(u=s.ext)&&void 0!==u?u:[]);try{for(I.s();!(C=I.n()).done;){var E=C.value;if(!E["encrypt-uri"]){var F={kind:p,uri:E.uri,preferredId:E.value};i.set(F.preferredId,F)}}}catch(D){I.e(D)}finally{I.f()}}}catch(D){l.e(D)}finally{l.f()}return{codecs:Array.from(o.values()),headerExtensions:Array.from(i.values())}}function o(e){var r,t=e.sdpObject,a=t.setup,n=t.fingerprint;if(!a||!n){var o,i=(null!==(o=t.media)&&void 0!==o?o:[]).find(function(e){return 0!==e.port});i&&(a=null!=a?a:i.setup,n=null!=n?n:i.fingerprint)}if(!a)throw new Error("no a=setup found at SDP session or media level");if(!n)throw new Error("no a=fingerprint found at SDP session or media level");switch(a){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function i(e){var r,t=(null!==(r=e.offerMediaObject.ssrcs)&&void 0!==r?r:[]).find(function(e){return"cname"===e.attribute});return t?t.value:""}function l(r){var t,n=r.offerRtpParameters,o=r.answerMediaObject,i=e(n.codecs);try{var l=function(){var e,r,n=t.value,i=n.mimeType.toLowerCase();if("audio/opus"!==i)return 0;if(!(null!==(e=o.rtp)&&void 0!==e?e:[]).find(function(e){return e.payload===n.payloadType}))return 0;o.fmtp=null!==(r=o.fmtp)&&void 0!==r?r:[];var l=o.fmtp.find(function(e){return e.payload===n.payloadType});l||(l={payload:n.payloadType,config:""},o.fmtp.push(l));var c=a.parseParams(l.config);switch(i){case"audio/opus":var f,u=null===(f=n.parameters)||void 0===f?void 0:f["sprop-stereo"];void 0!==u&&(c.stereo=Number(u)?1:0)}l.config="";for(var s=0,p=Object.keys(c);s<p.length;s++){var d=p[s];l.config&&(l.config+=";"),l.config+="".concat(d,"=").concat(c[d])}};for(i.s();!(t=i.n()).done;)l()}catch(c){i.e(c)}finally{i.f()}}
},{"sdp-transform":"CfIM"}],"C7JJ":[function(require,module,exports) {
"use strict";function r(r,a){return n(r)||e(r,a)||s(r,a)||t()}function t(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function e(r,t){var e=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=e){var n,a,s,o,i=[],u=!0,c=!1;try{if(s=(e=e.call(r)).next,0===t){if(Object(e)!==e)return;u=!1}else for(;!(u=(n=s.call(e)).done)&&(i.push(n.value),i.length!==t);u=!0);}catch(r){c=!0,a=r}finally{try{if(!u&&null!=e.return&&(o=e.return(),Object(o)!==o))return}finally{if(c)throw a}}return i}}function n(r){if(Array.isArray(r))return r}function a(r,t){var e="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!e){if(Array.isArray(r)||(e=s(r))||t&&r&&"number"==typeof r.length){e&&(r=e);var n=0,a=function(){};return{s:a,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){e=e.call(r)},n:function(){var r=e.next();return i=r.done,r},e:function(r){u=!0,o=r},f:function(){try{i||null==e.return||e.return()}finally{if(u)throw o}}}}function s(r,t){if(r){if("string"==typeof r)return o(r,t);var e={}.toString.call(r).slice(8,-1);return"Object"===e&&r.constructor&&(e=r.constructor.name),"Map"===e||"Set"===e?Array.from(r):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?o(r,t):void 0}}function o(r,t){(null==t||t>r.length)&&(t=r.length);for(var e=0,n=Array(t);e<t;e++)n[e]=r[e];return n}function i(t){var e,n,s,o=t.offerMediaObject,i=new Set,u=a(null!==(e=o.ssrcs)&&void 0!==e?e:[]);try{for(u.s();!(s=u.n()).done;){var c=s.value.id;c&&i.add(c)}}catch(M){u.e(M)}finally{u.f()}if(0===i.size)throw new Error("no a=ssrc lines found");var l,f=new Map,d=a(null!==(n=o.ssrcGroups)&&void 0!==n?n:[]);try{for(d.s();!(l=d.n()).done;){var v=l.value;if("FID"===v.semantics){var m=v.ssrcs.split(/\s+/),h=Number(m[0]),y=Number(m[1]);i.has(h)&&(i.delete(h),i.delete(y),f.set(h,y))}}}catch(M){d.e(M)}finally{d.f()}var p,b=a(i);try{for(b.s();!(p=b.n()).done;){var w=p.value;f.set(w,void 0)}}catch(M){b.e(M)}finally{b.f()}var g,S=[],j=a(f);try{for(j.s();!(g=j.n()).done;){var I=r(g.value,2),A=I[0],E=I[1],x={ssrc:A};E&&(x.rtx={ssrc:E}),S.push(x)}}catch(M){j.e(M)}finally{j.f()}return S}function u(t){var e,n,a,s=t.offerMediaObject,o=t.numStreams;if(o<=1)throw new TypeError("numStreams must be greater than 1");var i=(null!==(e=s.ssrcs)&&void 0!==e?e:[]).find(function(r){return"msid"===r.attribute});if(!i)throw new Error("a=ssrc line with msid information not found");var u,c=r(i.value.split(" "),2),l=c[0],f=c[1],d=Number(i.id);(null!==(n=s.ssrcGroups)&&void 0!==n?n:[]).some(function(r){if("FID"!==r.semantics)return!1;var t=r.ssrcs.split(/\s+/);return Number(t[0])===d&&(u=Number(t[1]),!0)});var v=(null!==(a=s.ssrcs)&&void 0!==a?a:[]).find(function(r){return"cname"===r.attribute});if(!v)throw new Error("a=ssrc line with cname information not found");for(var m=v.value,h=[],y=[],p=0;p<o;++p)h.push(d+p),u&&y.push(u+p);s.ssrcGroups=[],s.ssrcs=[],s.ssrcGroups.push({semantics:"SIM",ssrcs:h.join(" ")});for(var b=0,w=h;b<w.length;b++){var g=w[b];s.ssrcs.push({id:g,attribute:"cname",value:m}),s.ssrcs.push({id:g,attribute:"msid",value:"".concat(l," ").concat(f)})}for(var S=0;S<y.length;++S){var j=h[S],I=y[S];s.ssrcs.push({id:I,attribute:"cname",value:m}),s.ssrcs.push({id:I,attribute:"msid",value:"".concat(l," ").concat(f)}),s.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(j," ").concat(I)})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRtpEncodings=i,exports.addLegacySimulcast=u;
},{}],"n8go":[function(require,module,exports) {
"use strict";function e(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,u=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw u}}}}function r(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function n(r){var t,n,o=e(null!==(t=r.codecs)&&void 0!==t?t:[]);try{for(o.s();!(n=o.n()).done;){var a,u=n.value;"audio/opus"!==u.mimeType.toLowerCase()&&"audio/multiopus"!==u.mimeType.toLowerCase()||null!==(a=u.rtcpFeedback)&&void 0!==a&&a.some(function(e){return"nack"===e.type&&!e.parameter})||(u.rtcpFeedback||(u.rtcpFeedback=[]),u.rtcpFeedback.push({type:"nack"}))}}catch(i){o.e(i)}finally{o.f()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addNackSupportForOpus=n;
},{}],"SdHv":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,r){return t=c(t),a(e,i()?Reflect.construct(t,r||[],c(e).constructor):t.apply(e,r))}function a(t,a){if(a&&("object"==e(a)||"function"==typeof a))return a;if(void 0!==a)throw new TypeError("Derived constructors may only return object or undefined");return r(t)}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(i=function(){return!!e})()}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}function n(e,t){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=d(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,n=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){n=!0,c=e},f:function(){try{o||null==a.return||a.return()}finally{if(n)throw c}}}}function d(e,t){if(e){if("string"==typeof e)return p(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function m(e,t,a){return t&&l(e.prototype,t),a&&l(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t,a){return(t=b(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function b(t){var a=y(t,"string");return"symbol"==e(a)?a:a+""}function y(t,a){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,a||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.OfferMediaSection=exports.AnswerMediaSection=exports.MediaSection=void 0;var v=require("sdp-transform"),O=require("../../utils"),j=function(){return m(function e(t){var a=t.iceParameters,r=t.iceCandidates,i=t.dtlsParameters;if(u(this,e),f(this,"_mediaObject",void 0),this._mediaObject={type:"",port:0,protocol:"",payloads:"",rtp:[],fmtp:[]},a&&this.setIceParameters(a),r){this._mediaObject.candidates=[];var c,o=s(r);try{for(o.s();!(c=o.n()).done;){var n,d=c.value,p={foundation:d.foundation,component:1,ip:null!==(n=d.address)&&void 0!==n?n:d.ip,port:d.port,priority:d.priority,transport:d.protocol,type:d.type};d.tcpType&&(p.tcptype=d.tcpType),this._mediaObject.candidates.push(p)}}catch(l){o.e(l)}finally{o.f()}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}i&&this.setDtlsRole(i.role)},[{key:"mid",get:function(){return String(this._mediaObject.mid)}},{key:"closed",get:function(){return 0===this._mediaObject.port}},{key:"getObject",value:function(){return this._mediaObject}},{key:"setIceParameters",value:function(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}},{key:"pause",value:function(){this._mediaObject.direction="inactive"}},{key:"disable",value:function(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}},{key:"close",value:function(){this.disable(),this._mediaObject.port=0}}])}();exports.MediaSection=j;var _=function(e){function a(e){var r,i=e.iceParameters,c=e.iceCandidates,o=e.dtlsParameters,n=e.sctpParameters,d=e.plainRtpParameters,p=e.offerMediaObject,l=e.offerRtpParameters,m=e.answerRtpParameters,f=e.codecOptions;switch(u(this,a),(r=t(this,a,[{iceParameters:i,iceCandidates:c,dtlsParameters:o}]))._mediaObject.mid=String(p.mid),r._mediaObject.type=p.type,r._mediaObject.protocol=p.protocol,d?(r._mediaObject.connection={ip:d.ip,version:d.ipVersion},r._mediaObject.port=d.port):(r._mediaObject.connection={ip:"127.0.0.1",version:4},r._mediaObject.port=7),p.type){case"audio":case"video":r._mediaObject.direction="recvonly",r._mediaObject.rtp=[],r._mediaObject.rtcpFb=[],r._mediaObject.fmtp=[];var b,y=s(m.codecs);try{var v=function(){var e,t,a=b.value,i={payload:a.payloadType,codec:g(a),rate:a.clockRate};a.channels>1&&(i.encoding=a.channels),r._mediaObject.rtp.push(i);var c=null!==(e=O.clone(a.parameters))&&void 0!==e?e:{},o=null!==(t=O.clone(a.rtcpFeedback))&&void 0!==t?t:[];if(f){var n=f.opusStereo,d=f.opusFec,p=f.opusDtx,u=f.opusMaxPlaybackRate,m=f.opusMaxAverageBitrate,y=f.opusPtime,v=f.opusNack,j=f.videoGoogleStartBitrate,_=f.videoGoogleMaxBitrate,h=f.videoGoogleMinBitrate,x=l.codecs.find(function(e){return e.payloadType===a.payloadType});switch(a.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":void 0!==n&&(x.parameters["sprop-stereo"]=n?1:0,c.stereo=n?1:0),void 0!==d&&(x.parameters.useinbandfec=d?1:0,c.useinbandfec=d?1:0),void 0!==p&&(x.parameters.usedtx=p?1:0,c.usedtx=p?1:0),void 0!==u&&(c.maxplaybackrate=u),void 0!==m&&(c.maxaveragebitrate=m),void 0!==y&&(x.parameters.ptime=y,c.ptime=y),v||(x.rtcpFeedback=x.rtcpFeedback.filter(function(e){return"nack"!==e.type||e.parameter}),o=o.filter(function(e){return"nack"!==e.type||e.parameter}));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":void 0!==j&&(c["x-google-start-bitrate"]=j),void 0!==_&&(c["x-google-max-bitrate"]=_),void 0!==h&&(c["x-google-min-bitrate"]=h)}}for(var P={payload:a.payloadType,config:""},w=0,S=Object.keys(c);w<S.length;w++){var k=S[w];P.config&&(P.config+=";"),P.config+="".concat(k,"=").concat(c[k])}P.config&&r._mediaObject.fmtp.push(P);var T,M=s(o);try{for(M.s();!(T=M.n()).done;){var R=T.value;r._mediaObject.rtcpFb.push({payload:a.payloadType,type:R.type,subtype:R.parameter})}}catch(A){M.e(A)}finally{M.f()}};for(y.s();!(b=y.n()).done;)v()}catch(A){y.e(A)}finally{y.f()}r._mediaObject.payloads=m.codecs.map(function(e){return e.payloadType}).join(" "),r._mediaObject.ext=[];var j,_=s(m.headerExtensions);try{var h=function(){var e,t=j.value;if(!(null!==(e=p.ext)&&void 0!==e?e:[]).some(function(e){return e.uri===t.uri}))return 1;r._mediaObject.ext.push({uri:t.uri,value:t.id})};for(_.s();!(j=_.n()).done;)h()}catch(A){_.e(A)}finally{_.f()}if("extmap-allow-mixed"===p.extmapAllowMixed&&(r._mediaObject.extmapAllowMixed="extmap-allow-mixed"),p.simulcast){var x;r._mediaObject.simulcast={dir1:"recv",list1:p.simulcast.list1},r._mediaObject.rids=[];var P,w=s(null!==(x=p.rids)&&void 0!==x?x:[]);try{for(w.s();!(P=w.n()).done;){var S=P.value;"send"===S.direction&&r._mediaObject.rids.push({id:S.id,direction:"recv"})}}catch(A){w.e(A)}finally{w.f()}}else if(p.simulcast_03){var k;r._mediaObject.simulcast_03={value:p.simulcast_03.value.replace(/send/g,"recv")},r._mediaObject.rids=[];var T,M=s(null!==(k=p.rids)&&void 0!==k?k:[]);try{for(M.s();!(T=M.n()).done;){var R=T.value;"send"===R.direction&&r._mediaObject.rids.push({id:R.id,direction:"recv"})}}catch(A){M.e(A)}finally{M.f()}}r._mediaObject.rtcpMux="rtcp-mux",r._mediaObject.rtcpRsize="rtcp-rsize";break;case"application":"number"==typeof p.sctpPort?(r._mediaObject.payloads="webrtc-datachannel",r._mediaObject.sctpPort=n.port,r._mediaObject.maxMessageSize=n.maxMessageSize):p.sctpmap&&(r._mediaObject.payloads=String(n.port),r._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}return r}return o(a,j),m(a,[{key:"setDtlsRole",value:function(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}},{key:"resume",value:function(){this._mediaObject.direction="recvonly"}},{key:"muxSimulcastStreams",value:function(e){var t;if(null!==(t=this._mediaObject.simulcast)&&void 0!==t&&t.list1){var a,r={},i=s(e);try{for(i.s();!(a=i.n()).done;){var c=a.value;c.rid&&(r[c.rid]=c)}}catch(b){i.e(b)}finally{i.f()}var o,n=this._mediaObject.simulcast.list1,d=v.parseSimulcastStreamList(n),p=s(d);try{for(p.s();!(o=p.n()).done;){var u,l=s(o.value);try{for(l.s();!(u=l.n()).done;){var m,f=u.value;f.paused=!(null!==(m=r[f.scid])&&void 0!==m&&m.active)}}catch(b){l.e(b)}finally{l.f()}}}catch(b){p.e(b)}finally{p.f()}this._mediaObject.simulcast.list1=d.map(function(e){return e.map(function(e){return"".concat(e.paused?"~":"").concat(e.scid)}).join(",")}).join(";")}}}])}();exports.AnswerMediaSection=_;var h=function(e){function a(e){var r,i=e.iceParameters,c=e.iceCandidates,o=e.dtlsParameters,n=e.sctpParameters,d=e.plainRtpParameters,p=e.mid,l=e.kind,m=e.offerRtpParameters,f=e.streamId,b=e.trackId;switch(u(this,a),(r=t(this,a,[{iceParameters:i,iceCandidates:c,dtlsParameters:o}]))._mediaObject.mid=String(p),r._mediaObject.type=l,d?(r._mediaObject.connection={ip:d.ip,version:d.ipVersion},r._mediaObject.protocol="RTP/AVP",r._mediaObject.port=d.port):(r._mediaObject.connection={ip:"127.0.0.1",version:4},r._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",r._mediaObject.port=7),r._mediaObject.extmapAllowMixed="extmap-allow-mixed",l){case"audio":case"video":var y;r._mediaObject.direction="sendonly",r._mediaObject.rtp=[],r._mediaObject.rtcpFb=[],r._mediaObject.fmtp=[],r._mediaObject.msid="".concat(null!=f?f:"-"," ").concat(b);var v,O=s(m.codecs);try{for(O.s();!(v=O.n()).done;){var j=v.value,_={payload:j.payloadType,codec:g(j),rate:j.clockRate};j.channels>1&&(_.encoding=j.channels),r._mediaObject.rtp.push(_);for(var h={payload:j.payloadType,config:""},x=0,P=Object.keys(null!==(w=j.parameters)&&void 0!==w?w:{});x<P.length;x++){var w,S=P[x];h.config&&(h.config+=";"),h.config+="".concat(S,"=").concat(j.parameters[S])}h.config&&r._mediaObject.fmtp.push(h);var k,T=s(j.rtcpFeedback);try{for(T.s();!(k=T.n()).done;){var M=k.value;r._mediaObject.rtcpFb.push({payload:j.payloadType,type:M.type,subtype:M.parameter})}}catch(D){T.e(D)}finally{T.f()}}}catch(D){O.e(D)}finally{O.f()}r._mediaObject.payloads=m.codecs.map(function(e){return e.payloadType}).join(" "),r._mediaObject.ext=[];var R,A=s(m.headerExtensions);try{for(A.s();!(R=A.n()).done;){var F=R.value;r._mediaObject.ext.push({uri:F.uri,value:F.id})}}catch(D){A.e(D)}finally{A.f()}r._mediaObject.rtcpMux="rtcp-mux",r._mediaObject.rtcpRsize="rtcp-rsize";var z=m.encodings[0],C=z.ssrc,E=null===(y=z.rtx)||void 0===y?void 0:y.ssrc;r._mediaObject.ssrcs=[],r._mediaObject.ssrcGroups=[],C&&m.rtcp.cname&&r._mediaObject.ssrcs.push({id:C,attribute:"cname",value:m.rtcp.cname}),E&&(m.rtcp.cname&&r._mediaObject.ssrcs.push({id:E,attribute:"cname",value:m.rtcp.cname}),C&&r._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:"".concat(C," ").concat(E)}));break;case"application":r._mediaObject.payloads="webrtc-datachannel",r._mediaObject.sctpPort=n.port,r._mediaObject.maxMessageSize=n.maxMessageSize}return r}return o(a,j),m(a,[{key:"setDtlsRole",value:function(e){this._mediaObject.setup="actpass"}},{key:"resume",value:function(){this._mediaObject.direction="sendonly"}}])}();function g(e){var t=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");return t[2]}exports.OfferMediaSection=h;
},{"sdp-transform":"CfIM","../../utils":"fnp2"}],"vZFf":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,d=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){d=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(d)throw s}}}}function i(e,t){if(e){if("string"==typeof e)return r(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,i){return(t=d(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(t){var i=c(t,"string");return"symbol"==e(i)?i:i+""}function c(t,i){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,i||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RemoteSdp=void 0;var u=require("sdp-transform"),l=require("../../Logger"),m=require("./MediaSection"),f=["av1","h264"],p=new l.Logger("RemoteSdp"),h=function(){return s(function e(t){var i=t.iceParameters,r=t.iceCandidates,n=t.dtlsParameters,s=t.sctpParameters,d=t.plainRtpParameters;if(a(this,e),o(this,"_iceParameters",void 0),o(this,"_iceCandidates",void 0),o(this,"_dtlsParameters",void 0),o(this,"_sctpParameters",void 0),o(this,"_plainRtpParameters",void 0),o(this,"_mediaSections",[]),o(this,"_midToIndex",new Map),o(this,"_firstMid",void 0),o(this,"_sdpObject",void 0),this._iceParameters=i,this._iceCandidates=r,this._dtlsParameters=n,this._sctpParameters=s,this._plainRtpParameters=d,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:"10000",sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},this._sdpObject.iceOptions="ice2",null!=i&&i.iceLite&&(this._sdpObject.icelite="ice-lite"),n){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};var c=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:n.fingerprints[c-1].algorithm,hash:n.fingerprints[c-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}d&&(this._sdpObject.origin.address=d.ip,this._sdpObject.origin.ipVer=d.ipVersion)},[{key:"updateIceParameters",value:function(e){p.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;var i,r=t(this._mediaSections);try{for(r.s();!(i=r.n()).done;){i.value.setIceParameters(e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"updateDtlsRole",value:function(e){p.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;var i,r=t(this._mediaSections);try{for(r.s();!(i=r.n()).done;){i.value.setDtlsRole(e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"setSessionExtmapAllowMixed",value:function(){p.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}},{key:"getNextMediaSectionIdx",value:function(){for(var e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}},{key:"send",value:function(e){var t,i=e.offerMediaObject,r=e.reuseMid,a=e.offerRtpParameters,n=e.answerRtpParameters,s=e.codecOptions,o=new m.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:i,offerRtpParameters:a,answerRtpParameters:n,codecOptions:s}),d=o.getObject();d.rtp.find(function(e){return f.includes(e.codec.toLowerCase())})||(d.ext=null===(t=d.ext)||void 0===t?void 0:t.filter(function(e){return"https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"!==e.uri}));r?this._replaceMediaSection(o,r):this._midToIndex.has(o.mid)?this._replaceMediaSection(o):this._addMediaSection(o)}},{key:"receive",value:function(e){var t=e.mid,i=e.kind,r=e.offerRtpParameters,a=e.streamId,n=e.trackId;this.setSessionExtmapAllowMixed();var s=new m.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,mid:t,kind:i,offerRtpParameters:r,streamId:a,trackId:n}),o=this._mediaSections.find(function(e){return e.closed});o?this._replaceMediaSection(s,o.mid):this._addMediaSection(s)}},{key:"pauseMediaSection",value:function(e){this._findMediaSection(e).pause()}},{key:"resumeSendingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"resumeReceivingMediaSection",value:function(e){this._findMediaSection(e).resume()}},{key:"disableMediaSection",value:function(e){this._findMediaSection(e).disable()}},{key:"closeMediaSection",value:function(e){var t=this._findMediaSection(e);return e===this._firstMid?(p.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}},{key:"muxMediaSectionSimulcast",value:function(e,t){var i=this._findMediaSection(e);i.muxSimulcastStreams(t),this._replaceMediaSection(i)}},{key:"sendSctpAssociation",value:function(e){var t=e.offerMediaObject,i=new m.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:t});this._addMediaSection(i)}},{key:"receiveSctpAssociation",value:function(){var e=new m.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application"});this._addMediaSection(e)}},{key:"getSdp",value:function(){return this._sdpObject.origin.sessionVersion++,u.write(this._sdpObject)}},{key:"_addMediaSection",value:function(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}},{key:"_replaceMediaSection",value:function(e,t){if("string"==typeof t){var i=this._midToIndex.get(t);if(void 0===i)throw new Error("no media section found for reuseMid '".concat(t,"'"));var r=this._mediaSections[i];this._mediaSections[i]=e,this._midToIndex.delete(r.mid),this._midToIndex.set(e.mid,i),this._sdpObject.media[i]=e.getObject(),this._regenerateBundleMids()}else{var a=this._midToIndex.get(e.mid);if(void 0===a)throw new Error("no media section found with mid '".concat(e.mid,"'"));this._mediaSections[a]=e,this._sdpObject.media[a]=e.getObject()}}},{key:"_findMediaSection",value:function(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error("no media section found with mid '".concat(e,"'"));return this._mediaSections[t]}},{key:"_regenerateBundleMids",value:function(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(function(e){return!e.closed}).map(function(e){return e.mid}).join(" "))}}])}();exports.RemoteSdp=h;
},{"sdp-transform":"CfIM","../../Logger":"andi","./MediaSection":"SdHv"}],"X31T":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,c=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw c}}}}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,a){var o=n&&n.prototype instanceof u?n:u,p=Object.create(o.prototype);return c(p,"_invoke",function(r,n,i){var a,c,o,u=0,p=i||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,c=0,o=e,l.n=r,s}};function f(r,n){for(c=r,o=n,t=0;!d&&u&&!i&&t<p.length;t++){var i,a=p[t],f=l.p,h=a[2];r>3?(i=h===n)&&(o=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(c=0,l.v=n,l.n=a[1]):f<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,l.n=h,c=0))}if(i||r>1)return s;throw d=!0,n}return function(i,p,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,h),c=p,o=h;(t=c<2?e:o)||!d;){a||(c?c<3?(c>1&&(l.n=-1),f(c,o)):l.n=o:l.v=o);try{if(u=2,a){if(c||(i="next"),t=a[i]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(o=TypeError("The iterator does not provide a '"+i+"' method"),c=1);a=e}else if((t=(d=l.n<0)?o:r.call(n,l))!==s)break}catch(t){a=e,c=1,o=t}finally{u=1}}return{value:t,done:d}}}(r,i,a),!0),p}var s={};function u(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,c(f,"constructor",d),c(d,"constructor",p),p.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(f),c(f,i,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function c(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function o(e,t,r,n,i,a,c){try{var o=e[a](c),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){o(a,n,i,c,s,"next",e)}function s(e){o(a,n,i,c,s,"throw",e)}c(void 0)})}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return t=_(t),v(e,g()?Reflect.construct(t,r||[],_(e).constructor):t.apply(e,r))}function v(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function b(e,t,r,n){var i=y(_(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(null,arguments)}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(t){var r=C(t,"string");return"symbol"==e(r)?r:r+""}function C(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome111=void 0;var T=require("sdp-transform"),O=require("../enhancedEvents"),P=require("../Logger"),E=require("../ortc"),L=require("../errors"),M=require("../scalabilityModes"),j=require("./sdp/commonUtils"),I=require("./sdp/unifiedPlanUtils"),x=require("./ortc/utils"),N=require("./sdp/RemoteSdp"),A=new P.Logger("Chrome111"),q="Chrome111",G={OS:1024,MIS:1024},F=function(e){function n(e){var t,r=e.direction,i=e.iceParameters,a=e.iceCandidates,c=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,f=e.getSendExtendedRtpCapabilities;return d(this,n),k(t=h(this,n),"_closed",!1),k(t,"_direction",void 0),k(t,"_remoteSdp",void 0),k(t,"_getSendExtendedRtpCapabilities",void 0),k(t,"_forcedLocalDtlsRole",void 0),k(t,"_pc",void 0),k(t,"_mapMidTransceiver",new Map),k(t,"_sendStream",new MediaStream),k(t,"_hasDataChannelMediaSection",!1),k(t,"_nextSendSctpStreamId",0),k(t,"_transportReady",!1),k(t,"onIceGatheringStateChange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),k(t,"onIceCandidateError",function(e){t.emit("@icecandidateerror",e)}),k(t,"onConnectionStateChange",function(){t.emit("@connectionstatechange",t._pc.connectionState)}),k(t,"onIceConnectionStateChange",function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}),A.debug("constructor()"),t._direction=r,t._remoteSdp=new N.RemoteSdp({iceParameters:i,iceCandidates:a,dtlsParameters:c,sctpParameters:o}),t._getSendExtendedRtpCapabilities=f,c.role&&"auto"!==c.role&&(t._forcedLocalDtlsRole="server"===c.role?"client":"server"),t._pc=new RTCPeerConnection(p({iceServers:null!=s?s:[],iceTransportPolicy:null!=u?u:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l)),t._pc.addEventListener("icegatheringstatechange",t.onIceGatheringStateChange),t._pc.addEventListener("icecandidateerror",t.onIceCandidateError),t._pc.connectionState?t._pc.addEventListener("connectionstatechange",t.onConnectionStateChange):(A.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.addEventListener("iceconnectionstatechange",t.onIceConnectionStateChange)),t}return w(n,O.EnhancedEventEmitter),f(n,[{key:"name",get:function(){return q}},{key:"close",value:function(){if(A.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch(e){}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),b(n,"close",this,3)([])}}},{key:"updateIceServers",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),A.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=s(a().m(function e(t){var r,n,i,c;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),A.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.n=1;break}return e.a(2);case 1:if("send"!==this._direction){e.n=5;break}return e.n=2,this._pc.createOffer({iceRestart:!0});case 2:return r=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.n=3,this._pc.setLocalDescription(r);case 3:return n={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.n=4,this._pc.setRemoteDescription(n);case 4:e.n=8;break;case 5:return i={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.n=6,this._pc.setRemoteDescription(i);case 6:return e.n=7,this._pc.createAnswer();case 7:return c=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),e.n=8,this._pc.setLocalDescription(c);case 8:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,this._pc.getStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=s(a().m(function e(t){var i,c,o,s,u,p,d,l,f,h,v,m,g,b,y,S,_,w,R,k,D,C,O;return a().w(function(e){for(;;)switch(e.n){case 0:if(i=t.track,c=t.encodings,o=t.codecOptions,s=t.codec,u=t.onRtpSender,this.assertNotClosed(),this.assertSendDirection(),A.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),c&&c.length>1){p=1,d=r(c);try{for(d.s();!(l=d.n()).done;)f=l.value,(h=f.scalabilityMode?(0,M.parse)(f.scalabilityMode).temporalLayers:3)>p&&(p=h)}catch(a){d.e(a)}finally{d.f()}c.forEach(function(e,t){e.rid="r".concat(t),e.scalabilityMode="L1T".concat(p)})}return v=this._remoteSdp.getNextMediaSectionIdx(),m=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream],sendEncodings:c}),u&&u(m.sender),e.n=1,this._pc.createOffer();case 1:if(g=e.v,(b=T.parse(g.sdp)).extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),y=n.getLocalRtpCapabilities(b),S=this._getSendExtendedRtpCapabilities(y),(_=E.getSendingRtpParameters(i.kind,S)).codecs=E.reduceCodecs(_.codecs,s),(w=E.getSendingRemoteRtpParameters(i.kind,S)).codecs=E.reduceCodecs(w.codecs,s),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(R=this._forcedLocalDtlsRole)&&void 0!==R?R:"client",localSdpObject:b});case 2:return A.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),e.n=3,this._pc.setLocalDescription(g);case 3:return k=m.mid,_.mid=k,b=T.parse(this._pc.localDescription.sdp),D=b.media[v.idx],_.rtcp.cname=j.getCname({offerMediaObject:D}),c?1===c.length?(C=I.getRtpEncodings({offerMediaObject:D}),Object.assign(C[0],c[0]),_.encodings=C):_.encodings=c:_.encodings=I.getRtpEncodings({offerMediaObject:D}),this._remoteSdp.send({offerMediaObject:D,reuseMid:v.reuseMid,offerRtpParameters:_,answerRtpParameters:w,codecOptions:o}),O={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),e.n=4,this._pc.setRemoteDescription(O);case 4:return this._mapMidTransceiver.set(k,m),e.a(2,{localId:k,rtpParameters:_,rtpSender:m.sender})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertSendDirection(),A.debug("stopSending() [localId:%s]",t),!this._closed){e.n=1;break}return e.a(2);case 1:if(r=this._mapMidTransceiver.get(t)){e.n=2;break}throw new Error("associated RTCRtpTransceiver not found");case 2:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(a){}return e.n=3,this._pc.createOffer();case 3:return n=e.v,A.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=4,this._pc.setLocalDescription(n);case 4:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=5,this._pc.setRemoteDescription(i);case 5:this._mapMidTransceiver.delete(t);case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="sendonly",e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=s(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?A.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):A.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.n=2,n.sender.replaceTrack(r);case 2:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){e.active=t<=r}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){i.encodings[t]=p(p({},e),r)}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.sender.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,c=t.label,o=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},A.debug("sendDataChannel() [options:%o]",s),u=this._pc.createDataChannel(c,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%G.MIS,this._hasDataChannelMediaSection){e.n=5;break}return e.n=1,this._pc.createOffer();case 1:if(p=e.v,d=T.parse(p.sdp),l=d.media.find(function(e){return"application"===e.type}),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(f=this._forcedLocalDtlsRole)&&void 0!==f?f:"client",localSdpObject:d});case 2:return A.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.n=3,this._pc.setLocalDescription(p);case 3:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),h={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.n=4,this._pc.setRemoteDescription(h);case 4:this._hasDataChannelMediaSection=!0;case 5:return v={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.a(2,{dataChannel:u,sctpStreamParameters:v})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=s(a().m(function e(n){var i,c,o,s,u,p,d,l,f,h,v,m,g,b,y,S,_,w,R,k,D,C,O,P,E,L,M,I=this;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),i=[],c=new Map,o=r(n);try{for(o.s();!(s=o.n()).done;)p=s.value,d=p.trackId,l=p.kind,f=p.rtpParameters,h=p.streamId,A.debug("receive() [trackId:%s, kind:%s]",d,l),v=null!==(u=f.mid)&&void 0!==u?u:String(this._mapMidTransceiver.size),c.set(d,v),this._remoteSdp.receive({mid:v,kind:l,offerRtpParameters:f,streamId:null!=h?h:f.rtcp.cname,trackId:d})}catch(x){o.e(x)}finally{o.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.n=1,this._pc.setRemoteDescription(m);case 1:g=r(n),e.p=2,y=a().m(function e(){var t,r,n,i,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=b.value,r=t.trackId,!(n=t.onRtpReceiver)){e.n=2;break}if(i=c.get(r),o=I._pc.getTransceivers().find(function(e){return e.mid===i})){e.n=1;break}throw new Error("transceiver not found");case 1:n(o.receiver);case 2:return e.a(2)}},e)}),g.s();case 3:if((b=g.n()).done){e.n=5;break}return e.d(t(y()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,E=e.v,g.e(E);case 7:return e.p=7,g.f(),e.f(7);case 8:return e.n=9,this._pc.createAnswer();case 9:S=e.v,_=T.parse(S.sdp),w=r(n),e.p=10,k=a().m(function e(){var t,r,n,i,o;return a().w(function(e){for(;;)switch(e.n){case 0:t=R.value,r=t.trackId,n=t.rtpParameters,i=c.get(r),o=_.media.find(function(e){return String(e.mid)===i}),j.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 1:return e.a(2)}},e)}),w.s();case 11:if((R=w.n()).done){e.n=13;break}return e.d(t(k()),12);case 12:e.n=11;break;case 13:e.n=15;break;case 14:e.p=14,L=e.v,w.e(L);case 15:return e.p=15,w.f(),e.f(15);case 16:if(S={type:"answer",sdp:T.write(_)},this._transportReady){e.n=17;break}return e.n=17,this.setupTransport({localDtlsRole:null!==(D=this._forcedLocalDtlsRole)&&void 0!==D?D:"client",localSdpObject:_});case 17:return A.debug("receive() | calling pc.setLocalDescription() [answer:%o]",S),e.n=18,this._pc.setLocalDescription(S);case 18:C=r(n),e.p=19,P=a().m(function e(){var t,r,n,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=O.value,r=t.trackId,n=c.get(r),o=I._pc.getTransceivers().find(function(e){return e.mid===n})){e.n=1;break}throw new Error("new RTCRtpTransceiver not found");case 1:I._mapMidTransceiver.set(n,o),i.push({localId:n,track:o.receiver.track,rtpReceiver:o.receiver});case 2:return e.a(2)}},e)}),C.s();case 20:if((O=C.n()).done){e.n=22;break}return e.d(t(P()),21);case 21:e.n=20;break;case 22:e.n=24;break;case 23:e.p=23,M=e.v,C.e(M);case 24:return e.p=24,C.f(),e.f(24);case 25:return e.a(2,i)}},e,this,[[19,23,24,25],[10,14,15,16],[2,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p,d,l,f;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.assertRecvDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:n=r(t),e.p=2,n.s();case 3:if((i=n.n()).done){e.n=6;break}if(c=i.value,A.debug("stopReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:this._remoteSdp.closeMediaSection(o.mid);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,n.e(f);case 8:return e.p=8,n.f(),e.f(8);case 9:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=10,this._pc.setRemoteDescription(s);case 10:return e.n=11,this._pc.createAnswer();case 11:return u=e.v,A.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=12,this._pc.setLocalDescription(u);case 12:p=r(t);try{for(p.s();!(d=p.n()).done;)l=d.value,this._mapMidTransceiver.delete(l)}catch(a){p.e(a)}finally{p.f()}case 13:return e.a(2)}},e,this,[[2,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("pauseReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="inactive",this._remoteSdp.pauseMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("resumeReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.receiver.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),c=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,u=r.maxRetransmits,p={negotiated:!0,id:c,ordered:o,maxPacketLifeTime:s,maxRetransmits:u,protocol:i},A.debug("receiveDataChannel() [options:%o]",p),d=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.n=5;break}return this._remoteSdp.receiveSctpAssociation(),l={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),e.n=1,this._pc.setRemoteDescription(l);case 1:return e.n=2,this._pc.createAnswer();case 2:if(f=e.v,this._transportReady){e.n=3;break}return v=T.parse(f.sdp),e.n=3,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 3:return A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setLocalDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return e.a(2,{dataChannel:d})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=s(a().m(function e(t){var r,n,i,c=this;return a().w(function(e){for(;;)switch(e.n){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=T.parse(this._pc.localDescription.sdp)),(i=j.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.n=1,new Promise(function(e,t){c.safeEmit("@connect",{dtlsParameters:i},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new L.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],[{key:"createFactory",value:function(){return{name:q,factory:function(e){return new n(e)},getNativeRtpCapabilities:function(){var e=s(a().m(function e(){var t,r,i,c,o,s;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return A.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.p=1,t.addTransceiver("audio"),t.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]}),e.n=2,t.createOffer();case 2:r=e.v;try{t.close()}catch(a){}return t=void 0,i=T.parse(r.sdp),c=n.getLocalRtpCapabilities(i),e.a(2,c);case 3:e.p=3,s=e.v;try{null===(o=t)||void 0===o||o.close()}catch(u){}throw t=void 0,s;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return A.debug("getNativeSctpCapabilities()"),e.a(2,{numStreams:G})}},e)}));return function(){return e.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=j.extractRtpCapabilities({sdpObject:e});return E.validateAndNormalizeRtpCapabilities(t),x.addNackSupportForOpus(t),t}}])}();exports.Chrome111=F;
},{"sdp-transform":"CfIM","../enhancedEvents":"HRyP","../Logger":"andi","../ortc":"y0TR","../errors":"hNUz","../scalabilityModes":"LIqw","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./ortc/utils":"n8go","./sdp/RemoteSdp":"vZFf"}],"YvS6":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,c=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw c}}}}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,a){var o=n&&n.prototype instanceof u?n:u,p=Object.create(o.prototype);return c(p,"_invoke",function(r,n,i){var a,c,o,u=0,p=i||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,c=0,o=e,l.n=r,s}};function f(r,n){for(c=r,o=n,t=0;!d&&u&&!i&&t<p.length;t++){var i,a=p[t],f=l.p,h=a[2];r>3?(i=h===n)&&(o=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(c=0,l.v=n,l.n=a[1]):f<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,l.n=h,c=0))}if(i||r>1)return s;throw d=!0,n}return function(i,p,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,h),c=p,o=h;(t=c<2?e:o)||!d;){a||(c?c<3?(c>1&&(l.n=-1),f(c,o)):l.n=o:l.v=o);try{if(u=2,a){if(c||(i="next"),t=a[i]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(o=TypeError("The iterator does not provide a '"+i+"' method"),c=1);a=e}else if((t=(d=l.n<0)?o:r.call(n,l))!==s)break}catch(t){a=e,c=1,o=t}finally{u=1}}return{value:t,done:d}}}(r,i,a),!0),p}var s={};function u(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,c(f,"constructor",d),c(d,"constructor",p),p.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(f),c(f,i,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function c(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function o(e,t,r,n,i,a,c){try{var o=e[a](c),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){o(a,n,i,c,s,"next",e)}function s(e){o(a,n,i,c,s,"throw",e)}c(void 0)})}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){D(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return t=_(t),m(e,g()?Reflect.construct(t,r||[],_(e).constructor):t.apply(e,r))}function m(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function b(e,t,r,n){var i=y(_(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(null,arguments)}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t,r){return(t=k(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k(t){var r=C(t,"string");return"symbol"==e(r)?r:r+""}function C(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Chrome74=void 0;var T=require("sdp-transform"),O=require("../Logger"),P=require("../enhancedEvents"),L=require("../ortc"),M=require("../errors"),E=require("../scalabilityModes"),j=require("./sdp/commonUtils"),x=require("./sdp/unifiedPlanUtils"),I=require("./ortc/utils"),N=require("./sdp/RemoteSdp"),A=new O.Logger("Chrome74"),q="Chrome74",G={OS:1024,MIS:1024},F=function(e){function n(e){var t,r=e.direction,i=e.iceParameters,a=e.iceCandidates,c=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,f=e.getSendExtendedRtpCapabilities;return d(this,n),D(t=h(this,n),"_closed",!1),D(t,"_direction",void 0),D(t,"_remoteSdp",void 0),D(t,"_getSendExtendedRtpCapabilities",void 0),D(t,"_forcedLocalDtlsRole",void 0),D(t,"_pc",void 0),D(t,"_mapMidTransceiver",new Map),D(t,"_sendStream",new MediaStream),D(t,"_hasDataChannelMediaSection",!1),D(t,"_nextSendSctpStreamId",0),D(t,"_transportReady",!1),D(t,"onIceGatheringStateChange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),D(t,"onIceCandidateError",function(e){t.emit("@icecandidateerror",e)}),D(t,"onConnectionStateChange",function(){t.emit("@connectionstatechange",t._pc.connectionState)}),D(t,"onIceConnectionStateChange",function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}),A.debug("constructor()"),t._direction=r,t._remoteSdp=new N.RemoteSdp({iceParameters:i,iceCandidates:a,dtlsParameters:c,sctpParameters:o}),t._getSendExtendedRtpCapabilities=f,c.role&&"auto"!==c.role&&(t._forcedLocalDtlsRole="server"===c.role?"client":"server"),t._pc=new RTCPeerConnection(p({iceServers:null!=s?s:[],iceTransportPolicy:null!=u?u:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l)),t._pc.addEventListener("icegatheringstatechange",t.onIceGatheringStateChange),t._pc.addEventListener("icecandidateerror",t.onIceCandidateError),t._pc.connectionState?t._pc.addEventListener("connectionstatechange",t.onConnectionStateChange):(A.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.addEventListener("iceconnectionstatechange",t.onIceConnectionStateChange)),t}return w(n,P.EnhancedEventEmitter),f(n,[{key:"name",get:function(){return q}},{key:"close",value:function(){if(A.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch(e){}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),b(n,"close",this,3)([])}}},{key:"updateIceServers",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),A.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=s(a().m(function e(t){var r,n,i,c;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),A.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.n=1;break}return e.a(2);case 1:if("send"!==this._direction){e.n=5;break}return e.n=2,this._pc.createOffer({iceRestart:!0});case 2:return r=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.n=3,this._pc.setLocalDescription(r);case 3:return n={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.n=4,this._pc.setRemoteDescription(n);case 4:e.n=8;break;case 5:return i={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.n=6,this._pc.setRemoteDescription(i);case 6:return e.n=7,this._pc.createAnswer();case 7:return c=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),e.n=8,this._pc.setLocalDescription(c);case 8:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,this._pc.getStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=s(a().m(function e(t){var i,c,o,s,u,p,d,l,f,h,m,v,g,b,y,S,_,w,R,D,k,C;return a().w(function(e){for(;;)switch(e.n){case 0:return i=t.track,c=t.encodings,o=t.codecOptions,s=t.codec,this.assertNotClosed(),this.assertSendDirection(),A.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),c&&c.length>1&&c.forEach(function(e,t){e.rid="r".concat(t)}),u=this._remoteSdp.getNextMediaSectionIdx(),p=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream],sendEncodings:c}),e.n=1,this._pc.createOffer();case 1:if(d=e.v,(l=T.parse(d.sdp)).extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),f=n.getLocalRtpCapabilities(l),h=this._getSendExtendedRtpCapabilities(f),(m=L.getSendingRtpParameters(i.kind,h)).codecs=L.reduceCodecs(m.codecs,s),(v=L.getSendingRemoteRtpParameters(i.kind,h)).codecs=L.reduceCodecs(v.codecs,s),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(g=this._forcedLocalDtlsRole)&&void 0!==g?g:"client",localSdpObject:l});case 2:return b=!1,y=(0,E.parse)((null!=c?c:[{}])[0].scalabilityMode),c&&1===c.length&&y.spatialLayers>1&&"video/vp9"===m.codecs[0].mimeType.toLowerCase()&&(A.debug("send() | enabling legacy simulcast for VP9 SVC"),b=!0,l=T.parse(d.sdp),S=l.media[u.idx],x.addLegacySimulcast({offerMediaObject:S,numStreams:y.spatialLayers}),d={type:"offer",sdp:T.write(l)}),A.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.n=3,this._pc.setLocalDescription(d);case 3:if(_=p.mid,m.mid=_,l=T.parse(this._pc.localDescription.sdp),S=l.media[u.idx],m.rtcp.cname=j.getCname({offerMediaObject:S}),c?1===c.length?(w=x.getRtpEncodings({offerMediaObject:S}),Object.assign(w[0],c[0]),b&&(w=[w[0]]),m.encodings=w):m.encodings=c:m.encodings=x.getRtpEncodings({offerMediaObject:S}),m.encodings.length>1&&("video/vp8"===m.codecs[0].mimeType.toLowerCase()||"video/h264"===m.codecs[0].mimeType.toLowerCase())){R=r(m.encodings);try{for(R.s();!(D=R.n()).done;)(k=D.value).scalabilityMode?k.scalabilityMode="L1T".concat(y.temporalLayers):k.scalabilityMode="L1T3"}catch(a){R.e(a)}finally{R.f()}}return this._remoteSdp.send({offerMediaObject:S,reuseMid:u.reuseMid,offerRtpParameters:m,answerRtpParameters:v,codecOptions:o}),C={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("send() | calling pc.setRemoteDescription() [answer:%o]",C),e.n=4,this._pc.setRemoteDescription(C);case 4:return this._mapMidTransceiver.set(_,p),e.a(2,{localId:_,rtpParameters:m,rtpSender:p.sender})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertSendDirection(),A.debug("stopSending() [localId:%s]",t),!this._closed){e.n=1;break}return e.a(2);case 1:if(r=this._mapMidTransceiver.get(t)){e.n=2;break}throw new Error("associated RTCRtpTransceiver not found");case 2:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(a){}return e.n=3,this._pc.createOffer();case 3:return n=e.v,A.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=4,this._pc.setLocalDescription(n);case 4:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=5,this._pc.setRemoteDescription(i);case 5:this._mapMidTransceiver.delete(t);case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="sendonly",e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=s(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?A.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):A.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.n=2,n.sender.replaceTrack(r);case 2:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){e.active=t<=r}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){i.encodings[t]=p(p({},e),r)}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.sender.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h,m;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,c=t.label,o=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},A.debug("sendDataChannel() [options:%o]",s),u=this._pc.createDataChannel(c,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%G.MIS,this._hasDataChannelMediaSection){e.n=5;break}return e.n=1,this._pc.createOffer();case 1:if(p=e.v,d=T.parse(p.sdp),l=d.media.find(function(e){return"application"===e.type}),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(f=this._forcedLocalDtlsRole)&&void 0!==f?f:"client",localSdpObject:d});case 2:return A.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.n=3,this._pc.setLocalDescription(p);case 3:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),h={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.n=4,this._pc.setRemoteDescription(h);case 4:this._hasDataChannelMediaSection=!0;case 5:return m={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.a(2,{dataChannel:u,sctpStreamParameters:m})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=s(a().m(function e(n){var i,c,o,s,u,p,d,l,f,h,m,v,g,b,y,S,_,w,R,D,k,C,O,P=this;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),i=[],c=new Map,o=r(n);try{for(o.s();!(s=o.n()).done;)p=s.value,d=p.trackId,l=p.kind,f=p.rtpParameters,h=p.streamId,A.debug("receive() [trackId:%s, kind:%s]",d,l),m=null!==(u=f.mid)&&void 0!==u?u:String(this._mapMidTransceiver.size),c.set(d,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:f,streamId:null!=h?h:f.rtcp.cname,trackId:d})}catch(L){o.e(L)}finally{o.f()}return v={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),e.n=1,this._pc.setRemoteDescription(v);case 1:return e.n=2,this._pc.createAnswer();case 2:g=e.v,b=T.parse(g.sdp),y=r(n),e.p=3,_=a().m(function e(){var t,r,n,i,o;return a().w(function(e){for(;;)switch(e.n){case 0:t=S.value,r=t.trackId,n=t.rtpParameters,i=c.get(r),o=b.media.find(function(e){return String(e.mid)===i}),j.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o});case 1:return e.a(2)}},e)}),y.s();case 4:if((S=y.n()).done){e.n=6;break}return e.d(t(_()),5);case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,C=e.v,y.e(C);case 8:return e.p=8,y.f(),e.f(8);case 9:if(g={type:"answer",sdp:T.write(b)},this._transportReady){e.n=10;break}return e.n=10,this.setupTransport({localDtlsRole:null!==(w=this._forcedLocalDtlsRole)&&void 0!==w?w:"client",localSdpObject:b});case 10:return A.debug("receive() | calling pc.setLocalDescription() [answer:%o]",g),e.n=11,this._pc.setLocalDescription(g);case 11:R=r(n),e.p=12,k=a().m(function e(){var t,r,n,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=D.value,r=t.trackId,n=c.get(r),o=P._pc.getTransceivers().find(function(e){return e.mid===n})){e.n=1;break}throw new Error("new RTCRtpTransceiver not found");case 1:P._mapMidTransceiver.set(n,o),i.push({localId:n,track:o.receiver.track,rtpReceiver:o.receiver});case 2:return e.a(2)}},e)}),R.s();case 13:if((D=R.n()).done){e.n=15;break}return e.d(t(k()),14);case 14:e.n=13;break;case 15:e.n=17;break;case 16:e.p=16,O=e.v,R.e(O);case 17:return e.p=17,R.f(),e.f(17);case 18:return e.a(2,i)}},e,this,[[12,16,17,18],[3,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p,d,l,f;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.assertRecvDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:n=r(t),e.p=2,n.s();case 3:if((i=n.n()).done){e.n=6;break}if(c=i.value,A.debug("stopReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:this._remoteSdp.closeMediaSection(o.mid);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,n.e(f);case 8:return e.p=8,n.f(),e.f(8);case 9:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=10,this._pc.setRemoteDescription(s);case 10:return e.n=11,this._pc.createAnswer();case 11:return u=e.v,A.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=12,this._pc.setLocalDescription(u);case 12:p=r(t);try{for(p.s();!(d=p.n()).done;)l=d.value,this._mapMidTransceiver.delete(l)}catch(a){p.e(a)}finally{p.f()}case 13:return e.a(2)}},e,this,[[2,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("pauseReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="inactive",this._remoteSdp.pauseMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("resumeReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.receiver.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h,m;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),c=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,u=r.maxRetransmits,p={negotiated:!0,id:c,ordered:o,maxPacketLifeTime:s,maxRetransmits:u,protocol:i},A.debug("receiveDataChannel() [options:%o]",p),d=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.n=5;break}return this._remoteSdp.receiveSctpAssociation(),l={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),e.n=1,this._pc.setRemoteDescription(l);case 1:return e.n=2,this._pc.createAnswer();case 2:if(f=e.v,this._transportReady){e.n=3;break}return m=T.parse(f.sdp),e.n=3,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:m});case 3:return A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setLocalDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return e.a(2,{dataChannel:d})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=s(a().m(function e(t){var r,n,i,c=this;return a().w(function(e){for(;;)switch(e.n){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=T.parse(this._pc.localDescription.sdp)),(i=j.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.n=1,new Promise(function(e,t){c.safeEmit("@connect",{dtlsParameters:i},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new M.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],[{key:"createFactory",value:function(){return{name:q,factory:function(e){return new n(e)},getNativeRtpCapabilities:function(){var e=s(a().m(function e(){var t,r,i,c,o,s;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return A.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.p=1,t.addTransceiver("audio"),t.addTransceiver("video"),e.n=2,t.createOffer();case 2:r=e.v;try{t.close()}catch(a){}return t=void 0,i=T.parse(r.sdp),c=n.getLocalRtpCapabilities(i),e.a(2,c);case 3:e.p=3,s=e.v;try{null===(o=t)||void 0===o||o.close()}catch(u){}throw t=void 0,s;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return A.debug("getNativeSctpCapabilities()"),e.a(2,{numStreams:G})}},e)}));return function(){return e.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=j.extractRtpCapabilities({sdpObject:e});return L.validateAndNormalizeRtpCapabilities(t),I.addNackSupportForOpus(t),t}}])}();exports.Chrome74=F;
},{"sdp-transform":"CfIM","../Logger":"andi","../enhancedEvents":"HRyP","../ortc":"y0TR","../errors":"hNUz","../scalabilityModes":"LIqw","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./ortc/utils":"n8go","./sdp/RemoteSdp":"vZFf"}],"DQOR":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,c=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw c}}}}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function o(r,n,i,a){var o=n&&n.prototype instanceof u?n:u,p=Object.create(o.prototype);return c(p,"_invoke",function(r,n,i){var a,c,o,u=0,p=i||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,c=0,o=e,l.n=r,s}};function f(r,n){for(c=r,o=n,t=0;!d&&u&&!i&&t<p.length;t++){var i,a=p[t],f=l.p,h=a[2];r>3?(i=h===n)&&(o=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(c=0,l.v=n,l.n=a[1]):f<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,l.n=h,c=0))}if(i||r>1)return s;throw d=!0,n}return function(i,p,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,h),c=p,o=h;(t=c<2?e:o)||!d;){a||(c?c<3?(c>1&&(l.n=-1),f(c,o)):l.n=o:l.v=o);try{if(u=2,a){if(c||(i="next"),t=a[i]){if(!(t=t.call(a,o)))throw TypeError("iterator result is not an object");if(!t.done)return t;o=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(o=TypeError("The iterator does not provide a '"+i+"' method"),c=1);a=e}else if((t=(d=l.n<0)?o:r.call(n,l))!==s)break}catch(t){a=e,c=1,o=t}finally{u=1}}return{value:t,done:d}}}(r,i,a),!0),p}var s={};function u(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,c(f,"constructor",d),c(d,"constructor",p),p.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(f),c(f,i,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function c(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function o(e,t,r,n,i,a,c){try{var o=e[a](c),s=o.value}catch(e){return void r(e)}o.done?t(s):Promise.resolve(s).then(n,i)}function s(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){o(a,n,i,c,s,"next",e)}function s(e){o(a,n,i,c,s,"throw",e)}c(void 0)})}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return t=w(t),m(e,g()?Reflect.construct(t,r||[],w(e).constructor):t.apply(e,r))}function m(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function b(e,t,r,n){var i=y(w(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(null,arguments)}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(t){var r=C(t,"string");return"symbol"==e(r)?r:r+""}function C(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Firefox120=void 0;var T=require("sdp-transform"),O=require("../enhancedEvents"),P=require("../Logger"),E=require("../errors"),L=require("../ortc"),M=require("../scalabilityModes"),j=require("./sdp/commonUtils"),x=require("./sdp/unifiedPlanUtils"),I=require("./sdp/RemoteSdp"),N=new P.Logger("Firefox120"),A="Firefox120",q={OS:16,MIS:2048},G=function(e){function n(e){var t,r=e.direction,i=e.iceParameters,a=e.iceCandidates,c=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,f=e.getSendExtendedRtpCapabilities;return d(this,n),k(t=h(this,n),"_closed",!1),k(t,"_direction",void 0),k(t,"_remoteSdp",void 0),k(t,"_getSendExtendedRtpCapabilities",void 0),k(t,"_pc",void 0),k(t,"_mapMidTransceiver",new Map),k(t,"_sendStream",new MediaStream),k(t,"_hasDataChannelMediaSection",!1),k(t,"_nextSendSctpStreamId",0),k(t,"_transportReady",!1),k(t,"onIceGatheringStateChange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),k(t,"onIceCandidateError",function(e){t.emit("@icecandidateerror",e)}),k(t,"onConnectionStateChange",function(){t.emit("@connectionstatechange",t._pc.connectionState)}),k(t,"onIceConnectionStateChange",function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}),N.debug("constructor()"),t._direction=r,t._remoteSdp=new I.RemoteSdp({iceParameters:i,iceCandidates:a,dtlsParameters:c,sctpParameters:o}),t._getSendExtendedRtpCapabilities=f,t._pc=new RTCPeerConnection(p({iceServers:null!=s?s:[],iceTransportPolicy:null!=u?u:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l)),t._pc.addEventListener("icegatheringstatechange",t.onIceGatheringStateChange),t._pc.addEventListener("icecandidateerror",t.onIceCandidateError),t._pc.connectionState?t._pc.addEventListener("connectionstatechange",t.onConnectionStateChange):(N.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.addEventListener("iceconnectionstatechange",t.onIceConnectionStateChange)),t}return _(n,O.EnhancedEventEmitter),f(n,[{key:"name",get:function(){return A}},{key:"close",value:function(){if(N.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch(e){}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),b(n,"close",this,3)([])}}},{key:"updateIceServers",value:function(){var e=s(a().m(function e(t){return a().w(function(e){for(;;)switch(e.n){case 0:throw this.assertNotClosed(),new E.UnsupportedError("not supported");case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=s(a().m(function e(t){var r,n,i,c;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),N.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.n=1;break}return e.a(2);case 1:if("send"!==this._direction){e.n=5;break}return e.n=2,this._pc.createOffer({iceRestart:!0});case 2:return r=e.v,N.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.n=3,this._pc.setLocalDescription(r);case 3:return n={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.n=4,this._pc.setRemoteDescription(n);case 4:e.n=8;break;case 5:return i={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.n=6,this._pc.setRemoteDescription(i);case 6:return e.n=7,this._pc.createAnswer();case 7:return c=e.v,N.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),e.n=8,this._pc.setLocalDescription(c);case 8:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,this._pc.getStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=s(a().m(function e(t){var i,c,o,s,u,p,d,l,f,h,m,v,g,b,y,S,w,_,R,k;return a().w(function(e){for(;;)switch(e.n){case 0:return i=t.track,c=t.encodings,o=t.codecOptions,s=t.codec,u=t.onRtpSender,this.assertNotClosed(),this.assertSendDirection(),N.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),c&&c.length>1&&c.forEach(function(e,t){e.rid="r".concat(t)}),p=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream],sendEncodings:c}),u&&u(p.sender),e.n=1,this._pc.createOffer();case 1:if(d=e.v,(l=T.parse(d.sdp)).extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),f=n.getLocalRtpCapabilities(l),h=this._getSendExtendedRtpCapabilities(f),(m=L.getSendingRtpParameters(i.kind,h)).codecs=L.reduceCodecs(m.codecs,s),(v=L.getSendingRemoteRtpParameters(i.kind,h)).codecs=L.reduceCodecs(v.codecs,s),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:"client",localSdpObject:l});case 2:return g=(0,M.parse)((null!=c?c:[{}])[0].scalabilityMode),N.debug("send() | calling pc.setLocalDescription() [offer:%o]",d),e.n=3,this._pc.setLocalDescription(d);case 3:if(b=p.mid,m.mid=b,l=T.parse(this._pc.localDescription.sdp),y=l.media[l.media.length-1],m.rtcp.cname=j.getCname({offerMediaObject:y}),c?1===c.length?(S=x.getRtpEncodings({offerMediaObject:y}),Object.assign(S[0],c[0]),m.encodings=S):m.encodings=c:m.encodings=x.getRtpEncodings({offerMediaObject:y}),m.encodings.length>1&&("video/vp8"===m.codecs[0].mimeType.toLowerCase()||"video/h264"===m.codecs[0].mimeType.toLowerCase())){w=r(m.encodings);try{for(w.s();!(_=w.n()).done;)(R=_.value).scalabilityMode?R.scalabilityMode="L1T".concat(g.temporalLayers):R.scalabilityMode="L1T3"}catch(a){w.e(a)}finally{w.f()}}return this._remoteSdp.send({offerMediaObject:y,offerRtpParameters:m,answerRtpParameters:v,codecOptions:o}),k={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),e.n=4,this._pc.setRemoteDescription(k);case 4:return this._mapMidTransceiver.set(b,p),e.a(2,{localId:b,rtpParameters:m,rtpSender:p.sender})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertSendDirection(),N.debug("stopSending() [localId:%s]",t),!this._closed){e.n=1;break}return e.a(2);case 1:if(r=this._mapMidTransceiver.get(t)){e.n=2;break}throw new Error("associated transceiver not found");case 2:return r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid),e.n=3,this._pc.createOffer();case 3:return n=e.v,N.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=4,this._pc.setLocalDescription(n);case 4:return i={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=5,this._pc.setRemoteDescription(i);case 5:this._mapMidTransceiver.delete(t);case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),N.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,N.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=s(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),N.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,N.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=s(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?N.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):N.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.n=2,n.sender.replaceTrack(r);case 2:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),N.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated transceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){e.active=t<=r}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,N.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=s(a().m(function e(t,r){var n,i,c,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),N.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){i.encodings[t]=p(p({},e),r)}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,N.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return o={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",o),e.n=5,this._pc.setRemoteDescription(o);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.sender.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,c=t.label,o=t.protocol,this.assertNotClosed(),this.assertSendDirection(),s={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:o},N.debug("sendDataChannel() [options:%o]",s),u=this._pc.createDataChannel(c,s),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%q.MIS,this._hasDataChannelMediaSection){e.n=5;break}return e.n=1,this._pc.createOffer();case 1:if(p=e.v,d=T.parse(p.sdp),l=d.media.find(function(e){return"application"===e.type}),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:"client",localSdpObject:d});case 2:return N.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.n=3,this._pc.setLocalDescription(p);case 3:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),f={type:"answer",sdp:this._remoteSdp.getSdp()},N.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setRemoteDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return h={streamId:s.id,ordered:s.ordered,maxPacketLifeTime:s.maxPacketLifeTime,maxRetransmits:s.maxRetransmits},e.a(2,{dataChannel:u,sctpStreamParameters:h})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=s(a().m(function e(n){var i,c,o,s,u,p,d,l,f,h,m,v,g,b,y,S,w,_,R,k,D,C,O,P,E,L,M=this;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),i=[],c=new Map,o=r(n);try{for(o.s();!(s=o.n()).done;)p=s.value,d=p.trackId,l=p.kind,f=p.rtpParameters,h=p.streamId,N.debug("receive() [trackId:%s, kind:%s]",d,l),m=null!==(u=f.mid)&&void 0!==u?u:String(this._mapMidTransceiver.size),c.set(d,m),this._remoteSdp.receive({mid:m,kind:l,offerRtpParameters:f,streamId:null!=h?h:f.rtcp.cname,trackId:d})}catch(x){o.e(x)}finally{o.f()}return v={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",v),e.n=1,this._pc.setRemoteDescription(v);case 1:g=r(n),e.p=2,y=a().m(function e(){var t,r,n,i,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=b.value,r=t.trackId,!(n=t.onRtpReceiver)){e.n=2;break}if(i=c.get(r),o=M._pc.getTransceivers().find(function(e){return e.mid===i})){e.n=1;break}throw new Error("transceiver not found");case 1:n(o.receiver);case 2:return e.a(2)}},e)}),g.s();case 3:if((b=g.n()).done){e.n=5;break}return e.d(t(y()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,P=e.v,g.e(P);case 7:return e.p=7,g.f(),e.f(7);case 8:return e.n=9,this._pc.createAnswer();case 9:S=e.v,w=T.parse(S.sdp),_=r(n),e.p=10,k=a().m(function e(){var t,r,n,i,o;return a().w(function(e){for(;;)switch(e.n){case 0:t=R.value,r=t.trackId,n=t.rtpParameters,i=c.get(r),o=w.media.find(function(e){return String(e.mid)===i}),j.applyCodecParameters({offerRtpParameters:n,answerMediaObject:o}),S={type:"answer",sdp:T.write(w)};case 1:return e.a(2)}},e)}),_.s();case 11:if((R=_.n()).done){e.n=13;break}return e.d(t(k()),12);case 12:e.n=11;break;case 13:e.n=15;break;case 14:e.p=14,E=e.v,_.e(E);case 15:return e.p=15,_.f(),e.f(15);case 16:if(this._transportReady){e.n=17;break}return e.n=17,this.setupTransport({localDtlsRole:"client",localSdpObject:w});case 17:return N.debug("receive() | calling pc.setLocalDescription() [answer:%o]",S),e.n=18,this._pc.setLocalDescription(S);case 18:D=r(n),e.p=19,O=a().m(function e(){var t,r,n,o;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=C.value,r=t.trackId,n=c.get(r),o=M._pc.getTransceivers().find(function(e){return e.mid===n})){e.n=1;break}throw new Error("new RTCRtpTransceiver not found");case 1:M._mapMidTransceiver.set(n,o),i.push({localId:n,track:o.receiver.track,rtpReceiver:o.receiver});case 2:return e.a(2)}},e)}),D.s();case 20:if((C=D.n()).done){e.n=22;break}return e.d(t(O()),21);case 21:e.n=20;break;case 22:e.n=24;break;case 23:e.p=23,L=e.v,D.e(L);case 24:return e.p=24,D.f(),e.f(24);case 25:return e.a(2,i)}},e,this,[[19,23,24,25],[10,14,15,16],[2,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p,d,l,f;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.assertRecvDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:n=r(t),e.p=2,n.s();case 3:if((i=n.n()).done){e.n=6;break}if(c=i.value,N.debug("stopReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:this._remoteSdp.closeMediaSection(o.mid);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,n.e(f);case 8:return e.p=8,n.f(),e.f(8);case 9:return s={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=10,this._pc.setRemoteDescription(s);case 10:return e.n=11,this._pc.createAnswer();case 11:return u=e.v,N.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=12,this._pc.setLocalDescription(u);case 12:p=r(t);try{for(p.s();!(d=p.n()).done;)l=d.value,this._mapMidTransceiver.delete(l)}catch(a){p.e(a)}finally{p.f()}case 13:return e.a(2)}},e,this,[[2,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,N.debug("pauseReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="inactive",this._remoteSdp.pauseMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,N.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=s(a().m(function e(t){var n,i,c,o,s,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,N.debug("resumeReceiving() [localId:%s]",c),o=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:o.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return s={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),e.n=9,this._pc.setRemoteDescription(s);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,N.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=s(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.receiver.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=s(a().m(function e(t){var r,n,i,c,o,s,u,p,d,l,f,h;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),c=r.streamId,o=r.ordered,s=r.maxPacketLifeTime,u=r.maxRetransmits,p={negotiated:!0,id:c,ordered:o,maxPacketLifeTime:s,maxRetransmits:u,protocol:i},N.debug("receiveDataChannel() [options:%o]",p),d=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.n=5;break}return this._remoteSdp.receiveSctpAssociation(),l={type:"offer",sdp:this._remoteSdp.getSdp()},N.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),e.n=1,this._pc.setRemoteDescription(l);case 1:return e.n=2,this._pc.createAnswer();case 2:if(f=e.v,this._transportReady){e.n=3;break}return h=T.parse(f.sdp),e.n=3,this.setupTransport({localDtlsRole:"client",localSdpObject:h});case 3:return N.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setLocalDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return e.a(2,{dataChannel:d})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=s(a().m(function e(t){var r,n,i,c=this;return a().w(function(e){for(;;)switch(e.n){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=T.parse(this._pc.localDescription.sdp)),(i=j.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.n=1,new Promise(function(e,t){c.safeEmit("@connect",{dtlsParameters:i},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new E.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],[{key:"createFactory",value:function(){return{name:A,factory:function(e){return new n(e)},getNativeRtpCapabilities:function(){var e=s(a().m(function e(){var t,r,i,c,o,s,u,p,d;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return N.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),(r=document.createElement("canvas")).getContext("2d"),i=r.captureStream(),c=i.getVideoTracks()[0],e.p=1,t.addTransceiver("audio",{direction:"sendrecv"}),t.addTransceiver(c,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]}),e.n=2,t.createOffer();case 2:o=e.v;try{r.remove()}catch(a){}try{c.stop()}catch(a){}try{t.close()}catch(a){}return t=void 0,s=T.parse(o.sdp),u=n.getLocalRtpCapabilities(s),e.a(2,u);case 3:e.p=3,d=e.v;try{r.remove()}catch(l){}try{c.stop()}catch(l){}try{null===(p=t)||void 0===p||p.close()}catch(l){}throw t=void 0,d;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var e=s(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return N.debug("getNativeSctpCapabilities()"),e.a(2,{numStreams:q})}},e)}));return function(){return e.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=j.extractRtpCapabilities({sdpObject:e});return L.validateAndNormalizeRtpCapabilities(t),t}}])}();exports.Firefox120=G;
},{"sdp-transform":"CfIM","../enhancedEvents":"HRyP","../Logger":"andi","../errors":"hNUz","../ortc":"y0TR","../scalabilityModes":"LIqw","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./sdp/RemoteSdp":"vZFf"}],"Xquh":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,c=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw c}}}}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function s(r,n,i,a){var s=n&&n.prototype instanceof u?n:u,p=Object.create(s.prototype);return c(p,"_invoke",function(r,n,i){var a,c,s,u=0,p=i||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,c=0,s=e,l.n=r,o}};function f(r,n){for(c=r,s=n,t=0;!d&&u&&!i&&t<p.length;t++){var i,a=p[t],f=l.p,h=a[2];r>3?(i=h===n)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(c=0,l.v=n,l.n=a[1]):f<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,l.n=h,c=0))}if(i||r>1)return o;throw d=!0,n}return function(i,p,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,h),c=p,s=h;(t=c<2?e:s)||!d;){a||(c?c<3?(c>1&&(l.n=-1),f(c,s)):l.n=s:l.v=s);try{if(u=2,a){if(c||(i="next"),t=a[i]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);a=e}else if((t=(d=l.n<0)?s:r.call(n,l))!==o)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(r,i,a),!0),p}var o={};function u(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,c(f,"constructor",d),c(d,"constructor",p),p.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(f),c(f,i,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:h}})()}function c(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function s(e,t,r,n,i,a,c){try{var s=e[a](c),o=s.value}catch(e){return void r(e)}s.done?t(o):Promise.resolve(o).then(n,i)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){s(a,n,i,c,o,"next",e)}function o(e){s(a,n,i,c,o,"throw",e)}c(void 0)})}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return t=_(t),v(e,g()?Reflect.construct(t,r||[],_(e).constructor):t.apply(e,r))}function v(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function b(e,t,r,n){var i=y(_(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(null,arguments)}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(t){var r=C(t,"string");return"symbol"==e(r)?r:r+""}function C(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Safari12=void 0;var T=require("sdp-transform"),O=require("../enhancedEvents"),P=require("../Logger"),L=require("../ortc"),M=require("../errors"),E=require("../scalabilityModes"),j=require("./sdp/RemoteSdp"),I=require("./sdp/commonUtils"),x=require("./sdp/unifiedPlanUtils"),N=require("./ortc/utils"),A=new P.Logger("Safari12"),q="Safari12",G={OS:1024,MIS:1024},F=function(e){function n(e){var t,r=e.direction,i=e.iceParameters,a=e.iceCandidates,c=e.dtlsParameters,s=e.sctpParameters,o=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,f=e.getSendExtendedRtpCapabilities;return d(this,n),k(t=h(this,n),"_closed",!1),k(t,"_direction",void 0),k(t,"_remoteSdp",void 0),k(t,"_getSendExtendedRtpCapabilities",void 0),k(t,"_forcedLocalDtlsRole",void 0),k(t,"_pc",void 0),k(t,"_mapMidTransceiver",new Map),k(t,"_sendStream",new MediaStream),k(t,"_hasDataChannelMediaSection",!1),k(t,"_nextSendSctpStreamId",0),k(t,"_transportReady",!1),k(t,"onIceGatheringStateChange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),k(t,"onIceCandidateError",function(e){t.emit("@icecandidateerror",e)}),k(t,"onConnectionStateChange",function(){t.emit("@connectionstatechange",t._pc.connectionState)}),k(t,"onIceConnectionStateChange",function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}),A.debug("constructor()"),t._direction=r,t._remoteSdp=new j.RemoteSdp({iceParameters:i,iceCandidates:a,dtlsParameters:c,sctpParameters:s}),t._getSendExtendedRtpCapabilities=f,c.role&&"auto"!==c.role&&(t._forcedLocalDtlsRole="server"===c.role?"client":"server"),t._pc=new RTCPeerConnection(p({iceServers:null!=o?o:[],iceTransportPolicy:null!=u?u:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l)),t._pc.addEventListener("icegatheringstatechange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),t._pc.addEventListener("icecandidateerror",function(e){t.emit("@icecandidateerror",e)}),t._pc.addEventListener("icegatheringstatechange",t.onIceGatheringStateChange),t._pc.addEventListener("icecandidateerror",t.onIceCandidateError),t._pc.connectionState?t._pc.addEventListener("connectionstatechange",t.onConnectionStateChange):(A.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.addEventListener("iceconnectionstatechange",t.onIceConnectionStateChange)),t}return w(n,O.EnhancedEventEmitter),f(n,[{key:"name",get:function(){return q}},{key:"close",value:function(){if(A.debug("close()"),!this._closed){this._closed=!0;try{this._pc.close()}catch(e){}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),b(n,"close",this,3)([])}}},{key:"updateIceServers",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),A.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=o(a().m(function e(t){var r,n,i,c;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),A.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.n=1;break}return e.a(2);case 1:if("send"!==this._direction){e.n=5;break}return e.n=2,this._pc.createOffer({iceRestart:!0});case 2:return r=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.n=3,this._pc.setLocalDescription(r);case 3:return n={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.n=4,this._pc.setRemoteDescription(n);case 4:e.n=8;break;case 5:return i={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.n=6,this._pc.setRemoteDescription(i);case 6:return e.n=7,this._pc.createAnswer();case 7:return c=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),e.n=8,this._pc.setLocalDescription(c);case 8:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,this._pc.getStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=o(a().m(function e(t){var i,c,s,o,u,p,d,l,f,h,v,m,g,b,y,S,_,w,R,k,D,C;return a().w(function(e){for(;;)switch(e.n){case 0:return i=t.track,c=t.encodings,s=t.codecOptions,o=t.codec,u=t.onRtpSender,this.assertNotClosed(),this.assertSendDirection(),A.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),p=this._remoteSdp.getNextMediaSectionIdx(),d=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream]}),u&&u(d.sender),e.n=1,this._pc.createOffer();case 1:if(l=e.v,(f=T.parse(l.sdp)).extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),h=n.getLocalRtpCapabilities(f),v=this._getSendExtendedRtpCapabilities(h),(m=L.getSendingRtpParameters(i.kind,v)).codecs=L.reduceCodecs(m.codecs,o),(g=L.getSendingRemoteRtpParameters(i.kind,v)).codecs=L.reduceCodecs(g.codecs,o),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(y=this._forcedLocalDtlsRole)&&void 0!==y?y:"client",localSdpObject:f});case 2:return S=(0,E.parse)((null!=c?c:[{}])[0].scalabilityMode),c&&c.length>1&&(A.debug("send() | enabling legacy simulcast"),f=T.parse(l.sdp),b=f.media[p.idx],x.addLegacySimulcast({offerMediaObject:b,numStreams:c.length}),l={type:"offer",sdp:T.write(f)}),A.debug("send() | calling pc.setLocalDescription() [offer:%o]",l),e.n=3,this._pc.setLocalDescription(l);case 3:if(_=d.mid,m.mid=_,f=T.parse(this._pc.localDescription.sdp),b=f.media[p.idx],m.rtcp.cname=I.getCname({offerMediaObject:b}),m.encodings=x.getRtpEncodings({offerMediaObject:b}),c)for(w=0;w<m.encodings.length;++w)c[w]&&Object.assign(m.encodings[w],c[w]);if(m.encodings.length>1&&("video/vp8"===m.codecs[0].mimeType.toLowerCase()||"video/h264"===m.codecs[0].mimeType.toLowerCase())){R=r(m.encodings);try{for(R.s();!(k=R.n()).done;)(D=k.value).scalabilityMode?D.scalabilityMode="L1T".concat(S.temporalLayers):D.scalabilityMode="L1T3"}catch(a){R.e(a)}finally{R.f()}}return this._remoteSdp.send({offerMediaObject:b,reuseMid:p.reuseMid,offerRtpParameters:m,answerRtpParameters:g,codecOptions:s}),C={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("send() | calling pc.setRemoteDescription() [answer:%o]",C),e.n=4,this._pc.setRemoteDescription(C);case 4:return this._mapMidTransceiver.set(_,d),e.a(2,{localId:_,rtpParameters:m,rtpSender:d.sender})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertSendDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:if(A.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=2;break}throw new Error("associated RTCRtpTransceiver not found");case 2:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(a){}return e.n=3,this._pc.createOffer();case 3:return n=e.v,A.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=4,this._pc.setLocalDescription(n);case 4:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=5,this._pc.setRemoteDescription(i);case 5:this._mapMidTransceiver.delete(t);case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=o(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?A.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):A.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.n=2,n.sender.replaceTrack(r);case 2:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=o(a().m(function e(t,r){var n,i,c,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){e.active=t<=r}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return s={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),e.n=5,this._pc.setRemoteDescription(s);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=o(a().m(function e(t,r){var n,i,c,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){i.encodings[t]=p(p({},e),r)}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return s={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),e.n=5,this._pc.setRemoteDescription(s);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.sender.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=o(a().m(function e(t){var r,n,i,c,s,o,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,c=t.label,s=t.protocol,this.assertNotClosed(),this.assertSendDirection(),o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:s},A.debug("sendDataChannel() [options:%o]",o),u=this._pc.createDataChannel(c,o),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%G.MIS,this._hasDataChannelMediaSection){e.n=5;break}return e.n=1,this._pc.createOffer();case 1:if(p=e.v,d=T.parse(p.sdp),l=d.media.find(function(e){return"application"===e.type}),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(f=this._forcedLocalDtlsRole)&&void 0!==f?f:"client",localSdpObject:d});case 2:return A.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.n=3,this._pc.setLocalDescription(p);case 3:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),h={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.n=4,this._pc.setRemoteDescription(h);case 4:this._hasDataChannelMediaSection=!0;case 5:return v={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits},e.a(2,{dataChannel:u,sctpStreamParameters:v})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=o(a().m(function e(n){var i,c,s,o,u,p,d,l,f,h,v,m,g,b,y,S,_,w,R,k,D,C,O,P,L,M,E,j=this;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),i=[],c=new Map,s=r(n);try{for(s.s();!(o=s.n()).done;)p=o.value,d=p.trackId,l=p.kind,f=p.rtpParameters,h=p.streamId,A.debug("receive() [trackId:%s, kind:%s]",d,l),v=null!==(u=f.mid)&&void 0!==u?u:String(this._mapMidTransceiver.size),c.set(d,v),this._remoteSdp.receive({mid:v,kind:l,offerRtpParameters:f,streamId:null!=h?h:f.rtcp.cname,trackId:d})}catch(x){s.e(x)}finally{s.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.n=1,this._pc.setRemoteDescription(m);case 1:g=r(n),e.p=2,y=a().m(function e(){var t,r,n,i,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=b.value,r=t.trackId,!(n=t.onRtpReceiver)){e.n=2;break}if(i=c.get(r),s=j._pc.getTransceivers().find(function(e){return e.mid===i})){e.n=1;break}throw new Error("transceiver not found");case 1:n(s.receiver);case 2:return e.a(2)}},e)}),g.s();case 3:if((b=g.n()).done){e.n=5;break}return e.d(t(y()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,L=e.v,g.e(L);case 7:return e.p=7,g.f(),e.f(7);case 8:return e.n=9,this._pc.createAnswer();case 9:S=e.v,_=T.parse(S.sdp),w=r(n),e.p=10,k=a().m(function e(){var t,r,n,i,s;return a().w(function(e){for(;;)switch(e.n){case 0:t=R.value,r=t.trackId,n=t.rtpParameters,i=c.get(r),s=_.media.find(function(e){return String(e.mid)===i}),I.applyCodecParameters({offerRtpParameters:n,answerMediaObject:s});case 1:return e.a(2)}},e)}),w.s();case 11:if((R=w.n()).done){e.n=13;break}return e.d(t(k()),12);case 12:e.n=11;break;case 13:e.n=15;break;case 14:e.p=14,M=e.v,w.e(M);case 15:return e.p=15,w.f(),e.f(15);case 16:if(S={type:"answer",sdp:T.write(_)},this._transportReady){e.n=17;break}return e.n=17,this.setupTransport({localDtlsRole:null!==(D=this._forcedLocalDtlsRole)&&void 0!==D?D:"client",localSdpObject:_});case 17:return A.debug("receive() | calling pc.setLocalDescription() [answer:%o]",S),e.n=18,this._pc.setLocalDescription(S);case 18:C=r(n),e.p=19,P=a().m(function e(){var t,r,n,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=O.value,r=t.trackId,n=c.get(r),s=j._pc.getTransceivers().find(function(e){return e.mid===n})){e.n=1;break}throw new Error("new RTCRtpTransceiver not found");case 1:j._mapMidTransceiver.set(n,s),i.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver});case 2:return e.a(2)}},e)}),C.s();case 20:if((O=C.n()).done){e.n=22;break}return e.d(t(P()),21);case 21:e.n=20;break;case 22:e.n=24;break;case 23:e.p=23,E=e.v,C.e(E);case 24:return e.p=24,C.f(),e.f(24);case 25:return e.a(2,i)}},e,this,[[19,23,24,25],[10,14,15,16],[2,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p,d,l,f;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.assertRecvDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:n=r(t),e.p=2,n.s();case 3:if((i=n.n()).done){e.n=6;break}if(c=i.value,A.debug("stopReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:this._remoteSdp.closeMediaSection(s.mid);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,n.e(f);case 8:return e.p=8,n.f(),e.f(8);case 9:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=10,this._pc.setRemoteDescription(o);case 10:return e.n=11,this._pc.createAnswer();case 11:return u=e.v,A.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=12,this._pc.setLocalDescription(u);case 12:p=r(t);try{for(p.s();!(d=p.n()).done;)l=d.value,this._mapMidTransceiver.delete(l)}catch(a){p.e(a)}finally{p.f()}case 13:return e.a(2)}},e,this,[[2,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("pauseReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:s.direction="inactive",this._remoteSdp.pauseMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=9,this._pc.setRemoteDescription(o);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("resumeReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=9,this._pc.setRemoteDescription(o);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.receiver.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=o(a().m(function e(t){var r,n,i,c,s,o,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),c=r.streamId,s=r.ordered,o=r.maxPacketLifeTime,u=r.maxRetransmits,p={negotiated:!0,id:c,ordered:s,maxPacketLifeTime:o,maxRetransmits:u,protocol:i},A.debug("receiveDataChannel() [options:%o]",p),d=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.n=5;break}return this._remoteSdp.receiveSctpAssociation(),l={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),e.n=1,this._pc.setRemoteDescription(l);case 1:return e.n=2,this._pc.createAnswer();case 2:if(f=e.v,this._transportReady){e.n=3;break}return v=T.parse(f.sdp),e.n=3,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 3:return A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setLocalDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return e.a(2,{dataChannel:d})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=o(a().m(function e(t){var r,n,i,c=this;return a().w(function(e){for(;;)switch(e.n){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=T.parse(this._pc.localDescription.sdp)),(i=I.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.n=1,new Promise(function(e,t){c.safeEmit("@connect",{dtlsParameters:i},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new M.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],[{key:"createFactory",value:function(){return{name:q,factory:function(e){return new n(e)},getNativeRtpCapabilities:function(){var e=o(a().m(function e(){var t,r,i,c,s,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return A.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.p=1,t.addTransceiver("audio"),t.addTransceiver("video"),e.n=2,t.createOffer();case 2:r=e.v;try{t.close()}catch(a){}return t=void 0,i=T.parse(r.sdp),c=n.getLocalRtpCapabilities(i),e.a(2,c);case 3:e.p=3,o=e.v;try{null===(s=t)||void 0===s||s.close()}catch(u){}throw t=void 0,o;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return A.debug("getNativeSctpCapabilities()"),e.a(2,{numStreams:G})}},e)}));return function(){return e.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=I.extractRtpCapabilities({sdpObject:e});return L.validateAndNormalizeRtpCapabilities(t),N.addNackSupportForOpus(t),t}}])}();exports.Safari12=F;
},{"sdp-transform":"CfIM","../enhancedEvents":"HRyP","../Logger":"andi","../ortc":"y0TR","../errors":"hNUz","../scalabilityModes":"LIqw","./sdp/RemoteSdp":"vZFf","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./ortc/utils":"n8go"}],"ICcI":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,c=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw c}}}}function n(e,t){if(e){if("string"==typeof e)return i(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function a(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",i=r.toStringTag||"@@toStringTag";function s(r,n,i,a){var s=n&&n.prototype instanceof u?n:u,p=Object.create(s.prototype);return c(p,"_invoke",function(r,n,i){var a,c,s,u=0,p=i||[],d=!1,l={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,c=0,s=e,l.n=r,o}};function f(r,n){for(c=r,s=n,t=0;!d&&u&&!i&&t<p.length;t++){var i,a=p[t],f=l.p,h=a[2];r>3?(i=h===n)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=f&&((i=r<2&&f<a[1])?(c=0,l.v=n,l.n=a[1]):f<h&&(i=r<3||a[0]>n||n>h)&&(a[4]=r,a[5]=n,l.n=h,c=0))}if(i||r>1)return o;throw d=!0,n}return function(i,p,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===p&&f(p,h),c=p,s=h;(t=c<2?e:s)||!d;){a||(c?c<3?(c>1&&(l.n=-1),f(c,s)):l.n=s:l.v=s);try{if(u=2,a){if(c||(i="next"),t=a[i]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);a=e}else if((t=(d=l.n<0)?s:r.call(n,l))!==o)break}catch(t){a=e,c=1,s=t}finally{u=1}}return{value:t,done:d}}}(r,i,a),!0),p}var o={};function u(){}function p(){}function d(){}t=Object.getPrototypeOf;var l=[][n]?t(t([][n]())):(c(t={},n,function(){return this}),t),f=d.prototype=u.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(f),e}return p.prototype=d,c(f,"constructor",d),c(d,"constructor",p),p.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(f),c(f,i,"Generator"),c(f,n,function(){return this}),c(f,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:h}})()}function c(e,t,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(c=function(e,t,r,n){function a(t,r){c(e,t,function(e){return this._invoke(t,r,e)})}t?i?i(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,n)}function s(e,t,r,n,i,a,c){try{var s=e[a](c),o=s.value}catch(e){return void r(e)}s.done?t(o):Promise.resolve(o).then(n,i)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function c(e){s(a,n,i,c,o,"next",e)}function o(e){s(a,n,i,c,o,"throw",e)}c(void 0)})}}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,D(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return t=w(t),v(e,g()?Reflect.construct(t,r||[],w(e).constructor):t.apply(e,r))}function v(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return m(t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function b(e,t,r,n){var i=y(w(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof i?function(e){return i.apply(r,e)}:i}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}}).apply(null,arguments)}function S(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=w(e)););return e}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return(R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,r){return(t=D(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(t){var r=C(t,"string");return"symbol"==e(r)?r:r+""}function C(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r||"default");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReactNative106=void 0;var T=require("sdp-transform"),O=require("../enhancedEvents"),P=require("../Logger"),L=require("../ortc"),M=require("../errors"),E=require("../scalabilityModes"),j=require("./sdp/RemoteSdp"),I=require("./sdp/commonUtils"),x=require("./sdp/unifiedPlanUtils"),N=require("./ortc/utils"),A=new P.Logger("ReactNative106"),q="ReactNative106",G={OS:1024,MIS:1024},F=function(e){function n(e){var t,r=e.direction,i=e.iceParameters,a=e.iceCandidates,c=e.dtlsParameters,s=e.sctpParameters,o=e.iceServers,u=e.iceTransportPolicy,l=e.additionalSettings,f=e.getSendExtendedRtpCapabilities;return d(this,n),k(t=h(this,n),"_closed",!1),k(t,"_direction",void 0),k(t,"_remoteSdp",void 0),k(t,"_getSendExtendedRtpCapabilities",void 0),k(t,"_forcedLocalDtlsRole",void 0),k(t,"_pc",void 0),k(t,"_mapMidTransceiver",new Map),k(t,"_sendStream",new MediaStream),k(t,"_hasDataChannelMediaSection",!1),k(t,"_nextSendSctpStreamId",0),k(t,"_transportReady",!1),k(t,"onIceGatheringStateChange",function(){t.emit("@icegatheringstatechange",t._pc.iceGatheringState)}),k(t,"onIceCandidateError",function(e){t.emit("@icecandidateerror",e)}),k(t,"onConnectionStateChange",function(){t.emit("@connectionstatechange",t._pc.connectionState)}),k(t,"onIceConnectionStateChange",function(){switch(t._pc.iceConnectionState){case"checking":t.emit("@connectionstatechange","connecting");break;case"connected":case"completed":t.emit("@connectionstatechange","connected");break;case"failed":t.emit("@connectionstatechange","failed");break;case"disconnected":t.emit("@connectionstatechange","disconnected");break;case"closed":t.emit("@connectionstatechange","closed")}}),A.debug("constructor()"),t._direction=r,t._remoteSdp=new j.RemoteSdp({iceParameters:i,iceCandidates:a,dtlsParameters:c,sctpParameters:s}),t._getSendExtendedRtpCapabilities=f,c.role&&"auto"!==c.role&&(t._forcedLocalDtlsRole="server"===c.role?"client":"server"),t._pc=new RTCPeerConnection(p({iceServers:null!=o?o:[],iceTransportPolicy:null!=u?u:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"},l)),t._pc.addEventListener("icegatheringstatechange",t.onIceGatheringStateChange),t._pc.addEventListener("icecandidateerror",t.onIceCandidateError),t._pc.connectionState?t._pc.addEventListener("connectionstatechange",t.onConnectionStateChange):(A.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),t._pc.addEventListener("iceconnectionstatechange",t.onIceConnectionStateChange)),t}return _(n,O.EnhancedEventEmitter),f(n,[{key:"name",get:function(){return q}},{key:"close",value:function(){if(A.debug("close()"),!this._closed){this._closed=!0,this._sendStream.release(!1);try{this._pc.close()}catch(e){}this._pc.removeEventListener("icegatheringstatechange",this.onIceGatheringStateChange),this._pc.removeEventListener("icecandidateerror",this.onIceCandidateError),this._pc.removeEventListener("connectionstatechange",this.onConnectionStateChange),this._pc.removeEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),this.emit("@close"),b(n,"close",this,3)([])}}},{key:"updateIceServers",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),A.debug("updateIceServers()"),(r=this._pc.getConfiguration()).iceServers=t,this._pc.setConfiguration(r);case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=o(a().m(function e(t){var r,n,i,c;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),A.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady){e.n=1;break}return e.a(2);case 1:if("send"!==this._direction){e.n=5;break}return e.n=2,this._pc.createOffer({iceRestart:!0});case 2:return r=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),e.n=3,this._pc.setLocalDescription(r);case 3:return n={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),e.n=4,this._pc.setRemoteDescription(n);case 4:e.n=8;break;case 5:return i={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),e.n=6,this._pc.setRemoteDescription(i);case 6:return e.n=7,this._pc.createAnswer();case 7:return c=e.v,A.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),e.n=8,this._pc.setLocalDescription(c);case 8:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,this._pc.getStats())}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=o(a().m(function e(t){var i,c,s,o,u,p,d,l,f,h,v,m,g,b,y,S,w,_,R,k,D,C,O,P;return a().w(function(e){for(;;)switch(e.n){case 0:return c=t.track,s=t.encodings,o=t.codecOptions,u=t.codec,p=t.onRtpSender,this.assertNotClosed(),this.assertSendDirection(),A.debug("send() [kind:%s, track.id:%s]",c.kind,c.id),s&&s.length>1&&s.forEach(function(e,t){e.rid="r".concat(t)}),d=this._remoteSdp.getNextMediaSectionIdx(),l=this._pc.addTransceiver(c,{direction:"sendonly",streams:[this._sendStream],sendEncodings:s}),p&&p(l.sender),e.n=1,this._pc.createOffer();case 1:if(f=e.v,(h=T.parse(f.sdp)).extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),v=n.getLocalRtpCapabilities(h),m=this._getSendExtendedRtpCapabilities(v),(g=L.getSendingRtpParameters(c.kind,m)).codecs=L.reduceCodecs(g.codecs,u),(b=L.getSendingRemoteRtpParameters(c.kind,m)).codecs=L.reduceCodecs(b.codecs,u),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(y=this._forcedLocalDtlsRole)&&void 0!==y?y:"client",localSdpObject:h});case 2:return S=!1,w=(0,E.parse)((null!=s?s:[{}])[0].scalabilityMode),s&&1===s.length&&w.spatialLayers>1&&"video/vp9"===g.codecs[0].mimeType.toLowerCase()&&(A.debug("send() | enabling legacy simulcast for VP9 SVC"),S=!0,h=T.parse(f.sdp),_=h.media[d.idx],x.addLegacySimulcast({offerMediaObject:_,numStreams:w.spatialLayers}),f={type:"offer",sdp:T.write(h)}),A.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),e.n=3,this._pc.setLocalDescription(f);case 3:if((R=null!==(i=l.mid)&&void 0!==i?i:void 0)||A.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),g.mid=R,h=T.parse(this._pc.localDescription.sdp),_=h.media[d.idx],g.rtcp.cname=I.getCname({offerMediaObject:_}),s?1===s.length?(k=x.getRtpEncodings({offerMediaObject:_}),Object.assign(k[0],s[0]),S&&(k=[k[0]]),g.encodings=k):g.encodings=s:g.encodings=x.getRtpEncodings({offerMediaObject:_}),g.encodings.length>1&&("video/vp8"===g.codecs[0].mimeType.toLowerCase()||"video/h264"===g.codecs[0].mimeType.toLowerCase())){D=r(g.encodings);try{for(D.s();!(C=D.n()).done;)(O=C.value).scalabilityMode?O.scalabilityMode="L1T".concat(w.temporalLayers):O.scalabilityMode="L1T3"}catch(a){D.e(a)}finally{D.f()}}return this._remoteSdp.send({offerMediaObject:_,reuseMid:d.reuseMid,offerRtpParameters:g,answerRtpParameters:b,codecOptions:o}),P={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("send() | calling pc.setRemoteDescription() [answer:%o]",P),e.n=4,this._pc.setRemoteDescription(P);case 4:return R||(R=l.mid,g.mid=R),this._mapMidTransceiver.set(R,l),e.a(2,{localId:R,rtpParameters:g,rtpSender:l.sender})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertSendDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:if(A.debug("stopSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=2;break}throw new Error("associated RTCRtpTransceiver not found");case 2:if(r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.closeMediaSection(r.mid))try{r.stop()}catch(a){}return e.n=3,this._pc.createOffer();case 3:return n=e.v,A.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=4,this._pc.setLocalDescription(n);case 4:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=5,this._pc.setRemoteDescription(i);case 5:this._mapMidTransceiver.delete(t);case 6:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("pauseSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="inactive",this._remoteSdp.pauseMediaSection(t),e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=o(a().m(function e(t){var r,n,i;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("resumeSending() [localId:%s]",t),r=this._mapMidTransceiver.get(t),this._remoteSdp.resumeSendingMediaSection(t),r){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return r.direction="sendonly",e.n=2,this._pc.createOffer();case 2:return n=e.v,A.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),e.n=3,this._pc.setLocalDescription(n);case 3:return i={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",i),e.n=4,this._pc.setRemoteDescription(i);case 4:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=o(a().m(function e(t,r){var n;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r?A.debug("replaceTrack() [localId:%s, track.id:%s]",t,r.id):A.debug("replaceTrack() [localId:%s, no track]",t),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.n=2,n.sender.replaceTrack(r);case 2:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=o(a().m(function e(t,r){var n,i,c,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){e.active=t<=r}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return s={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",s),e.n=5,this._pc.setRemoteDescription(s);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=o(a().m(function e(t,r){var n,i,c,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),A.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,r),n=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return(i=n.sender.getParameters()).encodings.forEach(function(e,t){i.encodings[t]=p(p({},e),r)}),e.n=2,n.sender.setParameters(i);case 2:return this._remoteSdp.muxMediaSectionSimulcast(t,i.encodings),e.n=3,this._pc.createOffer();case 3:return c=e.v,A.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),e.n=4,this._pc.setLocalDescription(c);case 4:return s={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",s),e.n=5,this._pc.setRemoteDescription(s);case 5:return e.a(2)}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertSendDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.sender.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=o(a().m(function e(t){var r,n,i,c,s,o,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.ordered,n=t.maxPacketLifeTime,i=t.maxRetransmits,c=t.label,s=t.protocol,this.assertNotClosed(),this.assertSendDirection(),o={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:n,maxRetransmits:i,protocol:s},A.debug("sendDataChannel() [options:%o]",o),u=this._pc.createDataChannel(c,o),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%G.MIS,this._hasDataChannelMediaSection){e.n=5;break}return e.n=1,this._pc.createOffer();case 1:if(p=e.v,d=T.parse(p.sdp),l=d.media.find(function(e){return"application"===e.type}),this._transportReady){e.n=2;break}return e.n=2,this.setupTransport({localDtlsRole:null!==(f=this._forcedLocalDtlsRole)&&void 0!==f?f:"client",localSdpObject:d});case 2:return A.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",p),e.n=3,this._pc.setLocalDescription(p);case 3:return this._remoteSdp.sendSctpAssociation({offerMediaObject:l}),h={type:"answer",sdp:this._remoteSdp.getSdp()},A.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),e.n=4,this._pc.setRemoteDescription(h);case 4:this._hasDataChannelMediaSection=!0;case 5:return v={streamId:o.id,ordered:o.ordered,maxPacketLifeTime:o.maxPacketLifeTime,maxRetransmits:o.maxRetransmits},e.a(2,{dataChannel:u,sctpStreamParameters:v})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=o(a().m(function e(n){var i,c,s,o,u,p,d,l,f,h,v,m,g,b,y,S,w,_,R,k,D,C,O,P,L,M,E,j=this;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),i=[],c=new Map,s=r(n);try{for(s.s();!(o=s.n()).done;)p=o.value,d=p.trackId,l=p.kind,f=p.rtpParameters,h=p.streamId,A.debug("receive() [trackId:%s, kind:%s]",d,l),v=null!==(u=f.mid)&&void 0!==u?u:String(this._mapMidTransceiver.size),c.set(d,v),this._remoteSdp.receive({mid:v,kind:l,offerRtpParameters:f,streamId:null!=h?h:f.rtcp.cname,trackId:d})}catch(x){s.e(x)}finally{s.f()}return m={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",m),e.n=1,this._pc.setRemoteDescription(m);case 1:g=r(n),e.p=2,y=a().m(function e(){var t,r,n,i,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=b.value,r=t.trackId,!(n=t.onRtpReceiver)){e.n=2;break}if(i=c.get(r),s=j._pc.getTransceivers().find(function(e){return e.mid===i})){e.n=1;break}throw new Error("transceiver not found");case 1:n(s.receiver);case 2:return e.a(2)}},e)}),g.s();case 3:if((b=g.n()).done){e.n=5;break}return e.d(t(y()),4);case 4:e.n=3;break;case 5:e.n=7;break;case 6:e.p=6,L=e.v,g.e(L);case 7:return e.p=7,g.f(),e.f(7);case 8:return e.n=9,this._pc.createAnswer();case 9:S=e.v,w=T.parse(S.sdp),_=r(n),e.p=10,k=a().m(function e(){var t,r,n,i,s;return a().w(function(e){for(;;)switch(e.n){case 0:t=R.value,r=t.trackId,n=t.rtpParameters,i=c.get(r),s=w.media.find(function(e){return String(e.mid)===i}),I.applyCodecParameters({offerRtpParameters:n,answerMediaObject:s});case 1:return e.a(2)}},e)}),_.s();case 11:if((R=_.n()).done){e.n=13;break}return e.d(t(k()),12);case 12:e.n=11;break;case 13:e.n=15;break;case 14:e.p=14,M=e.v,_.e(M);case 15:return e.p=15,_.f(),e.f(15);case 16:if(S={type:"answer",sdp:T.write(w)},this._transportReady){e.n=17;break}return e.n=17,this.setupTransport({localDtlsRole:null!==(D=this._forcedLocalDtlsRole)&&void 0!==D?D:"client",localSdpObject:w});case 17:return A.debug("receive() | calling pc.setLocalDescription() [answer:%o]",S),e.n=18,this._pc.setLocalDescription(S);case 18:C=r(n),e.p=19,P=a().m(function e(){var t,r,n,s;return a().w(function(e){for(;;)switch(e.n){case 0:if(t=O.value,r=t.trackId,n=c.get(r),s=j._pc.getTransceivers().find(function(e){return e.mid===n})){e.n=1;break}throw new Error("new RTCRtpTransceiver not found");case 1:j._mapMidTransceiver.set(n,s),i.push({localId:n,track:s.receiver.track,rtpReceiver:s.receiver});case 2:return e.a(2)}},e)}),C.s();case 20:if((O=C.n()).done){e.n=22;break}return e.d(t(P()),21);case 21:e.n=20;break;case 22:e.n=24;break;case 23:e.p=23,E=e.v,C.e(E);case 24:return e.p=24,C.f(),e.f(24);case 25:return e.a(2,i)}},e,this,[[19,23,24,25],[10,14,15,16],[2,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p,d,l,f;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.assertRecvDirection(),!this._closed){e.n=1;break}return e.a(2);case 1:n=r(t),e.p=2,n.s();case 3:if((i=n.n()).done){e.n=6;break}if(c=i.value,A.debug("stopReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=4;break}throw new Error("associated RTCRtpTransceiver not found");case 4:this._remoteSdp.closeMediaSection(s.mid);case 5:e.n=3;break;case 6:e.n=8;break;case 7:e.p=7,f=e.v,n.e(f);case 8:return e.p=8,n.f(),e.f(8);case 9:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=10,this._pc.setRemoteDescription(o);case 10:return e.n=11,this._pc.createAnswer();case 11:return u=e.v,A.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=12,this._pc.setLocalDescription(u);case 12:p=r(t);try{for(p.s();!(d=p.n()).done;)l=d.value,this._mapMidTransceiver.delete(l)}catch(a){p.e(a)}finally{p.f()}case 13:return e.a(2)}},e,this,[[2,7,8,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("pauseReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:s.direction="inactive",this._remoteSdp.pauseMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=9,this._pc.setRemoteDescription(o);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=o(a().m(function e(t){var n,i,c,s,o,u,p;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),this.assertRecvDirection(),n=r(t),e.p=1,n.s();case 2:if((i=n.n()).done){e.n=5;break}if(c=i.value,A.debug("resumeReceiving() [localId:%s]",c),s=this._mapMidTransceiver.get(c)){e.n=3;break}throw new Error("associated RTCRtpTransceiver not found");case 3:s.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c);case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,p=e.v,n.e(p);case 7:return e.p=7,n.f(),e.f(7);case 8:return o={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),e.n=9,this._pc.setRemoteDescription(o);case 9:return e.n=10,this._pc.createAnswer();case 10:return u=e.v,A.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",u),e.n=11,this._pc.setLocalDescription(u);case 11:return e.a(2)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=o(a().m(function e(t){var r;return a().w(function(e){for(;;)switch(e.n){case 0:if(this.assertNotClosed(),this.assertRecvDirection(),r=this._mapMidTransceiver.get(t)){e.n=1;break}throw new Error("associated RTCRtpTransceiver not found");case 1:return e.a(2,r.receiver.getStats())}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=o(a().m(function e(t){var r,n,i,c,s,o,u,p,d,l,f,h,v;return a().w(function(e){for(;;)switch(e.n){case 0:if(r=t.sctpStreamParameters,n=t.label,i=t.protocol,this.assertNotClosed(),this.assertRecvDirection(),c=r.streamId,s=r.ordered,o=r.maxPacketLifeTime,u=r.maxRetransmits,p={negotiated:!0,id:c,ordered:s,maxPacketLifeTime:o,maxRetransmits:u,protocol:i},A.debug("receiveDataChannel() [options:%o]",p),d=this._pc.createDataChannel(n,p),this._hasDataChannelMediaSection){e.n=5;break}return this._remoteSdp.receiveSctpAssociation(),l={type:"offer",sdp:this._remoteSdp.getSdp()},A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",l),e.n=1,this._pc.setRemoteDescription(l);case 1:return e.n=2,this._pc.createAnswer();case 2:if(f=e.v,this._transportReady){e.n=3;break}return v=T.parse(f.sdp),e.n=3,this.setupTransport({localDtlsRole:null!==(h=this._forcedLocalDtlsRole)&&void 0!==h?h:"client",localSdpObject:v});case 3:return A.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",f),e.n=4,this._pc.setLocalDescription(f);case 4:this._hasDataChannelMediaSection=!0;case 5:return e.a(2,{dataChannel:d})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=o(a().m(function e(t){var r,n,i,c=this;return a().w(function(e){for(;;)switch(e.n){case 0:return r=t.localDtlsRole,(n=t.localSdpObject)||(n=T.parse(this._pc.localDescription.sdp)),(i=I.extractDtlsParameters({sdpObject:n})).role=r,this._remoteSdp.updateDtlsRole("client"===r?"server":"client"),e.n=1,new Promise(function(e,t){c.safeEmit("@connect",{dtlsParameters:i},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new M.InvalidStateError("method called in a closed handler")}},{key:"assertSendDirection",value:function(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}},{key:"assertRecvDirection",value:function(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}],[{key:"createFactory",value:function(){return{name:q,factory:function(e){return new n(e)},getNativeRtpCapabilities:function(){var e=o(a().m(function e(){var t,r,i,c,s,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return A.debug("getNativeRtpCapabilities()"),t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),e.p=1,t.addTransceiver("audio"),t.addTransceiver("video"),e.n=2,t.createOffer();case 2:r=e.v;try{t.close()}catch(a){}return t=void 0,i=T.parse(r.sdp),c=n.getLocalRtpCapabilities(i),e.a(2,c);case 3:e.p=3,o=e.v;try{null===(s=t)||void 0===s||s.close()}catch(u){}throw t=void 0,o;case 4:return e.a(2)}},e,null,[[1,3]])}));return function(){return e.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var e=o(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return A.debug("getNativeSctpCapabilities()"),e.a(2,{numStreams:G})}},e)}));return function(){return e.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=I.extractRtpCapabilities({sdpObject:e});return L.validateAndNormalizeRtpCapabilities(t),N.addNackSupportForOpus(t),t}}])}();exports.ReactNative106=F;
},{"sdp-transform":"CfIM","../enhancedEvents":"HRyP","../Logger":"andi","../ortc":"y0TR","../errors":"hNUz","../scalabilityModes":"LIqw","./sdp/RemoteSdp":"vZFf","./sdp/commonUtils":"p5WR","./sdp/unifiedPlanUtils":"C7JJ","./ortc/utils":"n8go"}],"kWtX":[function(require,module,exports) {
"use strict";function e(){var r,i,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(e,n,a,o){var s=n&&n.prototype instanceof d?n:d,u=Object.create(s.prototype);return t(u,"_invoke",function(e,t,n){var a,o,s,d=0,u=n||[],l=!1,f={p:0,n:0,v:r,a:p,f:p.bind(r,4),d:function(e,t){return a=e,o=0,s=r,f.n=t,c}};function p(e,t){for(o=e,s=t,i=0;!l&&d&&!n&&i<u.length;i++){var n,a=u[i],p=f.p,v=a[2];e>3?(n=v===t)&&(s=a[(o=a[4])?5:(o=3,3)],a[4]=a[5]=r):a[0]<=p&&((n=e<2&&p<a[1])?(o=0,f.v=t,f.n=a[1]):p<v&&(n=e<3||a[0]>t||t>v)&&(a[4]=e,a[5]=t,f.n=v,o=0))}if(n||e>1)return c;throw l=!0,t}return function(n,u,v){if(d>1)throw TypeError("Generator is already running");for(l&&1===u&&p(u,v),o=u,s=v;(i=o<2?r:s)||!l;){a||(o?o<3?(o>1&&(f.n=-1),p(o,s)):f.n=s:f.v=s);try{if(d=2,a){if(o||(n="next"),i=a[n]){if(!(i=i.call(a,s)))throw TypeError("iterator result is not an object");if(!i.done)return i;s=i.value,o<2&&(o=0)}else 1===o&&(i=a.return)&&i.call(a),o<2&&(s=TypeError("The iterator does not provide a '"+n+"' method"),o=1);a=r}else if((i=(l=f.n<0)?s:e.call(t,f))!==c)break}catch(i){a=r,o=1,s=i}finally{d=1}}return{value:i,done:l}}}(e,a,o),!0),u}var c={};function d(){}function u(){}function l(){}i=Object.getPrototypeOf;var f=[][a]?i(i([][a]())):(t(i={},a,function(){return this}),i),p=l.prototype=d.prototype=Object.create(f);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,t(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=l,t(p,"constructor",l),t(l,"constructor",u),u.displayName="GeneratorFunction",t(l,o,"GeneratorFunction"),t(p),t(p,o,"Generator"),t(p,a,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:s,m:v}})()}function t(e,r,i,n){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}(t=function(e,r,i,n){function o(r,i){t(e,r,function(e){return this._invoke(r,i,e)})}r?a?a(e,r,{value:i,enumerable:!n,configurable:!n,writable:!n}):e[r]=i:(o("next",0),o("throw",1),o("return",2))})(e,r,i,n)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function n(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e){var t=s(e,"string");return"symbol"==u(t)?t:t+""}function s(e,t){if("object"!=u(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=u(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function c(e,t,r,i,n,a,o){try{var s=e[a](o),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(i,n)}function d(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var a=e.apply(t,r);function o(e){c(a,i,n,o,s,"next",e)}function s(e){c(a,i,n,o,s,"throw",e)}o(void 0)})}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Device=void 0,exports.detectDevice=P,exports.detectDeviceAsync=_;var l=require("./Logger"),f=require("./enhancedEvents"),p=require("./errors"),v=require("./utils"),b=require("./ortc"),h=require("./Transport"),g=require("./handlers/Chrome111"),m=require("./handlers/Chrome74"),y=require("./handlers/Firefox120"),w=require("./handlers/Safari12"),S=require("./handlers/ReactNative106"),C=new l.Logger("Device");function P(e,t){return C.debug("detectDevice()"),e||"object"!==("undefined"==typeof navigator?"undefined":u(navigator))||(e=navigator.userAgent),t||"object"!==("undefined"==typeof navigator?"undefined":u(navigator))||(t=navigator.userAgentData),T(e,t)}function _(e,t){return j.apply(this,arguments)}function j(){return(j=d(e().m(function t(r,i){return e().w(function(e){for(;;)switch(e.n){case 0:return C.debug("detectDeviceAsync()"),r||"object"!==("undefined"==typeof navigator?"undefined":u(navigator))||(r=navigator.userAgent),i||"object"!==("undefined"==typeof navigator?"undefined":u(navigator))||(i=navigator.userAgentData),e.a(2,T(r,i))}},t)}))).apply(this,arguments)}var R=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.handlerName,n=e.handlerFactory;if(r(this,t),a(this,"_handlerFactory",void 0),a(this,"_handlerName",void 0),a(this,"_loaded",!1),a(this,"_getSendExtendedRtpCapabilities",void 0),a(this,"_recvRtpCapabilities",void 0),a(this,"_canProduceByKind",{audio:!1,video:!1}),a(this,"_sctpCapabilities",void 0),a(this,"_observer",new f.EnhancedEventEmitter),C.debug("constructor()"),i&&n)throw new TypeError("just one of handlerName or handlerInterface can be given");if(n)this._handlerFactory=n;else{if(i)C.debug("constructor() | handler given: %s",i);else{if(!(i=P()))throw new p.UnsupportedError("device not supported");C.debug("constructor() | detected handler: %s",i)}switch(i){case"Chrome111":this._handlerFactory=g.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=m.Chrome74.createFactory();break;case"Firefox120":this._handlerFactory=y.Firefox120.createFactory();break;case"Safari12":this._handlerFactory=w.Safari12.createFactory();break;case"ReactNative106":this._handlerFactory=S.ReactNative106.createFactory();break;default:throw new TypeError('unknown handlerName "'.concat(i,'"'))}}this._handlerName=this._handlerFactory.name}return n(t,[{key:"handlerName",get:function(){return this._handlerName}},{key:"loaded",get:function(){return this._loaded}},{key:"rtpCapabilities",get:function(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._recvRtpCapabilities}},{key:"sctpCapabilities",get:function(){if(!this._loaded)throw new p.InvalidStateError("not loaded");return this._sctpCapabilities}},{key:"observer",get:function(){return this._observer}},{key:"load",value:function(){var t=d(e().m(function t(r){var i,n,a,o,s,c,d,u,l,f;return e().w(function(e){for(;;)switch(e.n){case 0:if(i=r.routerRtpCapabilities,n=r.preferLocalCodecsOrder,a=void 0!==n&&n,C.debug("load() [routerRtpCapabilities:%o]",i),!this._loaded){e.n=1;break}throw new p.InvalidStateError("already loaded");case 1:return o=v.clone(i),b.validateAndNormalizeRtpCapabilities(o),s=this._handlerFactory,c=s.getNativeRtpCapabilities,d=s.getNativeSctpCapabilities,f=v,e.n=2,c();case 2:return u=f.clone.call(f,e.v),b.validateAndNormalizeRtpCapabilities(u),C.debug("load() | got native RTP capabilities:%o",u),this._getSendExtendedRtpCapabilities=function(e){return v.clone(b.getExtendedRtpCapabilities(e,o,a))},l=b.getExtendedRtpCapabilities(u,o,!1),this._recvRtpCapabilities=b.getRecvRtpCapabilities(l),b.validateAndNormalizeRtpCapabilities(this._recvRtpCapabilities),C.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._canProduceByKind.audio=b.canSend("audio",this._recvRtpCapabilities),this._canProduceByKind.video=b.canSend("video",this._recvRtpCapabilities),e.n=3,d();case 3:this._sctpCapabilities=e.v,b.validateSctpCapabilities(this._sctpCapabilities),C.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),C.debug("load() succeeded"),this._loaded=!0;case 4:return e.a(2)}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"canProduce",value:function(e){if(!this._loaded)throw new p.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'.concat(e,'"'));return this._canProduceByKind[e]}},{key:"createSendTransport",value:function(e){var t=e.id,r=e.iceParameters,i=e.iceCandidates,n=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,d=e.appData;return C.debug("createSendTransport()"),this.createTransport({direction:"send",id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:c,appData:d})}},{key:"createRecvTransport",value:function(e){var t=e.id,r=e.iceParameters,i=e.iceCandidates,n=e.dtlsParameters,a=e.sctpParameters,o=e.iceServers,s=e.iceTransportPolicy,c=e.additionalSettings,d=e.appData;return C.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:t,iceParameters:r,iceCandidates:i,dtlsParameters:n,sctpParameters:a,iceServers:o,iceTransportPolicy:s,additionalSettings:c,appData:d})}},{key:"createTransport",value:function(e){var t=e.direction,r=e.id,i=e.iceParameters,n=e.iceCandidates,a=e.dtlsParameters,o=e.sctpParameters,s=e.iceServers,c=e.iceTransportPolicy,d=e.additionalSettings,l=e.appData;if(!this._loaded)throw new p.InvalidStateError("not loaded");if("string"!=typeof r)throw new TypeError("missing id");if("object"!==u(i))throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!==u(a))throw new TypeError("missing dtlsParameters");if(o&&"object"!==u(o))throw new TypeError("wrong sctpParameters");if(l&&"object"!==u(l))throw new TypeError("if given, appData must be an object");var f=new h.Transport({direction:t,id:r,iceParameters:i,iceCandidates:n,dtlsParameters:a,sctpParameters:o,iceServers:s,iceTransportPolicy:c,additionalSettings:d,appData:l,handlerFactory:this._handlerFactory,getSendExtendedRtpCapabilities:this._getSendExtendedRtpCapabilities,recvRtpCapabilities:this._recvRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",f),f}}],[{key:"factory",value:function(){var r=d(e().m(function r(){var i,n,a,o=arguments;return e().w(function(e){for(;;)switch(e.n){case 0:if(i=o.length>0&&void 0!==o[0]?o[0]:{},n=i.handlerName,a=i.handlerFactory,C.debug("factory()"),!n||!a){e.n=1;break}throw new TypeError("just one of handlerName or handlerInterface can be given");case 1:if(n||a){e.n=3;break}return e.n=2,_();case 2:if(n=e.v){e.n=3;break}throw new p.UnsupportedError("device not supported");case 3:return e.a(2,new t({handlerName:n,handlerFactory:a}))}},r)}));return function(){return r.apply(this,arguments)}}()}])}();function T(e,t){C.debug('detectDeviceImpl() [userAgent:"%s", userAgentData:%o]',e,t);var r=O(e,t);if(r)return r>=111?(C.debug("detectDeviceImpl() | using Chrome111 handler"),"Chrome111"):r>=74?(C.debug("detectDeviceImpl() | using Chrome74 handler"),"Chrome74"):void C.warn("detectDeviceImpl() | unsupported Chromium based browser/version");var i=N(e);if(i)return i>=120?(C.debug("detectDeviceImpl() | using Firefox120 handler"),"Firefox120"):void C.warn("detectDeviceImpl() | unsupported Firefox browser/version");var n=F(e);if(n)return n>=605?(C.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12"):void C.warn("detectDeviceImpl() | unsupported desktop Safari browser/version");var a=D(e);return a?a>=605?(C.debug("detectDeviceImpl() | using Safari12 handler"),"Safari12"):void C.warn("detectDeviceImpl() | unsupported iOS Safari based browser/version"):I()?"undefined"!=typeof RTCPeerConnection&&"undefined"!=typeof RTCRtpTransceiver?(C.debug("detectDeviceImpl() | using ReactNative106 handler"),"ReactNative106"):void C.warn("detectDeviceImpl() | unsupported react-native-webrtc version without RTCPeerConnection or RTCRtpTransceiver, forgot to call registerGlobals() on it?"):void C.warn('detectDeviceImpl() | device not supported [userAgent:"%s", userAgentData:%o]',e,t)}function O(e,t){if(E(e,t))C.debug("getChromiumMajorVersion() | this is iOS => undefined");else if(I())C.debug("getChromiumMajorVersion() | this is React-Native => undefined");else{if(t){var r,i=(null!==(r=t.brands)&&void 0!==r?r:[]).find(function(e){return"Chromium"===e.brand});if(i){var n=Number(i.version);return C.debug("getChromiumMajorVersion() | Chromium major version based on NavigatorUAData => ".concat(n)),n}}var a=null==e?void 0:e.match(/\b(?:Chrome|Chromium)\/(\w+)/i);if(null!=a&&a[1]){var o=Number(a[1]);return C.debug("getChromiumMajorVersion() | Chromium major version based on User-Agent => ".concat(o)),o}C.debug("getChromiumMajorVersion() | this is not Chromium => undefined")}}function N(e){if(E(e))C.debug("getFirefoxMajorVersion() | this is iOS => undefined");else if(I())C.debug("getFirefoxMajorVersion() | this is React-Native => undefined");else{var t=null==e?void 0:e.match(/\bFirefox\/(\w+)/i);if(null!=t&&t[1]){var r=Number(t[1]);return C.debug("getFirefoxMajorVersion() | Firefox major version based on User-Agent => ".concat(r)),r}C.debug("getFirefoxMajorVersion() | this is not Firefox => undefined")}}function F(e){if(E(e))C.debug("getMacOSWebKitMajorVersion() | this is iOS => undefined");else if(I())C.debug("getMacOSWebKitMajorVersion() | this is React-Native => undefined");else if(e&&/\bSafari\b/i.test(e)&&!/\bChrome\b/i.test(e)&&!/\bChromium\b/i.test(e)&&!/\bFirefox\b/i.test(e)){var t=e.match(/AppleWebKit\/(\w+)/i);if(null!=t&&t[1]){var r=Number(t[1]);return C.debug("getMacOSWebKitMajorVersion() | WebKit major version based on User-Agent => ".concat(r)),r}C.debug("getMacOSWebKitMajorVersion() | this is not WebKit => undefined")}else C.debug("getMacOSWebKitMajorVersion() | this is not Safari => undefined")}function D(e){if(E(e))if(I())C.debug("getIOSWebKitMajorVersion() | this is React-Native => undefined");else{var t=null==e?void 0:e.match(/AppleWebKit\/(\w+)/i);if(null!=t&&t[1]){var r=Number(t[1]);return C.debug("getIOSWebKitMajorVersion() | WebKit major version based on User-Agent => ".concat(r)),r}C.debug("getIOSWebKitMajorVersion() | this is not WebKit => undefined")}else C.debug("getIOSWebKitMajorVersion() | this is not iOS => undefined")}function E(e,t){return"iOS"===(null==t?void 0:t.platform)?(C.debug("isIOS() | this is iOS based on NavigatorUAData.platform => true"),!0):null!=t&&t.platform?(C.debug("isIOS() | this is not iOS based on NavigatorUAData.platform => false"),!1):e&&/iPad|iPhone|iPod/.test(e)?(C.debug("isIOS() | this is iOS based on User-Agent => true"),!0):"object"===("undefined"==typeof navigator?"undefined":u(navigator))&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1?(C.debug("isIOS() | this is iPadOS 13+ based on User-Agent => true"),!0):(C.debug("isIOS() | this is not iOS => false"),!1)}function I(){return"object"===("undefined"==typeof navigator?"undefined":u(navigator))&&"ReactNative"===navigator.product?(C.debug("isReactNative() | this is React-Native based on navigator.product"),!0):(C.debug("isReactNative() | this is not React-Native => false"),!1)}exports.Device=R;
},{"./Logger":"andi","./enhancedEvents":"HRyP","./errors":"hNUz","./utils":"fnp2","./ortc":"y0TR","./Transport":"BHpp","./handlers/Chrome111":"X31T","./handlers/Chrome74":"YvS6","./handlers/Firefox120":"DQOR","./handlers/Safari12":"Xquh","./handlers/ReactNative106":"ICcI"}],"bA1q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.v4=o;for(var r,t=256,e=[];t--;)e[t]=(t+256).toString(16).substring(1);function o(){var o,n=0,s="";if(!r||t+16>256){for(r=Array(n=256);n--;)r[n]=256*Math.random()|0;n=t=0}for(;n<16;n++)o=r[t+n],s+=6==n?e[15&o|64]:8==n?e[63&o|128]:e[o],1&n&&n>1&&n<11&&(s+="-");return t++,s}
},{}],"VMdQ":[function(require,module,exports) {
"use strict";function t(t){return o(t)||n(t)||r(t)||e()}function e(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}function n(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function o(t){if(Array.isArray(t))return i(t)}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function c(t,e,r){return e&&l(t.prototype,e),r&&l(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,r){return(e=s(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t){var e=y(t,"string");return"symbol"==a(e)?e:e+""}function y(t,e){if("object"!=a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FakeEventTarget=void 0;var v=function(){return c(function t(){u(this,t),f(this,"listeners",{})},[{key:"addEventListener",value:function(t,e,r){var n;e&&(this.listeners[t]=null!==(n=this.listeners[t])&&void 0!==n?n:[],this.listeners[t].push({callback:"function"==typeof e?e:e.handleEvent,once:"object"===a(r)&&!0===r.once}))}},{key:"removeEventListener",value:function(t,e,r){this.listeners[t]&&e&&(this.listeners[t]=this.listeners[t].filter(function(t){return t.callback!==("function"==typeof e?e:e.handleEvent)}))}},{key:"dispatchEvent",value:function(e){var r=this;if(!e||"string"!=typeof e.type)throw new Error("invalid event object");var n=this.listeners[e.type];if(!n)return!0;for(var o=function(){var t=a[i];try{t.callback.call(r,e)}catch(n){setTimeout(function(){throw n},0)}t.once&&r.removeEventListener(e.type,t.callback)},i=0,a=t(n);i<a.length;i++)o();return!e.defaultPrevented}}])}();exports.FakeEventTarget=v;
},{}],"yCpY":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,o(i.key),i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function r(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(t){var n=u(t,"string");return"symbol"==e(n)?n:n+""}function u(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FakeEvent=void 0;var l=function(){return i(function e(n){var i,o,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,e),r(this,"NONE",0),r(this,"CAPTURING_PHASE",1),r(this,"AT_TARGET",2),r(this,"BUBBLING_PHASE",3),r(this,"type",void 0),r(this,"bubbles",void 0),r(this,"cancelable",void 0),r(this,"defaultPrevented",!1),r(this,"composed",!1),r(this,"currentTarget",null),r(this,"eventPhase",this.NONE),r(this,"isTrusted",!0),r(this,"target",null),r(this,"timeStamp",0),r(this,"cancelBubble",!1),r(this,"returnValue",!0),r(this,"srcElement",null),this.type=n,this.bubbles=null!==(i=u.bubbles)&&void 0!==i&&i,this.cancelable=null!==(o=u.cancelable)&&void 0!==o&&o},[{key:"preventDefault",value:function(){this.cancelable&&(this.defaultPrevented=!0)}},{key:"stopPropagation",value:function(){}},{key:"stopImmediatePropagation",value:function(){}},{key:"composedPath",value:function(){return[]}},{key:"initEvent",value:function(e,t,n){}}])}();exports.FakeEvent=l;
},{}],"fJ8q":[function(require,module,exports) {
"use strict";function e(e){return void 0===e?void 0:Number.isNaN(e)?NaN:"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.clone=e;
},{}],"BB8c":[function(require,module,exports) {
"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(){var t,r,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",u=i.toStringTag||"@@toStringTag";function a(e,i,o,u){var a=i&&i.prototype instanceof s?i:s,f=Object.create(a.prototype);return n(f,"_invoke",function(e,n,i){var o,u,a,s=0,f=i||[],l=!1,p={p:0,n:0,v:t,a:h,f:h.bind(t,4),d:function(e,n){return o=e,u=0,a=t,p.n=n,c}};function h(e,n){for(u=e,a=n,r=0;!l&&s&&!i&&r<f.length;r++){var i,o=f[r],h=p.p,v=o[2];e>3?(i=v===n)&&(a=o[(u=o[4])?5:(u=3,3)],o[4]=o[5]=t):o[0]<=h&&((i=e<2&&h<o[1])?(u=0,p.v=n,p.n=o[1]):h<v&&(i=e<3||o[0]>n||n>v)&&(o[4]=e,o[5]=n,p.n=v,u=0))}if(i||e>1)return c;throw l=!0,n}return function(i,f,v){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&h(f,v),u=f,a=v;(r=u<2?t:a)||!l;){o||(u?u<3?(u>1&&(p.n=-1),h(u,a)):p.n=a:p.v=a);try{if(s=2,o){if(u||(i="next"),r=o[i]){if(!(r=r.call(o,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,u<2&&(u=0)}else 1===u&&(r=o.return)&&r.call(o),u<2&&(a=TypeError("The iterator does not provide a '"+i+"' method"),u=1);o=t}else if((r=(l=p.n<0)?a:e.call(n,p))!==c)break}catch(r){o=t,u=1,a=r}finally{s=1}}return{value:r,done:l}}}(e,o,u),!0),f}var c={};function s(){}function f(){}function l(){}r=Object.getPrototypeOf;var p=[][o]?r(r([][o]())):(n(r={},o,function(){return this}),r),h=l.prototype=s.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,n(t,u,"GeneratorFunction")),t.prototype=Object.create(h),t}return f.prototype=l,n(h,"constructor",l),n(l,"constructor",f),f.displayName="GeneratorFunction",n(l,u,"GeneratorFunction"),n(h),n(h,u,"Generator"),n(h,o,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(e=function(){return{w:a,m:v}})()}function n(t,e,r,i){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}(n=function(t,e,r,i){function u(e,r){n(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!i,configurable:!i,writable:!i}):t[e]=r:(u("next",0),u("throw",1),u("return",2))})(t,e,r,i)}function r(t,e,n,r,i,o,u){try{var a=t[o](u),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function i(t){return function(){var e=this,n=arguments;return new Promise(function(i,o){var u=t.apply(e,n);function a(t){r(u,i,o,a,c,"next",t)}function c(t){r(u,i,o,a,c,"throw",t)}a(void 0)})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,c(r.key),r)}}function a(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function c(e){var n=s(e,"string");return"symbol"==t(n)?n:n+""}function s(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function f(t,e,n){return e=b(e),l(t,h()?Reflect.construct(e,n||[],b(t).constructor):e.apply(t,n))}function l(e,n){if(n&&("object"==t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(h=function(){return!!t})()}function v(t,e,n,r){var i=d(b(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof i?function(t){return i.apply(n,t)}:i}function d(){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=y(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(null,arguments)}function y(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=b(t)););return t}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}function m(t,e){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function w(t,e,n){g(t,e),e.set(t,n)}function g(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function E(t,e){return t.get(j(t,e))}function O(t,e,n){return t.set(j(t,e),n),n}function j(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FakeMediaStreamTrack=void 0;var P=require("@lukeed/uuid"),M=require("./fakeEvents/FakeEventTarget"),S=require("./fakeEvents/FakeEvent"),T=require("./utils"),W=new WeakMap,_=new WeakMap,F=new WeakMap,L=new WeakMap,x=new WeakMap,G=new WeakMap,R=new WeakMap,C=new WeakMap,q=new WeakMap,H=new WeakMap,B=new WeakMap,D=new WeakMap,N=new WeakMap,z=new WeakMap,U=new WeakMap,A=new WeakMap,I=function(t){function n(t){var e,r=t.kind,i=t.id,u=t.label,a=t.contentHint,c=t.enabled,s=t.muted,l=t.readyState,p=t.capabilities,h=t.constraints,v=t.settings,d=t.data;return o(this,n),w(e=f(this,n),W,void 0),w(e,_,void 0),w(e,F,void 0),w(e,L,void 0),w(e,x,void 0),w(e,G,void 0),w(e,R,void 0),w(e,C,void 0),w(e,q,void 0),w(e,H,void 0),w(e,B,void 0),w(e,D,null),w(e,N,null),w(e,z,null),w(e,U,null),w(e,A,null),O(W,e,null!=i?i:(0,P.v4)()),O(_,e,r),O(F,e,null!=u?u:""),O(R,e,null!=a?a:""),O(x,e,null==c||c),O(G,e,null!=s&&s),O(L,e,null!=l?l:"live"),O(C,e,null!=p?p:{}),O(q,e,null!=h?h:{}),O(H,e,null!=v?v:{}),O(B,e,null!=d?d:{}),e}return k(n,M.FakeEventTarget),a(n,[{key:"id",get:function(){return E(W,this)}},{key:"kind",get:function(){return E(_,this)}},{key:"label",get:function(){return E(F,this)}},{key:"contentHint",get:function(){return E(R,this)},set:function(t){O(R,this,t)}},{key:"enabled",get:function(){return E(x,this)},set:function(t){var e=E(x,this)!==t;O(x,this,t),e&&this.dispatchEvent(new S.FakeEvent("enabledchange"))}},{key:"muted",get:function(){return E(G,this)}},{key:"readyState",get:function(){return E(L,this)}},{key:"data",get:function(){return E(B,this)},set:function(t){O(B,this,t)}},{key:"onmute",get:function(){return E(D,this)},set:function(t){E(D,this)&&this.removeEventListener("mute",E(D,this)),O(D,this,t),t&&this.addEventListener("mute",t)}},{key:"onunmute",get:function(){return E(N,this)},set:function(t){E(N,this)&&this.removeEventListener("unmute",E(N,this)),O(N,this,t),t&&this.addEventListener("unmute",t)}},{key:"onended",get:function(){return E(z,this)},set:function(t){E(z,this)&&this.removeEventListener("ended",E(z,this)),O(z,this,t),t&&this.addEventListener("ended",t)}},{key:"onenabledchange",get:function(){return E(U,this)},set:function(t){E(U,this)&&this.removeEventListener("enabledchange",E(U,this)),O(U,this,t),t&&this.addEventListener("enabledchange",t)}},{key:"onstopped",get:function(){return E(A,this)},set:function(t){E(A,this)&&this.removeEventListener("stopped",E(A,this)),O(A,this,t),t&&this.addEventListener("stopped",t)}},{key:"addEventListener",value:function(t,e,r){v(n,"addEventListener",this,3)([t,e,r])}},{key:"removeEventListener",value:function(t,e,r){v(n,"removeEventListener",this,3)([t,e,r])}},{key:"stop",value:function(){"ended"!==E(L,this)&&(O(L,this,"ended"),this.dispatchEvent(new S.FakeEvent("stopped")))}},{key:"clone",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,r=t.data;return new n({id:null!=e?e:(0,P.v4)(),kind:E(_,this),label:E(F,this),contentHint:E(R,this),enabled:E(x,this),muted:E(G,this),readyState:E(L,this),capabilities:(0,T.clone)(E(C,this)),constraints:(0,T.clone)(E(q,this)),settings:(0,T.clone)(E(H,this)),data:null!=r?r:(0,T.clone)(E(B,this))})}},{key:"getCapabilities",value:function(){return E(C,this)}},{key:"getConstraints",value:function(){return E(q,this)}},{key:"applyConstraints",value:function(){var t=i(e().m(function t(){var n,r=arguments;return e().w(function(t){for(;;)switch(t.n){case 0:return n=r.length>0&&void 0!==r[0]?r[0]:{},O(q,this,n),t.a(2,Promise.resolve())}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"getSettings",value:function(){return E(H,this)}},{key:"remoteStop",value:function(){"ended"!==E(L,this)&&(O(L,this,"ended"),this.dispatchEvent(new S.FakeEvent("stopped")),this.dispatchEvent(new S.FakeEvent("ended")))}},{key:"remoteMute",value:function(){E(G,this)||(O(G,this,!0),this.dispatchEvent(new S.FakeEvent("mute")))}},{key:"remoteUnmute",value:function(){E(G,this)&&(O(G,this,!1),this.dispatchEvent(new S.FakeEvent("unmute")))}}])}();exports.FakeMediaStreamTrack=I;
},{"@lukeed/uuid":"bA1q","./fakeEvents/FakeEventTarget":"VMdQ","./fakeEvents/FakeEvent":"yCpY","./utils":"fJ8q"}],"LPgo":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function n(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",a=n.toStringTag||"@@toStringTag";function s(n,r,o,a){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return i(l,"_invoke",function(n,r,o){var i,a,s,u=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,a=0,s=e,d.n=n,c}};function p(n,r){for(a=n,s=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],p=d.p,h=i[2];n>3?(o=h===r)&&(s=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(a=0,d.v=r,d.n=i[1]):p<h&&(o=n<3||i[0]>r||r>h)&&(i[4]=n,i[5]=r,d.n=h,a=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,h){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),a=l,s=h;(t=a<2?e:s)||!f;){i||(a?a<3?(a>1&&(d.n=-1),p(a,s)):d.n=s:d.v=s);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=d.n<0)?s:n.call(r,d))!==c)break}catch(t){i=e,a=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,o,a),!0),l}var c={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),p=f.prototype=u.prototype=Object.create(d);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,i(e,a,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=f,i(p,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,a,"GeneratorFunction"),i(p),i(p,a,"Generator"),i(p,r,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:h}})()}function i(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}(i=function(e,t,n,r){function a(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))})(e,t,n,r)}function a(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function s(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,w(r.key),r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t,n){return t=b(t),d(e,h()?Reflect.construct(t,n||[],b(e).constructor):t.apply(e,n))}function d(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return p(t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(h=function(){return!!e})()}function m(e,t,n,r){var o=v(b(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=y(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}}).apply(null,arguments)}function y(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}function _(e,t){return(_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t,n){return(t=w(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(t){var n=S(t,"string");return"symbol"==e(n)?n:n+""}function S(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FakeHandler=void 0;var R=require("fake-mediastreamtrack"),x=require("../enhancedEvents"),P=require("../Logger"),L=require("../utils"),T=require("../ortc"),C=require("../errors"),E=require("./fakeEvents/FakeEventTarget"),N=new P.Logger("FakeHandler"),O="FakeHandler",j=function(e){function n(e,t){var r,o=e.getSendExtendedRtpCapabilities;return c(this,n),k(r=f(this,n),"_closed",!1),k(r,"_fakeParameters",void 0),k(r,"_getSendExtendedRtpCapabilities",void 0),k(r,"_cname","CNAME-".concat(L.generateRandomNumber())),k(r,"_transportReady",!1),k(r,"_nextLocalId",1),k(r,"_tracks",new Map),k(r,"_nextSctpStreamId",0),N.debug("constructor()"),r._getSendExtendedRtpCapabilities=o,r._fakeParameters=t,r}return g(n,x.EnhancedEventEmitter),l(n,[{key:"name",get:function(){return O}},{key:"close",value:function(){N.debug("close()"),this._closed||(this._closed=!0,m(n,"close",this,3)([]))}},{key:"setIceGatheringState",value:function(e){this.emit("@icegatheringstatechange",e)}},{key:"setConnectionState",value:function(e){this.emit("@connectionstatechange",e)}},{key:"updateIceServers",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),N.debug("updateIceServers()");case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"restartIce",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),N.debug("restartIce()");case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getTransportStats",value:function(){var e=s(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,new Map)}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=s(o().m(function e(r){var i,a,s,c,u,l,f,d,p,h,m;return o().w(function(e){for(;;)switch(e.n){case 0:if(i=r.track,a=r.encodings,r.codecOptions,s=r.codec,this.assertNotClosed(),N.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),this._transportReady){e.n=1;break}return e.n=1,this.setupTransport({localDtlsRole:"server"});case 1:c=n.getLocalRtpCapabilities(this._fakeParameters),u=this._getSendExtendedRtpCapabilities(c),(l=T.getSendingRtpParameters(i.kind,u)).codecs=T.reduceCodecs(l.codecs,s),f=l.codecs.some(function(e){return/.+\/rtx$/i.test(e.mimeType)}),l.mid="mid-".concat(L.generateRandomNumber()),a||(a=[{}]),d=t(a);try{for(d.s();!(p=d.n()).done;)(h=p.value).ssrc=L.generateRandomNumber(),f&&(h.rtx={ssrc:L.generateRandomNumber()})}catch(o){d.e(o)}finally{d.f()}return l.encodings=a,l.rtcp={cname:this._cname,reducedSize:!0,mux:!0},m=this._nextLocalId++,this._tracks.set(m,i),e.a(2,{localId:String(m),rtpParameters:l})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"stopSending",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:if(N.debug("stopSending() [localId:%s]",t),!this._closed){e.n=1;break}return e.a(2);case 1:if(this._tracks.has(Number(t))){e.n=2;break}throw new Error("local track not found");case 2:this._tracks.delete(Number(t));case 3:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseSending",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed();case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeSending",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed();case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"replaceTrack",value:function(){var e=s(o().m(function e(t,n){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),n?N.debug("replaceTrack() [localId:%s, track.id:%s]",t,n.id):N.debug("replaceTrack() [localId:%s, no track]",t),this._tracks.delete(Number(t)),this._tracks.set(Number(t),n);case 1:return e.a(2)}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setMaxSpatialLayer",value:function(){var e=s(o().m(function e(t,n){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),N.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,n);case 1:return e.a(2)}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"setRtpEncodingParameters",value:function(){var e=s(o().m(function e(t,n){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed(),N.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,n);case 1:return e.a(2)}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSenderStats",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,new Map)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendDataChannel",value:function(){var e=s(o().m(function e(t){var n,r,i,a,s,c,u;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=t.ordered,r=t.maxPacketLifeTime,i=t.maxRetransmits,a=t.label,s=t.protocol,this.assertNotClosed(),this._transportReady){e.n=1;break}return e.n=1,this.setupTransport({localDtlsRole:"server"});case 1:return N.debug("sendDataChannel()"),c=new I({id:this._nextSctpStreamId++,ordered:n,maxPacketLifeTime:r,maxRetransmits:i,label:a,protocol:s}),u={streamId:this._nextSctpStreamId,ordered:n,maxPacketLifeTime:r,maxRetransmits:i},e.a(2,{dataChannel:c,sctpStreamParameters:u})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=s(o().m(function e(n){var r,i,a,s,c,u,l,f,d;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:this.assertNotClosed(),r=[],i=t(n),e.p=1,i.s();case 2:if((a=i.n()).done){e.n=5;break}if(s=a.value,c=s.trackId,u=s.kind,this._transportReady){e.n=3;break}return e.n=3,this.setupTransport({localDtlsRole:"client"});case 3:N.debug("receive() [trackId:%s, kind:%s]",c,u),l=this._nextLocalId++,f=new R.FakeMediaStreamTrack({kind:u}),this._tracks.set(l,f),r.push({localId:String(l),track:f});case 4:e.n=2;break;case 5:e.n=7;break;case 6:e.p=6,d=e.v,i.e(d);case 7:return e.p=7,i.f(),e.f(7);case 8:return e.a(2,r)}},e,this,[[1,6,7,8]])}));return function(t){return e.apply(this,arguments)}}()},{key:"stopReceiving",value:function(){var e=s(o().m(function e(n){var r,i,a;return o().w(function(e){for(;;)switch(e.n){case 0:if(!this._closed){e.n=1;break}return e.a(2);case 1:r=t(n);try{for(r.s();!(i=r.n()).done;)a=i.value,N.debug("stopReceiving() [localId:%s]",a),this._tracks.delete(Number(a))}catch(o){r.e(o)}finally{r.f()}case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"pauseReceiving",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed();case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"resumeReceiving",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:this.assertNotClosed();case 1:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getReceiverStats",value:function(){var e=s(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return this.assertNotClosed(),e.a(2,new Map)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"receiveDataChannel",value:function(){var e=s(o().m(function e(t){var n,r,i,a;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=t.sctpStreamParameters,r=t.label,i=t.protocol,this.assertNotClosed(),this._transportReady){e.n=1;break}return e.n=1,this.setupTransport({localDtlsRole:"client"});case 1:return N.debug("receiveDataChannel()"),a=new I({id:n.streamId,ordered:n.ordered,maxPacketLifeTime:n.maxPacketLifeTime,maxRetransmits:n.maxRetransmits,label:r,protocol:i}),e.a(2,{dataChannel:a})}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setupTransport",value:function(){var e=s(o().m(function e(t){var n,r,i=this;return o().w(function(e){for(;;)switch(e.n){case 0:return n=t.localDtlsRole,t.localSdpObject,r=L.clone(this._fakeParameters.generateLocalDtlsParameters()),n&&(r.role=n),this.emit("@connectionstatechange","connecting"),e.n=1,new Promise(function(e,t){return i.emit("@connect",{dtlsParameters:r},e,t)});case 1:this._transportReady=!0;case 2:return e.a(2)}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"assertNotClosed",value:function(){if(this._closed)throw new C.InvalidStateError("method called in a closed handler")}}],[{key:"createFactory",value:function(e){return{name:O,factory:function(t){return new n(t,e)},getNativeRtpCapabilities:function(){var t=s(o().m(function t(){return o().w(function(t){for(;;)switch(t.n){case 0:return N.debug("getNativeRtpCapabilities()"),t.a(2,n.getLocalRtpCapabilities(e))}},t)}));return function(){return t.apply(this,arguments)}}(),getNativeSctpCapabilities:function(){var t=s(o().m(function t(){return o().w(function(t){for(;;)switch(t.n){case 0:return N.debug("getNativeSctpCapabilities()"),t.a(2,e.generateNativeSctpCapabilities())}},t)}));return function(){return t.apply(this,arguments)}}()}}},{key:"getLocalRtpCapabilities",value:function(e){var t=e.generateNativeRtpCapabilities();return T.validateAndNormalizeRtpCapabilities(t),t}}])}();exports.FakeHandler=j;var I=function(e){function t(e){var n,r=e.id,o=e.ordered,i=void 0===o||o,a=e.maxPacketLifeTime,s=void 0===a?null:a,u=e.maxRetransmits,l=void 0===u?null:u,d=e.label,p=void 0===d?"":d,h=e.protocol,m=void 0===h?"":h;return c(this,t),k(n=f(this,t),"_id",void 0),k(n,"_negotiated",!0),k(n,"_ordered",void 0),k(n,"_maxPacketLifeTime",void 0),k(n,"_maxRetransmits",void 0),k(n,"_label",void 0),k(n,"_protocol",void 0),k(n,"_readyState","connecting"),k(n,"_bufferedAmount",0),k(n,"_bufferedAmountLowThreshold",0),k(n,"_binaryType","arraybuffer"),k(n,"_onopen",null),k(n,"_onclosing",null),k(n,"_onclose",null),k(n,"_onmessage",null),k(n,"_onbufferedamountlow",null),k(n,"_onerror",null),N.debug("constructor() [id:".concat(r,", ordered:").concat(i,", maxPacketLifeTime:").concat(s,", maxRetransmits:").concat(l,", label:").concat(p,", protocol:").concat(m)),n._id=r,n._ordered=i,n._maxPacketLifeTime=s,n._maxRetransmits=l,n._label=p,n._protocol=m,n}return g(t,E.FakeEventTarget),l(t,[{key:"id",get:function(){return this._id}},{key:"negotiated",get:function(){return this._negotiated}},{key:"ordered",get:function(){return this._ordered}},{key:"maxPacketLifeTime",get:function(){return this._maxPacketLifeTime}},{key:"maxRetransmits",get:function(){return this._maxRetransmits}},{key:"label",get:function(){return this._label}},{key:"protocol",get:function(){return this._protocol}},{key:"readyState",get:function(){return this._readyState}},{key:"bufferedAmount",get:function(){return this._bufferedAmount}},{key:"bufferedAmountLowThreshold",get:function(){return this._bufferedAmountLowThreshold},set:function(e){this._bufferedAmountLowThreshold=e}},{key:"binaryType",get:function(){return this._binaryType},set:function(e){this._binaryType=e}},{key:"onopen",get:function(){return this._onopen},set:function(e){this._onopen&&this.removeEventListener("open",this._onopen),this._onopen=e,e&&this.addEventListener("open",e)}},{key:"onclosing",get:function(){return this._onclosing},set:function(e){this._onclosing&&this.removeEventListener("closing",this._onclosing),this._onclosing=e,e&&this.addEventListener("closing",e)}},{key:"onclose",get:function(){return this._onclose},set:function(e){this._onclose&&this.removeEventListener("close",this._onclose),this._onclose=e,e&&this.addEventListener("close",e)}},{key:"onmessage",get:function(){return this._onmessage},set:function(e){this._onmessage&&this.removeEventListener("message",this._onmessage),this._onmessage=e,e&&this.addEventListener("message",e)}},{key:"onbufferedamountlow",get:function(){return this._onbufferedamountlow},set:function(e){this._onbufferedamountlow&&this.removeEventListener("bufferedamountlow",this._onbufferedamountlow),this._onbufferedamountlow=e,e&&this.addEventListener("bufferedamountlow",e)}},{key:"onerror",get:function(){return this._onerror},set:function(e){this._onerror&&this.removeEventListener("error",this._onerror),this._onerror=e,e&&this.addEventListener("error",e)}},{key:"addEventListener",value:function(e,n,r){m(t,"addEventListener",this,3)([e,n,r])}},{key:"removeEventListener",value:function(e,n,r){m(t,"removeEventListener",this,3)([e,n,r])}},{key:"close",value:function(){["closing","closed"].includes(this._readyState)||(this._readyState="closed")}},{key:"send",value:function(e){if("open"!==this._readyState)throw new C.InvalidStateError("not open")}}])}();
},{"fake-mediastreamtrack":"BB8c","../enhancedEvents":"HRyP","../Logger":"andi","../utils":"fnp2","../ortc":"y0TR","../errors":"hNUz","./fakeEvents/FakeEventTarget":"VMdQ"}],"PSAy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateRouterRtpCapabilities=t,exports.generateNativeRtpCapabilities=a,exports.generateNativeSctpCapabilities=d,exports.generateLocalDtlsParameters=p,exports.generateTransportRemoteParameters=i,exports.generateProducerRemoteParameters=o,exports.generateConsumerRemoteParameters=c,exports.generateDataProducerRemoteParameters=n,exports.generateDataConsumerRemoteParameters=s;var e=require("../utils");function r(){return String(e.generateRandomNumber())}function t(){return e.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function a(){return{codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/foo",kind:"audio",preferredPayloadType:107,clockRate:9e4,channels:4,rtcpFeedback:[{type:"foo-qwe-qwe"}],parameters:{foo:"lalala"}},{mimeType:"video/BAZCODEC",kind:"video",preferredPayloadType:100,clockRate:9e4,rtcpFeedback:[{type:"foo"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[],parameters:{apt:100}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]}}function d(){return e.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function p(){return e.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function i(){return{id:r(),iceParameters:e.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:e.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:e.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:e.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function o(){return e.deepFreeze({id:r()})}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.id,d=t.codecMimeType;switch(d){case"audio/opus":return{id:null!=a?a:r(),producerId:r(),kind:"audio",rtpParameters:e.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:null!=a?a:r(),producerId:r(),kind:"audio",rtpParameters:e.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:null!=a?a:r(),producerId:r(),kind:"video",rtpParameters:e.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:null!=a?a:r(),producerId:r(),kind:"video",rtpParameters:e.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError("unknown codecMimeType '".concat(d,"'"))}}function n(){return e.deepFreeze({id:r()})}function s(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;return{id:null!=t?t:r(),dataProducerId:r(),sctpStreamParameters:e.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}
},{"../utils":"fnp2"}],"CWXY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.debug=exports.testFakeParameters=exports.FakeHandler=exports.enhancedEvents=exports.ortc=exports.parseScalabilityMode=exports.detectDeviceAsync=exports.detectDevice=exports.Device=exports.version=exports.types=void 0;var e=require("debug");exports.debug=e.default,exports.types=require("./types"),exports.version="3.16.7";var r=require("./Device");Object.defineProperty(exports,"Device",{enumerable:!0,get:function(){return r.Device}}),Object.defineProperty(exports,"detectDevice",{enumerable:!0,get:function(){return r.detectDevice}}),Object.defineProperty(exports,"detectDeviceAsync",{enumerable:!0,get:function(){return r.detectDeviceAsync}});var t=require("./scalabilityModes");Object.defineProperty(exports,"parseScalabilityMode",{enumerable:!0,get:function(){return t.parse}}),exports.ortc=require("./ortc"),exports.enhancedEvents=require("./enhancedEvents");var s=require("./handlers/FakeHandler");Object.defineProperty(exports,"FakeHandler",{enumerable:!0,get:function(){return s.FakeHandler}}),exports.testFakeParameters=require("./test/fakeParameters");
},{"debug":"RglY","./types":"pJdj","./Device":"kWtX","./scalabilityModes":"LIqw","./ortc":"y0TR","./enhancedEvents":"HRyP","./handlers/FakeHandler":"LPgo","./test/fakeParameters":"PSAy"}],"VE3v":[function(require,module,exports) {
module.exports=require("mediasoup-client");
},{"mediasoup-client":"CWXY"}]},{},["VE3v"], "mediasoupClient")
//# sourceMappingURL=/mediasoup.bundle.js.map